<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Taaspace Example / Using Networks</title>
  
  <!-- Disable user scalability to override native touch gestures. -->
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
  
  <style>
    html, body, .space {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
    }
    
    body {
      font-size: 16px;
      background: #222;
      font-family: sans-serif;
      color: white;
    }
    
    p {
      padding: 0px;
      margin: 0px;
    }
    
    img {
      padding: 0px;
      margin: 0px;
      opacity: 0.382;
    }
    
    img.focused {
      box-shadow: 0px 0px 15px #050505;
      opacity: 1;
    }
  </style>
</head>
<body>
  <div id="space" class="space"></div>
  
  <script src="../includes/jquery/jquery-1.10.2.js"></script>
  <script src="../includes/jquery/jquery.mousewheel-3.1.4.js"></script>
  <script src="../includes/hammer/hammer-1.0.5.js"></script>
  <script src="../includes/jwerty/jwerty-0.3.2.js"></script>
  <script src="../includes/move/move-0.3.2.js"></script>
  <script src="../includes/underscore/underscore-1.5.2.js"></script>
  
  <script src="../taaspace.js"></script>
  <script>
    var space = Taaspace.create('#space');
    var view = space.getViewport();
    
    var units = {
      'a': {
        id: 'a',
        src: 'assets/spiral-512x512.jpg',
        spaceElement: null,
        prev: 'taa05',
        next: 'b'
      },
      'b': {
        id: 'b',
        src: 'assets/blackletter-512x512.jpg',
        spaceElement: null,
        prev: 'a',
        next: 'c'
      },
      'c': {
        id: 'c',
        src: 'assets/castle-512x512.jpg',
        spaceElement: null,
        prev: 'b',
        next: 'd'
      },
      'd': {
        id: 'd',
        src: 'assets/Lenna-512x512.png',
        spaceElement: null,
        prev: 'c',
        next: 'taa00'
      },
      
      
      'taa00': {
        id: 'taa00',
        src: 'assets/taa00_256.jpg',
        spaceElement: null,
        prev: 'd',
        next: 'taa01'
      },
      'taa01': {
        id: 'taa01',
        src: 'assets/taa01_256.jpg',
        spaceElement: null,
        prev: 'taa00',
        next: 'taa02'
      },
      'taa02': {
        id: 'taa02',
        src: 'assets/taa02_256.jpg',
        spaceElement: null,
        prev: 'taa01',
        next: 'taa03'
      },
      'taa03': {
        id: 'taa03',
        src: 'assets/taa03_256.jpg',
        spaceElement: null,
        prev: 'taa02',
        next: 'taa04'
      },
      'taa04': {
        id: 'taa04',
        src: 'assets/taa04_256.jpg',
        spaceElement: null,
        prev: 'taa03',
        next: 'taa05'
      },
      'taa05': {
        id: 'taa05',
        src: 'assets/taa05_256.jpg',
        spaceElement: null,
        prev: 'taa04',
        next: 'a'
      }
    };
    
    var focusSize = 0.2;
    var depthRadius = 3;
    var nextRatio = 1.618;
    var sin45 = 1 / Math.sqrt(2);
    
    var net = space.createNetwork({
      create: function (space, unit, done, predecessor) {
        // var predecessorRadius, unitRadius, predecessorCenter
        var pr, ur, pc;
        // var unitX, unitY
        var ux, uy;
        if (predecessor === null) {
          ur = 0.5;
          unit.spaceElement = space.createImage(unit.src)
            .size(ur * 2, ur * 2)
            .pivot(0, 0)
            .moveTo(0, 0);
        } else if (predecessor.id === unit.prev) {
          pr = predecessor.spaceElement.width() / 2;
          ur = pr / nextRatio;
          unit.spaceElement = space.createImage(unit.src)
            .size(ur * 2, ur * 2);
          unit.spaceElement.pivot(unit.spaceElement.center());
          pc = predecessor.spaceElement.center();
          ux = pc.x + pr * sin45 + ur * sin45;
          uy = pc.y + pr * sin45 + ur * sin45;
          unit.spaceElement.moveTo(ux, uy);
        } else if (predecessor.id === unit.next) {
          pr = predecessor.spaceElement.width() / 2;
          ur = pr * nextRatio;
          unit.spaceElement = space.createImage(unit.src)
            .size(ur * 2, ur * 2);
          unit.spaceElement.pivot(unit.spaceElement.center());
          pc = predecessor.spaceElement.center();
          ux = pc.x - pr * sin45 - ur * sin45;
          uy = pc.y - pr * sin45 - ur * sin45;
          unit.spaceElement.moveTo(ux, uy);
        }
        
        // Make them circles
        unit.spaceElement.on('scaled', function () {
          var r = view.translateDistanceFromSpace(this.width());
          this.css('border-radius', r + 'px');
        });
        
        unit.spaceElement.on('tap', function () {
          focus(unit);
        });
        
        done();
      },
      
      neighbors: function (space, unit, done, predecessor) {
        var n = [units[unit.prev], units[unit.next]];
        done(n);
      },
      
      remove: function (space, unit, done) {
        unit.spaceElement.remove();
        done();
      }
    });
    
    view.scalable().movable().select();
    
    
    
    var focus = function (unit) {
      net.spreadFrom(unit, depthRadius, function () {
        console.log('spreadFrom ended');
      });
      view.focusTo(unit.spaceElement, focusSize,
                   {ease: 'snap'});
      // Mark as focused.
      jQuery('.focused').removeClass('focused');
      unit.spaceElement.addClass('focused');
    };
    
    focus(units.a);
    
  </script>
</body>
</html>
