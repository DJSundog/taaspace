{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/index.js","src/SpacePoint.js","src/Transform.js","src/SpaceTransform.js","src/Taa.js","src/SpaceTaa.js","src/SpaceHTML.js","src/SpacePixel.js","src/Space.js","src/HTMLSpaceView.js","src/version.js","src/SpaceNode.js","src/SpacePlane.js","src/SpaceTransformer.js","src/SpaceRectangle.js","node_modules/component-emitter/index.js","node_modules/nudged/index.js","node_modules/loadimages/index.js","node_modules/move-js/index.js","node_modules/nudged/lib/estimateS.js","node_modules/nudged/lib/estimateR.js","node_modules/nudged/lib/estimateSR.js","node_modules/nudged/lib/estimateTS.js","node_modules/nudged/lib/estimateTSR.js","node_modules/nudged/lib/estimateTR.js","node_modules/nudged/lib/estimateT.js","node_modules/nudged/lib/Transform.js","node_modules/nudged/lib/version.js","node_modules/seqid/seqid.js","node_modules/after-transition/index.js","node_modules/component-query/index.js","node_modules/has-translate3d/index.js","node_modules/css-ease/index.js","node_modules/has-transitions/index.js","node_modules/css-emitter-component/index.js","node_modules/transform-property/index.js","node_modules/event-component/index.js"],"names":["exports","SpacePoint","require","Transform","SpaceTransform","Taa","SpaceTaa","SpaceHTML","SpacePixel","Space","HTMLSpaceView","version","nudged","reference","xy","this","hasOwnProperty","_T","getGlobalTransform","T","proto","prototype","equals","point","offset","dx","dy","polarOffset","radius","radians","x","Math","cos","y","sin","to","target","toSpace","target_gT","Error","C","inverse","multiplyBy","xy_target","transform","xySpace","spaceMock","IDENTITY","transformBy","tr","t","xy_hat","normalize","points","plane","i","p","normalized","length","push","toXY","xys","normalizeXY","module","switchTo","newReference","st","targetGT","this2target","tOnTarget","tOnSpace","spaceTransform","nt","translate","domain","range","estimate","scale","pivot","multiplierOrDomain","useMultiplier","normPivot","scaleBy","rotate","radiansOrDomain","useRadians","rotateBy","translateScale","translateRotate","scaleRotate","translateScaleRotate","type","normDomain","normRange","Emitter","loadimages","NOOP","imgSrc","onLoaded","this2","image","src","notCached","err","emiterr","emittaa","emit","setTimeout","SpaceNode","SpacePlane","SpaceTransformer","SpaceRectangle","parent","taa","resize","setParent","html","getHTML","remove","move","defaults","duration","space","htmlContainer","_el","_elements","_nodes","w","clientWidth","h","clientHeight","_hasNodeId","nodeid","transformNode","htmlElement","spaceNode","gT","prec","s","toFixed","r","tx","ty","matrix","end","getViewSpecificId","spaceNodeId","id","transformedHandler","nodes","node","el","getDescendants","resizedHandler","wh","getSize","style","width","height","contentAddedHandler","newParent","oldParent","getRootParent","Image","className","appendChild","on","document","createElement","innerHTML","Exception","contentRemovedHandler","sameRoot","removeChild","off","self","newSpace","oldSpace","des","element","getElementBySpaceNode","getSpaceNodeByElementId","split","spaceViewId","getRootElement","superSetParent","call","seqid","emitter","next","toString","_parent","_children","_addedHandlers","_removedHandlers","getChildren","arr","obj","children","child","concat","getParent","hasChild","hasDescendant","_addChild","_removeChild","sc","addedHandler","a","b","c","removedHandler","at","getLocalTransform","resetTransform","setLocalTransform","setGlobalTransform","parent_gt","new_gt","normST","spaceTransformer","atNorm","atMid","atMidN","atMidW","atMidE","atMidS","atNW","atNE","atSW","atSE","dimensions","mixin","key","addEventListener","event","fn","_callbacks","once","apply","arguments","removeListener","removeAllListeners","removeEventListener","callbacks","cb","splice","args","slice","len","listeners","hasListeners","estimateT","estimateS","estimateR","estimateTS","estimateTR","estimateSR","estimateTSR","name","toUpperCase","imgSrcs","then","numberOfImages","stringGiven","thereWasSuccess","thereWasError","imgs","onloadsCalled","onload","onerror","isFinalImage","errMsg","Move","query","TypeError","_props","_rotate","_transitionProps","_transforms","fixUnits","val","isNaN","setProperty","error","CSSStyleDeclaration","getProperty","getAttribute","setAttribute","removeProperty","removeAttribute","after","has3d","ease","window","getComputedStyle","currentStyle","select","selector","skew","skewX","n","skewY","join","translateX","translateY","scaleX","m11","m12","m21","m22","m31","m32","scaleY","setVendorProperty","animate","props","_duration","parseFloat","delay","prop","set","transition","add","curr","parseInt","current","sub","getPropertyValue","indexOf","applyProperties","clone","pop","reset","webkitTransitionDuration","mozTransitionDuration","msTransitionDuration","oTransitionDuration","N","D","a0","b0","d","ac","bd","aa","bb","shat","min","max","ad","bc","rhat","q","sqrt","X","Y","a2","b2","v","den","eps","abs","a1","b1","c1","d1","N2","a12","b12","txhat","tyhat","getMatrix","e","f","getRotation","atan2","getScale","getTranslation","det","translateBy","multiplier","m","co","si","SeqId","initial","random","pow","_id","afterTransition","callback","hasTransitions","bind","unbind","one","querySelector","all","querySelectorAll","engine","map","webkitTransform","OTransform","msTransform","MozTransform","body","insertBefore","in","out","in-out","snap","linear","ease-in-quad","ease-in-cubic","ease-in-quart","ease-in-quint","ease-in-sine","ease-in-expo","ease-in-circ","ease-in-back","ease-out-quad","ease-out-cubic","ease-out-quart","ease-out-quint","ease-out-sine","ease-out-expo","ease-out-circ","ease-out-back","ease-in-out-quart","ease-in-out-quint","ease-in-out-sine","ease-in-out-expo","ease-in-out-circ","ease-in-out-back","property","types","shift","CssEmitter","events","watch","styles","capture","attachEvent","detachEvent"],"mappings":"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","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","// API v3.0.0\n\nexports.SpacePoint = require('./SpacePoint');\nexports.Transform = require('./Transform');\nexports.SpaceTransform = require('./SpaceTransform');\nexports.Taa = require('./Taa');\nexports.SpaceTaa = require('./SpaceTaa');\nexports.SpaceHTML = require('./SpaceHTML');\nexports.SpacePixel = require('./SpacePixel');\nexports.Space = require('./Space');\nexports.HTMLSpaceView = require('./HTMLSpaceView');\n\nexports.version = require('./version');\n","// API v3.0.0\n\nvar nudged = require('nudged');\n\nvar SpacePoint = function (reference, xy) {\n  // Example\n  //   var p = taaspace.SpacePoint(taa, [x, y]);\n  //\n  // Parameter\n  //   reference\n  //     a SpaceNode, SpacePoint, or SpaceTransform\n  //       an item in space, enabling coord projections.\n  //   xy\n  //     [x, y] array. Optional, defaults to [0,0]\n\n  if (typeof xy === 'undefined') { xy = [0, 0]; }\n  this.xy = xy;\n\n  // The SpacePlane's transformation the xy are on.\n  // Design note: at first, the references were SpacePlanes and not\n  // transformations. But because a SpacePlane can move or be removed,\n  // we chose only the transformation to be remembered.\n  // Design note: later we found it would be convenient for debugging\n  // to know where the point came from, which led to this._origin.\n  // After that we found that in toSpace method, we would need reference\n  // to space, although we only have implicit reference to its coords.\n  // Therefore this._origin was dropped.\n\n  if (reference.hasOwnProperty('getGlobalTransform')) {\n    // Is a SpacePlane\n    this._T = reference.getGlobalTransform().T;\n  } else {\n    // Is a SpacePoint\n    this._T = reference._T;\n  }\n};\n\nvar proto = SpacePoint.prototype;\n\nproto.equals = function (point) {\n  return (this.xy[0] === point.xy[0] &&\n    this.xy[1] === point.xy[1] &&\n    this._T.equals(point._T));\n};\n\nproto.offset = function (dx, dy) {\n  // Create a new point nearby.\n  //\n  // Parameter\n  //   dx\n  //     Movement towards positive x\n  //   dy\n  //     ...\n  var xy = [this.xy[0] + dx, this.xy[1] + dy];\n  return new SpacePoint(this, xy);\n};\n\nproto.polarOffset = function (radius, radians) {\n  // Create a new point moved by the polar coordinates\n  var x = this.xy[0] + radius * Math.cos(radians);\n  var y = this.xy[1] + radius * Math.sin(radians);\n  return new SpacePoint(this, [x, y]);\n};\n\nproto.to = function (target) {\n  // Create a new SpacePoint at same location but on a\n  // different SpacePlane.\n  //\n  // Parameter\n  //   target, a SpacePlane or null.\n  //\n  // Implementation note (See 2016-03-05-09):\n  //\n  // First, compute coord. transf. B from the current plane\n  // to the space:\n  //   x_space = B * x_plane  <=>  x_plane = inv(B) * x_space\n  //   B = plane._T\n  // Second, let A be coord. transf. from the space to the target plane:\n  //   x_target = A * x_space\n  //   A = inv(target._T)\n  // Therefore combined coord. transf. C from the curr. plane to the target:\n  //   x_target = C * x_plane\n  //   <=> A * x_space = C * inv(B) * x_space\n  //   <=> A = C * inv(B)\n  //   <=> C = AB\n  //   <=> C = inv(target._T) * plane._T\n  //\n\n  if (target === null) {\n    // target is the root node (space)\n    return this.toSpace();\n  }\n\n  // Target's global transformation. This._T is already global.\n  var target_gT;\n  if (target.hasOwnProperty('_T')) {\n    // SpacePoint or SpaceTransform\n    target_gT = target._T;\n  } else if ('getGlobalTransform' in target) {\n    // SpacePlane\n    target_gT = target.getGlobalTransform().T;\n  } else {\n    throw new Error('Cannot convert SpacePoint to: ' + target);\n  }\n\n  if (target_gT.equals(this._T)) {\n    return this;\n  } // else\n  var C = target_gT.inverse().multiplyBy(this._T);\n  var xy_target = C.transform(this.xy);\n  return new SpacePoint(target, xy_target);\n};\n\nproto.toSpace = function () {\n  // Create a new SpacePoint at same location but represented on space coords.\n  //\n  // Implementation note:\n  //   We already have coord. transf. from the current plane to the space:\n  //     plane._T\n  var xySpace = this._T.transform(this.xy);\n  var spaceMock = { '_T': nudged.Transform.IDENTITY };\n  return new SpacePoint(spaceMock, xySpace);\n};\n\nproto.transformBy = function (tr) {\n  // Create a new SpacePoint by SpaceTransform.\n  //\n  // Parameter\n  //   tr\n  //     a SpaceTransform\n  var t = tr.to(this);\n  var xy_hat = t.T.transform(this.xy);\n  return new SpacePoint(this, xy_hat);\n};\n\n\nSpacePoint.normalize = function (points, plane) {\n  // Convert all the space points onto same plane.\n  //\n  // Arguments:\n  //   points, array of SpacePoints\n  //   plane, a SpacePlane onto normalize. null = space\n  // Return:\n  //   array of SpacePoints\n  var i, p, normalized;\n  normalized = [];\n  for (i = 0; i < points.length; i += 1) {\n    p = points[i];\n    normalized.push(p.to(plane));\n  }\n  return normalized;\n};\n\nSpacePoint.toXY = function (points) {\n  // Convert SpacePoints to [[x1,y1], [x2,y2], ...]\n  var i, xys;\n  xys = [];\n  for (i = 0; i < points.length; i += 1) {\n    xys.push(points[i].xy);\n  }\n  return xys;\n};\n\nSpacePoint.normalizeXY = function (points, plane) {\n  // Convert all the space points onto same plane and\n  // represent the as xy list: [[x1,y1], [x2,y2], ...].\n  //\n  // Arguments:\n  //   points, array of SpacePoints\n  //   plane, a SpacePlane onto normalize. null = space\n  // Return:\n  //   array of [x,y] points\n  var i, p, normalized;\n  normalized = [];\n  for (i = 0; i < points.length; i += 1) {\n    p = points[i];\n    normalized.push(p.to(plane).xy);\n  }\n  return normalized;\n};\n\n\nmodule.exports = SpacePoint;\n","// API v3.0.0\n\nvar nudged = require('nudged');\n\nmodule.exports = nudged.Transform;\n","/*\nSimilarly as a point can be represented in multiple coordinate systems,\nso can a transformation. To prevent users from figuring out how transformations\nare converted to other representations, we have SpaceTransform.\n\nThe API is similar to SpacePoint. However, instead of offset methods, we have\na set of similarity transformation methods.\n*/\nvar Transform = require('./Transform');\nvar SpacePoint = require('./SpacePoint');\nvar nudged = require('nudged');\n\nvar SpaceTransform = function (reference, T) {\n  // Immutable i.e. new instances are returned.\n  //\n  // Example\n  //   var t = taaspace.SpaceTransform(taa, taaspace.Transform.IDENTITY);\n  //\n  // Parameter\n  //   reference\n  //     a SpacePlane, SpacePoint, or SpaceTransform\n  //       an item in space, enabling coord projections.\n  //   T\n  //     Optional. A taaspace.Transform. Default to identity transform.\n\n  // DEBUG\n  if (!reference.hasOwnProperty('_T')) throw 'invalid reference';\n  if (T && !T.hasOwnProperty('tx')) throw 'invalid transform';\n\n  // A transformation on the plane.\n  if (typeof T === 'undefined') { T = Transform.IDENTITY; }\n  this.T = T;\n\n  // The coordinate transformation of the plane.\n  if (reference.hasOwnProperty('getGlobalTransform')) {\n    // Is a SpacePlane\n    this._T = reference.getGlobalTransform().T;\n  } else {\n    // Is a SpacePoint or SpaceTransform\n    this._T = reference._T;\n  }\n};\n\nvar proto = SpaceTransform.prototype;\n\nproto.switchTo = function (newReference) {\n  // Combine the transformation to a new coordinate system.\n  // Return new SpaceTransform.\n  return new SpaceTransform(newReference, this.T);\n};\n\nproto.equals = function (st) {\n  // Parameters:\n  //   st: a SpaceTransform\n  return (this.T.equals(st.T) && this._T.equals(st._T));\n};\n\nproto.inverse = function () {\n  // Return inversed transformation on the same plane.\n  return new SpaceTransform(this, this.T.inverse());\n};\n\nproto.to = function (target) {\n  // Convert the transform onto the target coordinate plane.\n  //\n  // Parameters:\n  //   target: a SpacePlane, SpacePoint, or SpaceTransform\n  //\n  // Return:\n  //   new SpaceTransform\n  var targetGT, this2target, tOnTarget;\n\n  if (target === null) {\n    // target is the root node (space)\n    return this.toSpace();\n  }\n\n  // Target's global transformation. This._T is already global.\n  if (target.hasOwnProperty('_T')) {\n    targetGT = target._T;\n  } else if ('getGlobalTransform' in target) {\n    targetGT = target.getGlobalTransform().T;\n  } else {\n    throw new Error('Cannot convert SpaceTransform to: ' + target);\n  }\n\n  // Avoid unnecessary, probably rounding errors inducing computation.\n  if (targetGT.equals(this._T)) {\n    return this;\n  } // else\n\n  // The transformation on the target plane equals to:\n  // 1) convert from target to current\n  // 2) execute the transformation\n  // 3) convert back to target.\n  // Fortunately we can combine these steps into a one transformation matrix.\n  // Let us first compute conversion from this to target and remember that:\n  //   x_space = T_plane * x_plane\n  this2target = targetGT.inverse().multiplyBy(this._T);\n  tOnTarget = this2target.multiplyBy(this.T.multiplyBy(this2target.inverse()));\n  return new SpaceTransform(target, tOnTarget);\n};\n\nproto.toSpace = function () {\n  // Convert the transform onto the space coordinate plane.\n  // Return a new SpaceTransform.\n  //\n  // Implementation note:\n  //   We already have coord. transf. from the current plane to the space:\n  //     this._T\n\n  // To simulate the transformation on space:\n  // 1) convert from space to the plane: this._T.inverse()\n  // 2) apply the transformation\n  // 3) convert from plane back to the space: this._T\n  var tOnSpace = this._T.multiplyBy(this.T.multiplyBy(this._T.inverse()));\n  var spaceMock = { '_T': Transform.IDENTITY };\n  return new SpaceTransform(spaceMock, tOnSpace);\n};\n\nproto.transformBy = function (spaceTransform) {\n  // Transform the image of this by given SpaceTransform.\n  var t = spaceTransform.to(this).T;\n  var nt = t.multiplyBy(this.T);\n  return new SpaceTransform(this, nt);\n};\n\nproto.translate = function (domain, range) {\n  // Move transform image horizontally and vertically by example.\n  //\n  // Translate the plane so that after the translation, the domain points\n  // would be as close to given range points as possible.\n  //\n  // Parameters:\n  //   domain: array of SpacePoints\n  //   range: array of SpacePoints\n  var st = SpaceTransform.estimate(this, 'T', domain, range);\n  return new SpaceTransform(this, st.T.multiplyBy(this.T));\n};\n\nproto.scale = function (pivot, multiplierOrDomain, range) {\n  // Parameters:\n  //   pivot: a SpacePoint\n  //   multiplier: the scale factor, > 0\n  //  OR\n  //   pivot: a SpacePoint\n  //   domain: array of SpacePoints\n  //   range: array of SpacePoints\n  var useMultiplier, normPivot, domain, t, st;\n\n  useMultiplier = (typeof range === 'undefined');\n\n  if (useMultiplier) {\n    normPivot = pivot.to(this);\n    // Multiplier does not depend on plane.\n    t = this.T.scaleBy(multiplierOrDomain, normPivot.xy);\n    return new SpaceTransform(this, t);\n  } else {\n    domain = multiplierOrDomain;\n    st = SpaceTransform.estimate(this, 'S', domain, range, pivot);\n    // Combine it with the current transformation\n    t = st.T.multiplyBy(this.T);\n    return new SpaceTransform(this, t);\n  }\n};\n\nproto.rotate = function (pivot, radiansOrDomain, range) {\n  // Parameters:\n  //   pivot: a SpacePoint\n  //   radians: rotation angle\n  //  OR\n  //   pivot: a SpacePoint\n  //   domain: array of SpacePoints\n  //   range: array of SpacePoints\n  var useRadians, normPivot, domain, t, st;\n\n  useRadians = (typeof range === 'undefined');\n\n  if (useRadians) {\n    normPivot = pivot.to(this);\n    // Radians do not depend on plane.\n    t = this.T.rotateBy(radiansOrDomain, normPivot.xy);\n    return new SpaceTransform(this, t);\n  } else {\n    domain = radiansOrDomain;\n    st = SpaceTransform.estimate(this, 'R', domain, range, pivot);\n    // Combine it with the current transformation\n    t = st.T.multiplyBy(this.T);\n    return new SpaceTransform(this, t);\n  }\n};\n\nproto.translateScale = function (domain, range) {\n  // Parameters:\n  //   domain: array of SpacePoints\n  //   range: array of SpacePoints\n  var st = SpaceTransform.estimate(this, 'TS', domain, range);\n  return new SpaceTransform(this, st.T.multiplyBy(this.T));\n};\n\nproto.translateRotate = function (domain, range) {\n  // Parameters:\n  //   domain: array of SpacePoints\n  //   range: array of SpacePoints\n  var st = SpaceTransform.estimate(this, 'TR', domain, range);\n  return new SpaceTransform(this, st.T.multiplyBy(this.T));\n};\n\nproto.scaleRotate = function (pivot, domain, range) {\n  // Parameters:\n  //   pivot: SpacePoint\n  //   domain: array of SpacePoints\n  //   range: array of SpacePoints\n  var st = SpaceTransform.estimate(this, 'SR', domain, range, pivot);\n  return new SpaceTransform(this, st.T.multiplyBy(this.T));\n};\n\nproto.translateScaleRotate = function (domain, range) {\n  // Parameters:\n  //   domain: array of SpacePoints\n  //   range: array of SpacePoints\n  var st = SpaceTransform.estimate(this, 'TSR', domain, range);\n  return new SpaceTransform(this, st.T.multiplyBy(this.T));\n};\n\nSpaceTransform.estimate = function (plane, type, domain, range, pivot) {\n  // Estimate SpaceTransform.\n  //\n  // Parameters:\n  //   plane: SpacePlane, the plane of the returned SpaceTransform\n  //   types: transformation type.\n  //     Available types: T,S,R,TS,TR,SR,TSR (see nudged for further details)\n  //   domain: array of SpacePoints\n  //   range: array of SpacePoints\n  //   pivot: SpacePoint, optional pivot, used with types S,R,SR\n\n  var normPivot;\n  if (typeof pivot !== 'undefined') {\n    normPivot = SpacePoint.normalizeXY([pivot])[0];\n  }\n\n  // Allow single points\n  if (domain.hasOwnProperty('_T')) { domain = [domain]; }\n  if (range.hasOwnProperty('_T')) { range = [range]; }\n\n  // Convert all SpacePoints onto the plane and to arrays\n  var normDomain = SpacePoint.normalizeXY(domain, plane);\n  var normRange = SpacePoint.normalizeXY(range, plane);\n\n  // Then compute optimal transformation on the plane\n  var T = nudged.estimate(type, normDomain, normRange, normPivot);\n  return new SpaceTransform(plane, T);\n};\n\nmodule.exports = SpaceTransform;\n","// API v0.6.0\nvar Emitter = require('component-emitter');\nvar loadimages = require('loadimages');\n\nvar NOOP = function () {};\n\nvar Taa = function (imgSrc, onLoaded) {\n  // Parameters\n  //   imgSrc\n  //   onLoaded(err, taa)\n  //     optional, function (taa)\n  Emitter(this);\n  var this2 = this;\n\n  // onLoaded is optional\n  if (typeof onLoaded !== 'function') {\n    onLoaded = NOOP;\n  }\n\n  // This object will be replaced by a real Image object but before that\n  // src is needed in SpaceView.\n  this.image = { src: imgSrc };\n\n  // If the image is cached, the 'load' event of Image element is\n  // fired instantly when calling loadimages. If we did not care\n  // about this, the on('loaded', fn) listeners would experience\n  // different execution order depending whether the images was\n  // cached or not.\n  var notCached = false;\n\n  loadimages(imgSrc, function (err, image) {\n    var emiterr, emittaa;\n    if (err) {\n      emiterr = err;\n      emittaa = null;\n    } else {\n      this2.image = image;\n      emiterr = null;\n      emittaa = this2;\n    }\n\n    if (notCached) {\n      this2.emit('loaded', emiterr, emittaa);\n      onLoaded(emiterr, emittaa);\n    } else {\n      // Postpone emitting of the loaded event\n      setTimeout(function () {\n        this2.emit('loaded', emiterr, emittaa);\n        onLoaded(emiterr, emittaa);\n      }, 0);\n    }\n  });\n\n  notCached = true;\n};\n\nmodule.exports = Taa;\n","// API v3.0.0\n\nvar Emitter = require('component-emitter');\nvar SpaceNode = require('./SpaceNode');\nvar SpacePlane = require('./SpacePlane');\nvar SpaceTransformer = require('./SpaceTransformer');\nvar SpaceRectangle = require('./SpaceRectangle');\n\nvar SpaceTaa = function (parent, taa) {\n  // Parameters:\n  //   parent\n  //     a SpaceNode\n  //   taa\n  //     a Taa\n  Emitter(this);\n  SpaceNode(this);\n  SpacePlane(this);\n  SpaceTransformer(this);\n  SpaceRectangle(this);\n\n  this.taa = taa;\n  this.resize([256, 256]);  // Size of taa.\n\n  this.setParent(parent);\n};\n\nmodule.exports = SpaceTaa;\n","/*\n# SpaceElement\n\nA HTMLElement [1] in the space.\n\n[1] https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement\n*/\n\nvar Emitter = require('component-emitter');\nvar SpaceNode = require('./SpaceNode');\nvar SpacePlane = require('./SpacePlane');\nvar SpaceTransformer = require('./SpaceTransformer');\nvar SpaceRectangle = require('./SpaceRectangle');\n\nvar SpaceHTML = function (parent, html) {\n  // Parameters:\n  //   parent:\n  //     a SpaceNode\n  //   html:\n  //     a string, containing html\n  Emitter(this);\n  SpaceNode(this);\n  SpacePlane(this);\n  SpaceTransformer(this);\n  SpaceRectangle(this);\n\n  this.html = html;\n  this.resize([256, 256]);  // Initial element size.\n\n  this.getHTML = function () {\n    return this.html;\n  };\n\n  // Ready\n  this.setParent(parent);\n};\n\nmodule.exports = SpaceHTML;\n","// API v3.0.0\n//\n// SpacePixel\n// A simple rectangular object in space with size 1x1\n// Created for testing purposes.\n\nvar Emitter = require('component-emitter');\nvar SpaceNode = require('./SpaceNode');\nvar SpacePlane = require('./SpacePlane');\nvar SpaceTransformer = require('./SpaceTransformer');\nvar SpaceRectangle = require('./SpaceRectangle');\n\nvar SpacePixel = function (parent) {\n  // A 1x1 rectangle\n  //\n  // Parameters:\n  //   parent\n  //     a SpaceNode\n  Emitter(this);\n  SpaceNode(this);\n  SpacePlane(this);\n  SpaceTransformer(this);\n  SpaceRectangle(this);\n\n  this.resize([1, 1]);\n  this.setParent(parent);\n};\n\nmodule.exports = SpacePixel;\n","/*\nEmits\n  contentAdded\n  contentRemoved\n    not thrown if the content to remove did not exist in the first place.\n  contentTransformed\n*/\nvar Emitter = require('component-emitter');\nvar SpaceNode = require('./SpaceNode');\nvar SpacePlane = require('./SpacePlane');\n\nvar Space = function () {\n  Emitter(this);\n  SpaceNode(this);\n  SpacePlane(this);\n  // Space has constant identity transformation _T\n\n  // Remove possibility to add to parent.\n  this.setParent = function () {\n    throw new Error('Space cannot have a parent.');\n  };\n  this.remove = function () {\n    // Silent, already removed. Otherwise would throw the error in setParent\n  };\n};\n\nmodule.exports = Space;\n","/*\n\nView\n\n*/\nvar Emitter = require('component-emitter');\nvar SpaceNode = require('./SpaceNode');\nvar SpacePlane = require('./SpacePlane');\nvar SpaceTransformer = require('./SpaceTransformer');\nvar SpaceRectangle = require('./SpaceRectangle');\nvar SpaceTaa = require('./SpaceTaa');\nvar SpaceHTML = require('./SpaceHTML');\nvar Space = require('./Space');\nvar move = require('move-js');\n\n// Disable animations by default.\nmove.defaults = { duration: 0 };\n\nvar HTMLSpaceView = function (space, htmlContainer) {\n  // Test if valid space\n  if (!(space instanceof Space)) {\n    throw 'Parent of a View must be a Space.';\n  }\n  // Test if valid dom element\n  if (!('tagName' in htmlContainer)) {\n    throw 'Container should be a DOM Element';\n  }\n\n  Emitter(this);\n  SpaceNode(this);\n  SpacePlane(this);\n  SpaceTransformer(this);\n  SpaceRectangle(this);\n  var this2 = this;\n\n  this._el = htmlContainer;\n\n  // Two mappings from space taa ids:\n  // 1. to HTML elements of the space nodes.\n  // 2. to SpaceNode instances\n  // Dev decision:\n  //   For data structure, dict over list because key search time complexity.\n  this._elements = {};\n  this._nodes = {};\n\n  (function initSize() {\n    var w = this2._el.clientWidth;\n    var h = this2._el.clientHeight;\n    this2.resize([w, h]);\n  }());\n\n  var _hasNodeId = function (nodeid) {\n    return this2._elements.hasOwnProperty(nodeid);\n  };\n\n  var transformNode = function (htmlElement, spaceNode) {\n    // Transform elements because the view orientation.\n    // Special handling because now we transform HTMLElements\n    // that are parented on view, not space.\n    // See 2016-03-05-09 for math.\n    var gT = spaceNode.getGlobalTransform().T;\n    var T = this2._T.inverse().multiplyBy(gT);\n    // Current move.js does not prevent scientific notation reaching CSS\n    // which leads to problems with Safari and Opera. Therefore we must\n    // prevent the notation here.\n    // Of course this will cause error in the presentation.\n    // However the error is only in the presentation and thus not a problem.\n    var prec = 8;\n    var s = T.s.toFixed(prec);\n    var r = T.r.toFixed(prec);\n    var tx = T.tx.toFixed(prec);\n    var ty = T.ty.toFixed(prec);\n    move(htmlElement).matrix(s, r,-r, s, tx, ty).end();\n  };\n\n  var getViewSpecificId = function (spaceNodeId) {\n    // Each rendered element has own ID. The ID differs from\n    // the id of space nodes because a space node can become\n    // visualized through multiple views.\n    return this2.id + '-' + spaceNodeId;\n  };\n\n\n  // Listen the space for new or removed nodes or transformations\n\n  var transformedHandler = function (spaceNode) {\n    // Update css transformation.\n    // If the node has children, they must also be transformed\n    // because the children do not emit transformed by themselves.\n    var nodes, i, node, el;\n    nodes = spaceNode.getDescendants();\n    nodes.push(spaceNode);\n\n    for (i = 0; i < nodes.length; i += 1) {\n      node = nodes[i];\n      if (_hasNodeId(node.id)) {\n        if (node instanceof SpaceTaa) {\n          el = this2._elements[node.id];\n          transformNode(el, node);\n        } else if (node instanceof SpaceHTML) {\n          el = this2._elements[node.id];\n          transformNode(el, node);\n        }\n        // Else: no transformable representation for Views.\n      }\n    }\n  };\n\n  var resizedHandler = function (node) {\n    var el, wh;\n    if (_hasNodeId(node.id)) {\n      // Safeguard: if is a SpaceRectangle\n      if (node.hasOwnProperty('resize')) {\n        wh = node.getSize();\n        el = this2._elements[node.id];\n        el.style.width = wh[0] + 'px';\n        el.style.height = wh[1] + 'px';\n      }\n    }\n  };\n\n  var contentAddedHandler = function (spaceNode, newParent, oldParent) {\n    // Parameters:\n    //   spaceNode: a SpaceNode i.e. the content unit that was added.\n    //   newParent: optional. The new parent of the SpaceNode\n    //     Not used for anything for now but probably in the future.\n    //   oldParent: optional. The old parent of the SpaceNode.\n    //     Not used for anything for now but probably in the future.\n    if (typeof oldParent === 'undefined') { oldParent = null; }\n    if (typeof newParent === 'undefined') { newParent = null; }\n\n    var node, el, wh;\n\n    // SpaceView, SpaceTaa ...\n    node = spaceNode;\n\n    // Ensure the spaceNode is in same space. Otherwise,\n    // if view's space has been just changed, a waiting\n    // contentAdded event could add spaceNode from the old space.\n    if (spaceNode.getRootParent() !== this2.getRootParent()) {\n      return;\n    }\n\n    if (_hasNodeId(node.id)) {\n      // Content is already drawn.\n    } else {\n      if (node instanceof SpaceTaa) {\n        el = new Image(256, 256);\n        el.src = node.taa.image.src;\n        el.id = getViewSpecificId(node.id);\n        el.className = 'taaspace-taa';\n        // Show to client\n        this2._el.appendChild(el);\n        // Make referencable\n        this2._elements[node.id] = el;\n        this2._nodes[node.id] = node;\n        // Make transformation\n        transformNode(el, node);\n        // Listen to further transformations\n        node.on('transformed', transformedHandler);\n        node.on('resized', resizedHandler);\n      } else if (node instanceof SpaceHTML) {\n        // Create container div.\n        el = document.createElement('div');\n        el.innerHTML = node.html;\n        el.id = getViewSpecificId(node.id);\n        el.className = 'taaspace-html';\n        // Resize, and let taaspace styles do the rest.\n        wh = node.getSize();\n        el.style.width = wh[0] + 'px';\n        el.style.height = wh[1] + 'px';\n        // Render\n        this2._el.appendChild(el);\n        // Make referencable\n        this2._elements[node.id] = el;\n        this2._nodes[node.id] = node;\n        // Make transformation\n        transformNode(el, node);\n        // Listen to further transformations\n        node.on('transformed', transformedHandler);\n        node.on('resized', resizedHandler);\n      } else if (node instanceof HTMLSpaceView) {\n        // No representation for views.\n      } else {\n        throw new Exception('Unknown SpaceNode subtype; cannot represent');\n      }\n    }\n  };\n\n  var contentRemovedHandler = function (spaceNode, oldParent, newParent) {\n    if (typeof oldParent === 'undefined') { oldParent = null; }\n    if (typeof newParent === 'undefined') { newParent = null; }\n\n    var sameRoot, el, node;\n\n    node = spaceNode; // Alias\n\n    // Decide sameRoot\n    if (oldParent === null || newParent === null) {\n      sameRoot = false;\n    } else {\n      sameRoot = oldParent.getRootParent() === newParent.getRootParent();\n    }\n\n    if (sameRoot) {\n      // No reason to remove and then add again.\n    } else {\n      // New parent in different space, so not displayed in this view anymore.\n      if (_hasNodeId(node.id)) {\n        // Remove HTML element\n        el = this2._elements[node.id];\n        this2._el.removeChild(el);\n        // Remove from memory.\n        // JS feature of delete: does not throw if key does not exist\n        delete this2._elements[node.id];\n        delete this2._nodes[node.id];\n        // Remove handlers.\n        node.off('transformed', transformedHandler);\n        node.off('resized', resizedHandler);\n      }\n    }\n\n  };\n\n  // View added to new parent.\n  this.on('added', function (self, newSpace, oldSpace) {\n    var des, i;\n\n    if (oldSpace === newSpace) {\n      // Already set up. Do nothing.\n      return;\n    }\n\n    // Render nodes from the new space.\n    des = newSpace.getDescendants();\n    for (i = 0; i < des.length; i += 1) {\n      contentAddedHandler(des[i]);\n    }\n\n    // Start to listen for changes.\n    newSpace.on('contentAdded', contentAddedHandler);\n    newSpace.on('contentRemoved', contentRemovedHandler);\n  });\n\n  // View removed from parent.\n  this.on('removed', function (self, oldSpace, newSpace) {\n    var des, i;\n\n    if (newSpace === oldSpace) {\n      // Already set up. Do nothing.\n      return;\n    }\n\n    // Stop listening for changes.\n    oldSpace.off('contentAdded', contentAddedHandler);\n    oldSpace.off('contentRemoved', contentRemovedHandler);\n\n    // Remove all nodes from old space.\n    des = oldSpace.getDescendants();\n    for (i = 0; i < des.length; i += 1) {\n      contentRemovedHandler(des[i]);\n    }\n  });\n\n  // If the view is transformed, we of course need to retransform everything.\n  this.on('transformed', function () {\n    var id, element, node;\n    for (id in this2._elements) {\n      if (this2._elements.hasOwnProperty(id)) {\n        element  = this2._elements[id];\n        node = this2._nodes[id];\n        transformNode(element, node);\n      }\n    }\n  });\n\n  this.getElementBySpaceNode = function (spaceNode) {\n    // Get HTML element representation of the space taa.\n    // Return null if not found.\n    if (_hasNodeId(spaceNode.id)) {\n      return this._elements[spaceNode.id];\n    }\n    return null;\n  };\n\n  this.getSpaceNodeByElementId = function (id) {\n    // Get space taa by HTML element id\n    // Return null if no space taa for such id.\n    var i = id.split('-');\n    var spaceViewId = i[0];\n    var spaceNodeId = i[1];\n    if (this.id === spaceViewId) {\n      if (_hasNodeId(spaceNodeId)) {\n        return this._nodes[spaceNodeId];\n      }\n    }\n    return null;\n  };\n\n  this.getRootElement = function () {\n    // Return the container HTML element.\n    return this._el;\n  };\n\n  // Override the setParent so that only a Space\n  // is allowed to become the parent.\n  var superSetParent = this.setParent;\n  this.setParent = function (space) {\n    if (!(space instanceof Space)) {\n      throw 'A View can only be a child of a Space';\n    }\n    superSetParent.call(this, space);\n  };\n\n  // View ready to be added to Space.\n  this.setParent(space);\n};\n\nmodule.exports = HTMLSpaceView;\n","module.exports = '3.0.2';\n","/*\nAPI v3.0.0\n\nEmits\n  contentAdded\n  contentRemoved\n    not thrown if the content to remove did not exist in the first place.\n*/\nvar Emitter = require('component-emitter');\n\n// Unique ID generator. Unique over session.\n// Usage: seqid.next()\n// Return: int\nvar seqid = require('seqid')(0);\n\nvar SpaceNode = function (emitter) {\n  // Parameters\n  //   emitter, an Emitter.\n\n  // Each node has an id. That is used by the parent nodes and in views.\n  emitter.id = seqid.next().toString();\n\n  // Nodes with null parent are root nodes i.e. spaces.\n  // SpaceNode#remove sets _parent to null.\n  emitter._parent = null;\n\n  // Dict over list because key search time complexity\n  emitter._children = {};\n\n  // We need to store built handlers bound to children\n  // to be able to remove the handlers when child is removed.\n  emitter._addedHandlers = {};\n  emitter._removedHandlers = {};\n\n  emitter.getChildren = function () {\n    // Return child SpaceNodes in a list.\n    // Does not include the children of the children.\n    var id, arr, obj;\n    arr = [];\n    obj = this._children;\n    for (id in obj) {\n      arr.push(obj[id]);\n    }\n    return arr;\n  };\n\n  emitter.getDescendants = function () {\n    // All descendants in a list, including the children.\n    var i, children, child, arr;\n    arr = [];\n    children = this.getChildren();\n    for (i = 0; i < children.length; i += 1) {\n      child = children[i];\n      arr = arr.concat(child, child.getDescendants());\n    }\n    return arr;\n  };\n\n  emitter.getParent = function () {\n    return this._parent;\n  };\n\n  emitter.getRootParent = function () {\n    // Get the predecessor without parents in recursive manner.\n    if (this._parent === null) {\n      return this;\n    }  // else\n    return this._parent.getRootParent();\n  };\n\n  emitter.hasChild = function (spaceNode) {\n    // Return\n    //   true if spaceNode is a child of this.\n    return spaceNode._parent === this;\n  };\n\n  emitter.hasDescendant = function (spaceNode) {\n    // Return\n    //   true if spaceNode is a descendant of this.\n    var p = spaceNode._parent;\n    while (p !== null && p !== this) {\n      p = p._parent;\n    }\n    if (p === null) {\n      return false;\n    }  // else\n    return true;\n  };\n\n  emitter.remove = function () {\n    // Remove this space node from its parent.\n    // Return: see setParent\n    return this.setParent(null);\n  };\n\n  emitter.setParent = function (newParent) {\n    // Add to new parent.\n\n    // Dev note about cyclic relationship detection:\n    //   A\n    //   |\n    //  / \\\n    // B   C\n    //\n    // Different cases. The emitter relationship status changes...\n    //   from root to root:\n    //     no worries about cyclic structures\n    //   from root to child:\n    //     If the new parent is a descendant of the emitter, problems.\n    //     If the new parent the emitter itself, problems.\n    //   from child to root:\n    //     Loses parenthood. No cyclic worries.\n    //   from child to child:\n    //     If the new parent is a descendant of the emitter, problems.\n    //     If the new parent the emitter itself, problems.\n    // If new parent has the emitter as descendant already...\n    //   then no worries because emitter would only create a new branch.\n\n    var oldParent = this._parent;\n\n    if (oldParent === null) {\n      if (newParent === null) {\n        // From root to root.\n        // Do nothing\n      } else {\n        // From root to child.\n        // Prevent cycles.\n        if (this === newParent || this.hasDescendant(newParent)) {\n          throw new Error('Cyclic parent-child relationships are forbidden.');\n        }\n        this._parent = newParent;\n        this._parent._addChild(this);\n        this.emit('added', this, this._parent, null);\n        newParent.emit('contentAdded', this, this._parent, null);\n      }\n    } else {\n      if (newParent === null) {\n        // From child to root.\n        this._parent = null;  // Becomes new root node.\n        oldParent._removeChild(this);\n        this.emit('removed', this, oldParent, null);\n        oldParent.emit('contentRemoved', this, oldParent, null);\n      } else {\n        // From child to child.\n        // Prevent cycles.\n        if (this === newParent || this.hasDescendant(newParent)) {\n          throw new Error('Cyclic parent-child relationships are forbidden.');\n        }\n        this._parent = newParent;\n        oldParent._removeChild(this);\n        newParent._addChild(this);\n        this.emit('removed', this, oldParent, newParent);\n        this.emit('added', this, newParent, oldParent);\n        // With both oldParent and newParent, SpaceView is able to\n        // decide whether to keep same HTMLElement or recreate it.\n        oldParent.emit('contentRemoved', this, oldParent, newParent);\n        newParent.emit('contentAdded', this, newParent, oldParent);\n      }\n    }\n\n  };\n\n  emitter._addChild = function (child) {\n    // To be called from child.setParent().\n    // If called from anywhere else, ensure cyclic relationships are detected.\n    //\n    // Parameters\n    //   child, A SpaceNode\n    //\n    // Return\n    //   undefined\n    //\n    // Dev. note:\n    //   Previously this was called from the SpaceNode constructor.\n    //   However, because SpaceNode upgrade is done before other\n    //   upgrades, the child would not be ready to be added to parent.\n\n    var sc = child; // alias\n    var self = this;\n\n    this._children[sc.id] = sc;\n\n    // Start to listen if child has beed added, removed or transformed\n    var addedHandler = function (a, b, c) {\n      self.emit('contentAdded', a, b, c);\n    };\n    var removedHandler = function (a, b, c) {\n      self.emit('contentRemoved', a, b, c);\n    };\n    // added and removed events are not listened because\n    // for after successfully made add or remove,\n    // contentAdded and contentRemoved are fired in setParent.\n    sc.on('contentAdded', addedHandler);\n    sc.on('contentRemoved', removedHandler);\n    this._addedHandlers[sc.id] = addedHandler;\n    this._removedHandlers[sc.id] = removedHandler;\n  };\n\n  emitter._removeChild = function (child) {\n    // To be called from SpaceNode#remove\n    // Precondition: child in space\n    var sc, h;\n\n    sc = child; // alias\n    delete this._children[sc.id];\n\n    // Remove handlers\n    h = this._addedHandlers[sc.id];\n    delete this._addedHandlers[sc.id];\n    sc.off('contentAdded', h);\n\n    h = this._removedHandlers[sc.id];\n    delete this._removedHandlers[sc.id];\n    sc.off('contentRemoved', h);\n  };\n};\n\nmodule.exports = SpaceNode;\n","/*\nSpacePlane\nAPI v3.0.0\n\nA SpacePlane represents a coordinate system. It does not include\nmethods to transform the system. SpacePlane and SpaceTransformer are separated\nbecause we want to have planes that cannot be transformed, as the Space.\n\n*/\n\nvar nudged = require('nudged');\nvar SpacePoint = require('./SpacePoint');\nvar SpaceTransform = require('./SpaceTransform');\n\nvar at = function (xy) {\n  // Return\n  //   A SpacePoint at (x,y) on the plane.\n  if (xy.length !== 2) {  // DEBUG TODO remove this\n    throw 'Invalid point, use array [x, y]';\n  }\n  return new SpacePoint(this, xy);  // Note: this === spaceNode\n};\n\nvar SpacePlane = function (spaceNode) {\n  // Parameters\n  //   spaceNode\n  //     A SpaceNode to monkey patch to SpacePlane\n\n  // Coordinate transformation.\n  // The transformation from the plane to the parent (space).\n  // See 2016-03-05-09\n  // Let:\n  //   x_space, a point in space\n  //   x_plane, a point on the plane.\n  //   T, the coordinate transformation of the plane\n  // Then:\n  //   x_space = T * x_plane\n  //\n  // For Space, it is obviously the identity transform:\n  //   x_space = T * x_space\n  spaceNode._T = nudged.Transform.IDENTITY; // identity transformation\n\n  spaceNode.at = at;\n\n  spaceNode.getLocalTransform = function () {\n    // Local coordinate transform from plane to parent,\n    // represented as SpaceTransform on the plane.\n    //\n    // Return\n    //   SpaceTransform\n    //\n    // Note:\n    //   return transformation from plane to parent, i.e.\n    //     xy_parent = T * xy_plane\n    // Needed when we want to store transformer's position for later use.\n    if (this._parent === null) {\n      return new SpaceTransform(this);\n    } // else\n    return new SpaceTransform(this, this._T);\n    // An alternative would have been to graft to the parent's coords:\n    //   return new SpaceTransform(this._parent, this._T);\n    // This is kind of equivalent because:\n    //   this_T_on_plane = this_T * this_T * inv(this_T) = this_T\n    // However, it is more natural if getLocalTransform is represented on\n    // the local coord system.\n  };\n\n  spaceNode.getGlobalTransform = function () {\n    // Return:\n    //   SpaceTransform\n    //     Transformation from the plane to root.\n    //     Represented on the root.\n    //\n    // Dev note:\n    //   Local transformations go like:\n    //     xy_parent = T_plane * xy_plane\n    //     xy_parent_parent = T_parent * xy_parent\n    //     ...\n    //     xy_root = T_parent_parent..._parent * xy_parent_parent..._parent\n    //   Therefore global transformation is:\n    //     xy_root = T_parent_..._parent * ... * T_parent * T_plane * xy_plane\n    var T, plane;\n\n    if (this._parent === null) {\n      // We must mock the space. Otherwise, if we put self to\n      // SpaceTransform as reference, SpaceTransform constructor\n      // will ask for self.getGlobalTransform and thus we end up\n      // in a endless loop.\n      plane = { _T: nudged.Transform.IDENTITY };\n      return new SpaceTransform(plane);  // We are root, thus identity\n    } // else\n\n    T = this._T;\n    plane = this._parent;\n    while (plane._parent !== null) {\n      T = plane._T.multiplyBy(T);\n      plane = plane._parent;\n    }\n\n    // plane._parent === null, hence plane is the root.\n    return new SpaceTransform(plane, T);\n  };\n\n  spaceNode.resetTransform = function () {\n    // Become space. Called e.g. when plane is removed from parent.\n    this._T = nudged.Transform.IDENTITY;\n  };\n\n};\n\nmodule.exports = SpacePlane;\n","// API v3.0.0\nvar nudged = require('nudged');\nvar Transform = require('./Transform');\nvar SpacePoint = require('./SpacePoint');\nvar SpaceTransform = require('./SpaceTransform');\n\n\nvar SpaceTransformer = function (plane) {\n  // Upgrades SpacePlane to SpaceTransformer\n  //\n  // Parameters\n  //   plane\n  //     a SpacePlane\n\n  plane.setLocalTransform = function (spaceTransform) {\n    // Transform the plane so that it would be equivalent to\n    // transform plane from initial position by the SpaceTransform.\n    //\n    // This method is needed when we whan to restore stored position,\n    // maybe after modification.\n\n    // If we are root, cannot set.\n    if (this._parent === null) { return; }\n\n    this._T = spaceTransform.to(this._parent).T;\n    this.emit('transformed', this);\n  };\n\n  plane.setGlobalTransform = function (spaceTransform) {\n    // Set local transform so that the global transform becomes equal to\n    // the given SpaceTransform.\n    //\n    // Dev note:\n    //   Given T is coord. transf. from the plane to root (space).\n    //   So is this._T.\n    //   current_glob_trans = parent_glob_trans * this_T\n    //   new_glob_trans = parent_glob_trans * X\n    //   <=> X = inv(parent_glob_trans) * new_glob_trans\n\n    // If we are root, cannot set.\n    if (this._parent === null) { return; }\n\n    var parent_gt = this._parent.getGlobalTransform().T;\n    var new_gt = spaceTransform.toSpace().T;\n    this._T = parent_gt.inverse().multiplyBy(new_gt);\n    this.emit('transformed', this);\n  };\n\n  plane.transformBy = function (spaceTransform) {\n    // Apply a SpaceTransform to the node.\n    // Root nodes cannot be transformed.\n\n    if (this._parent === null) {\n      // We are root, cannot set.\n      return;\n    }\n    // Convert on parent plane so we can multiply.\n    var normST = spaceTransform.to(this._parent);\n    this._T = normST.T.multiplyBy(this._T);\n    this.emit('transformed', this);\n  };\n\n  plane.translate = function (domain, range) {\n    // Move plane horizontally and vertically by example.\n    //\n    // Translate the plane so that after the translation, the domain points\n    // would be as close to given range points as possible.\n    //\n    // Parameters: see SpaceTransform.prototype.translate\n    var st = SpaceTransform.estimate(this, 'T', domain, range);\n    this.transformBy(st);\n  };\n\n  plane.scale = function (pivot, multiplierOrDomain, range) {\n    // Parameters: see SpaceTransform.prototype.scale\n    var st = new SpaceTransform(this).scale(pivot, multiplierOrDomain, range);\n    this.transformBy(st);\n  };\n\n  plane.rotate = function (pivot, radiansOrDomain, range) {\n    // Parameters: see SpaceTransform.prototype.rotate\n    var st = new SpaceTransform(this).rotate(pivot, radiansOrDomain, range);\n    this.transformBy(st);\n  };\n\n  plane.translateScale = function (domain, range) {\n    // Parameters: see SpaceTransform.prototype.translateScale\n    var st = SpaceTransform.estimate(this, 'TS', domain, range);\n    this.transformBy(st);\n  };\n\n  plane.translateRotate = function (domain, range) {\n    // Parameters: see SpaceTransform.prototype.translateRotate\n    var st = SpaceTransform.estimate(this, 'TR', domain, range);\n    this.transformBy(st);\n  };\n\n  plane.scaleRotate = function (pivot, domain, range) {\n    // Parameters: see SpaceTransform.prototype.scaleRotate\n    var st = SpaceTransform.estimate(this, 'SR', domain, range, pivot);\n    this.transformBy(st);\n  };\n\n  plane.translateScaleRotate = function (domain, range) {\n    // Parameters: see SpaceTransform.prototype.translateScaleRotate\n    var st = SpaceTransform.estimate(this, 'TSR', domain, range);\n    this.transformBy(st);\n  };\n\n  // plane.translateAndScaleToFit, not sure if necessary for now\n\n  plane.on('removed', function (self, oldParent, newParent) {\n    // Maintain global location.\n    // Why? To make it easy to attach to view temporarily.\n    // On the other hand, same relative location would be convenient\n    // when moving subelements from group to another.\n    // Would it be easier to do explicitly:\n    //   gt = taa.getGlobalTransform()\n    //   taa.setParent(foo)\n    //   taa.setGlobalTransform(gt)\n    // Yes it would. Therefore, do not maintain global location!\n\n    if (typeof oldParent === 'undefined') { oldParent = null; }\n    if (typeof newParent === 'undefined') { newParent = null; }\n\n    if (newParent === null) {\n      // Root nodes cannot move.\n      self.resetTransform();\n    } else {\n      // Assert: removed from null parent?\n      if (oldParent === null) {\n        throw new Error('Cannot remove from null parent');\n      }\n    }\n\n    // Reparenting probably changes the global transform.\n    this.emit('transformed', self);\n  });\n};\n\nmodule.exports = SpaceTransformer;\n","// API v3.0.0\n\nvar SpacePoint = require('./SpacePoint');\n\nvar SpaceRectangle = function (spaceTransformer) {\n\n  var t = spaceTransformer;  // Alias\n\n  // Rectangles have size.\n  // In its own coordinates, rectangle's right bottom corner\n  // is located at [width, height].\n  // By default transformation, width 1 and height 1 equal to 1 space unit.\n  var width = 1;\n  var height = 1;\n\n  t.atNorm = function (xy) {\n    // Return a SpacePoint by coordinates normalized about the size.\n    // atNorm([1,0]) returns the point at the right upper corner.\n    return new SpacePoint(t, [width * xy[0], height * xy[1]]);\n  };\n\n  t.atMid = function () {\n    return new SpacePoint(t, [width / 2, height / 2]);\n  };\n\n  t.atMidN = function () {\n    return new SpacePoint(t, [width / 2, 0]);\n  };\n\n  t.atMidW = function () {\n    return new SpacePoint(t, [0, height / 2]);\n  };\n\n  t.atMidE = function () {\n    return new SpacePoint(t, [width, height / 2]);\n  };\n\n  t.atMidS = function () {\n    return new SpacePoint(t, [width / 2, height]);\n  };\n\n  t.atNW = function () {\n    return new SpacePoint(t, [0, 0]);\n  };\n\n  t.atNE = function () {\n    return new SpacePoint(t, [width, 0]);\n  };\n\n  t.atSW = function () {\n    return new SpacePoint(t, [0, height]);\n  };\n\n  t.atSE = function () {\n    return new SpacePoint(t, [width, height]);\n  };\n\n  t.getSize = function () {\n    return [width, height];\n  };\n\n  t.resize = function (dimensions) {\n    // Parameter\n    //   dimensions, [width, height]\n    width = dimensions[0];\n    height = dimensions[1];\n\n    this.emit('resized', t);\n  };\n\n};\n\nmodule.exports = SpaceRectangle;\n","\r\n/**\r\n * Expose `Emitter`.\r\n */\r\n\r\nif (typeof module !== 'undefined') {\r\n  module.exports = Emitter;\r\n}\r\n\r\n/**\r\n * Initialize a new `Emitter`.\r\n *\r\n * @api public\r\n */\r\n\r\nfunction Emitter(obj) {\r\n  if (obj) return mixin(obj);\r\n};\r\n\r\n/**\r\n * Mixin the emitter properties.\r\n *\r\n * @param {Object} obj\r\n * @return {Object}\r\n * @api private\r\n */\r\n\r\nfunction mixin(obj) {\r\n  for (var key in Emitter.prototype) {\r\n    obj[key] = Emitter.prototype[key];\r\n  }\r\n  return obj;\r\n}\r\n\r\n/**\r\n * Listen on the given `event` with `fn`.\r\n *\r\n * @param {String} event\r\n * @param {Function} fn\r\n * @return {Emitter}\r\n * @api public\r\n */\r\n\r\nEmitter.prototype.on =\r\nEmitter.prototype.addEventListener = function(event, fn){\r\n  this._callbacks = this._callbacks || {};\r\n  (this._callbacks['$' + event] = this._callbacks['$' + event] || [])\r\n    .push(fn);\r\n  return this;\r\n};\r\n\r\n/**\r\n * Adds an `event` listener that will be invoked a single\r\n * time then automatically removed.\r\n *\r\n * @param {String} event\r\n * @param {Function} fn\r\n * @return {Emitter}\r\n * @api public\r\n */\r\n\r\nEmitter.prototype.once = function(event, fn){\r\n  function on() {\r\n    this.off(event, on);\r\n    fn.apply(this, arguments);\r\n  }\r\n\r\n  on.fn = fn;\r\n  this.on(event, on);\r\n  return this;\r\n};\r\n\r\n/**\r\n * Remove the given callback for `event` or all\r\n * registered callbacks.\r\n *\r\n * @param {String} event\r\n * @param {Function} fn\r\n * @return {Emitter}\r\n * @api public\r\n */\r\n\r\nEmitter.prototype.off =\r\nEmitter.prototype.removeListener =\r\nEmitter.prototype.removeAllListeners =\r\nEmitter.prototype.removeEventListener = function(event, fn){\r\n  this._callbacks = this._callbacks || {};\r\n\r\n  // all\r\n  if (0 == arguments.length) {\r\n    this._callbacks = {};\r\n    return this;\r\n  }\r\n\r\n  // specific event\r\n  var callbacks = this._callbacks['$' + event];\r\n  if (!callbacks) return this;\r\n\r\n  // remove all handlers\r\n  if (1 == arguments.length) {\r\n    delete this._callbacks['$' + event];\r\n    return this;\r\n  }\r\n\r\n  // remove specific handler\r\n  var cb;\r\n  for (var i = 0; i < callbacks.length; i++) {\r\n    cb = callbacks[i];\r\n    if (cb === fn || cb.fn === fn) {\r\n      callbacks.splice(i, 1);\r\n      break;\r\n    }\r\n  }\r\n  return this;\r\n};\r\n\r\n/**\r\n * Emit `event` with the given args.\r\n *\r\n * @param {String} event\r\n * @param {Mixed} ...\r\n * @return {Emitter}\r\n */\r\n\r\nEmitter.prototype.emit = function(event){\r\n  this._callbacks = this._callbacks || {};\r\n  var args = [].slice.call(arguments, 1)\r\n    , callbacks = this._callbacks['$' + event];\r\n\r\n  if (callbacks) {\r\n    callbacks = callbacks.slice(0);\r\n    for (var i = 0, len = callbacks.length; i < len; ++i) {\r\n      callbacks[i].apply(this, args);\r\n    }\r\n  }\r\n\r\n  return this;\r\n};\r\n\r\n/**\r\n * Return array of callbacks for `event`.\r\n *\r\n * @param {String} event\r\n * @return {Array}\r\n * @api public\r\n */\r\n\r\nEmitter.prototype.listeners = function(event){\r\n  this._callbacks = this._callbacks || {};\r\n  return this._callbacks['$' + event] || [];\r\n};\r\n\r\n/**\r\n * Check if this emitter has `event` handlers.\r\n *\r\n * @param {String} event\r\n * @return {Boolean}\r\n * @api public\r\n */\r\n\r\nEmitter.prototype.hasListeners = function(event){\r\n  return !! this.listeners(event).length;\r\n};\r\n","/*\n\n*/\nexports.Transform = require('./lib/Transform');\nexports.estimateT = require('./lib/estimateT');\nexports.estimateS = require('./lib/estimateS');\nexports.estimateR = require('./lib/estimateR');\nexports.estimateTS = require('./lib/estimateTS');\nexports.estimateTR = require('./lib/estimateTR');\nexports.estimateSR = require('./lib/estimateSR');\nexports.estimateTSR = require('./lib/estimateTSR');\nexports.version = require('./lib/version');\n\nexports.estimate = function (type, domain, range, pivot) {\n  // Parameter\n  //   type\n  //     string. One of the following: 'T', 'S', 'R', 'TS', 'TR', 'SR', 'TSR'\n  //   domain\n  //     array of 2d arrays\n  //   range\n  //     array of 2d arrays\n  //   pivot\n  //     optional 2d array, does nothing for translation estimators\n  var name = 'estimate' + type.toUpperCase();\n  if (exports.hasOwnProperty(name)) {\n    return exports[name](domain, range, pivot);\n  } // else\n  throw new Error('Unknown estimator type: ' + type);\n};\n","module.exports = function loadimages(imgSrcs, then) {\n  // Parameters\n  //   imgSrcs\n  //     array of image source paths OR single source path string.\n  //   then(err, imgElements)\n  //     Will be called after all the images are loaded. If string was given,\n  //     imgElements is an Image instead of array of Images.\n\n  var numberOfImages, stringGiven, thereWasSuccess, thereWasError, imgs;\n  var onloadsCalled, onload, onerror;\n\n  if (typeof then !== 'function') {\n    throw new Error('callback should be a function: ' + then);\n  }\n\n  if (typeof imgSrcs === 'string') {\n    numberOfImages = 1;\n    stringGiven = true;\n    imgSrcs = [imgSrcs]; // Normalize\n  } else {\n    // Array of images\n    numberOfImages = imgSrcs.length;\n    stringGiven = false;\n  }\n  thereWasSuccess = false;\n  thereWasError = false;\n\n  imgs = [];\n\n  onloadsCalled = 0;\n  onload = function () {\n    // Note:\n    //   this = Image\n    if (!thereWasError) {\n      onloadsCalled += 1;\n      var isFinalImage = (onloadsCalled === numberOfImages);\n      if (isFinalImage) {\n        thereWasSuccess = true;\n        if (stringGiven) {\n          then(null, imgs[0]);\n        } else {\n          then(null, imgs);\n        }\n      }\n    }\n  };\n\n  onerror = function (errMsg) {\n    // Note:\n    //   this = Image\n\n    // No errors after success.\n    if (!thereWasSuccess) {\n      thereWasError = true;\n      then(errMsg, null);\n    }\n\n    // Prevent firing the default event handler\n    // https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers.onerror#Parameters\n    return true;\n  };\n\n  for (i = 0; i < imgSrcs.length; i += 1) {\n    imgs.push(new Image());\n    imgs[i].onload = onload;\n    imgs[i].onerror = onerror;\n    imgs[i].src = imgSrcs[i];\n  }\n};\n","// Patch IE9 and below\ntry {\n  document.createElement('DIV').style.setProperty('opacity', 0, '');\n} catch (error) {\n  CSSStyleDeclaration.prototype.getProperty = function(a) {\n    return this.getAttribute(a);\n  };\n  \n  CSSStyleDeclaration.prototype.setProperty = function(a,b) {\n    return this.setAttribute(a, b + '');\n  };\n\n  CSSStyleDeclaration.prototype.removeProperty = function(a) {\n    return this.removeAttribute(a);\n  };\n}\n\n/**\n * Module Dependencies.\n */\n\nvar Emitter = require('component-emitter');\nvar query = require('component-query');\nvar after = require('after-transition');\nvar has3d = require('has-translate3d');\nvar ease = require('css-ease');\n\n/**\n * CSS Translate\n */\n\nvar translate = has3d\n  ? ['translate3d(', ', 0)']\n  : ['translate(', ')'];\n\n\n/**\n * Export `Move`\n */\n\nmodule.exports = Move;\n\n/**\n * Get computed style.\n */\n\nvar style = window.getComputedStyle\n  || window.currentStyle;\n\n/**\n * Library version.\n */\n\nMove.version = '0.5.0';\n\n/**\n * Export `ease`\n */\n\nMove.ease = ease;\n\n/**\n * Defaults.\n *\n *   `duration` - default duration of 500ms\n *\n */\n\nMove.defaults = {\n  duration: 500\n};\n\n/**\n * Default element selection utilized by `move(selector)`.\n *\n * Override to implement your own selection, for example\n * with jQuery one might write:\n *\n *     move.select = function(selector) {\n *       return jQuery(selector).get(0);\n *     };\n *\n * @param {Object|String} selector\n * @return {Element}\n * @api public\n */\n\nMove.select = function(selector){\n  if ('string' != typeof selector) return selector;\n  return query(selector);\n};\n\n/**\n * Initialize a new `Move` with the given `el`.\n *\n * @param {Element} el\n * @api public\n */\n\nfunction Move(el) {\n  if (!(this instanceof Move)) return new Move(el);\n  if ('string' == typeof el) el = query(el);\n  if (!el) throw new TypeError('Move must be initialized with element or selector');\n  this.el = el;\n  this._props = {};\n  this._rotate = 0;\n  this._transitionProps = [];\n  this._transforms = [];\n  this.duration(Move.defaults.duration)\n};\n\n\n/**\n * Inherit from `EventEmitter.prototype`.\n */\n\nEmitter(Move.prototype);\n\n/**\n * Buffer `transform`.\n *\n * @param {String} transform\n * @return {Move} for chaining\n * @api private\n */\n\nMove.prototype.transform = function(transform){\n  this._transforms.push(transform);\n  return this;\n};\n\n/**\n * Skew `x` and `y`.\n *\n * @param {Number} x\n * @param {Number} y\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.skew = function(x, y){\n  return this.transform('skew('\n    + x + 'deg, '\n    + (y || 0)\n    + 'deg)');\n};\n\n/**\n * Skew x by `n`.\n *\n * @param {Number} n\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.skewX = function(n){\n  return this.transform('skewX(' + n + 'deg)');\n};\n\n/**\n * Skew y by `n`.\n *\n * @param {Number} n\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.skewY = function(n){\n  return this.transform('skewY(' + n + 'deg)');\n};\n\n/**\n * Translate `x` and `y` axis.\n *\n * @param {Number|String} x\n * @param {Number|String} y\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.translate =\nMove.prototype.to = function(x, y){\n  return this.transform(translate.join(''\n    + fixUnits(x) + ', '\n    + fixUnits(y || 0)));\n};\n\n/**\n * Translate on the x axis to `n`.\n *\n * @param {Number|String} n\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.translateX =\nMove.prototype.x = function(n){\n  return this.transform('translateX(' + fixUnits(n) + ')');\n};\n\n/**\n * Translate on the y axis to `n`.\n *\n * @param {Number|String} n\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.translateY =\nMove.prototype.y = function(n){\n  return this.transform('translateY(' + fixUnits(n) + ')');\n};\n\n/**\n * Scale the x and y axis by `x`, or\n * individually scale `x` and `y`.\n *\n * @param {Number} x\n * @param {Number} y\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.scale = function(x, y){\n  return this.transform('scale('\n    + x + ', '\n    + (y || x)\n    + ')');\n};\n\n/**\n * Scale x axis by `n`.\n *\n * @param {Number} n\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.scaleX = function(n){\n  return this.transform('scaleX(' + n + ')')\n};\n\n/**\n * Apply a matrix transformation\n *\n * @param {Number} m11 A matrix coefficient\n * @param {Number} m12 A matrix coefficient\n * @param {Number} m21 A matrix coefficient\n * @param {Number} m22 A matrix coefficient\n * @param {Number} m31 A matrix coefficient\n * @param {Number} m32 A matrix coefficient\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.matrix = function(m11, m12, m21, m22, m31, m32){\n  return this.transform('matrix(' + [m11,m12,m21,m22,m31,m32].join(',') + ')');\n};\n\n/**\n * Scale y axis by `n`.\n *\n * @param {Number} n\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.scaleY = function(n){\n  return this.transform('scaleY(' + n + ')')\n};\n\n/**\n * Rotate `n` degrees.\n *\n * @param {Number} n\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.rotate = function(n){\n  return this.transform('rotate(' + n + 'deg)');\n};\n\n/**\n * Set transition easing function to to `fn` string.\n *\n * When:\n *\n *   - null \"ease\" is used\n *   - \"in\" \"ease-in\" is used\n *   - \"out\" \"ease-out\" is used\n *   - \"in-out\" \"ease-in-out\" is used\n *\n * @param {String} fn\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.ease = function(fn){\n  fn = ease[fn] || fn || 'ease';\n  return this.setVendorProperty('transition-timing-function', fn);\n};\n\n/**\n * Set animation properties\n *\n * @param {String} name\n * @param {Object} props\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.animate = function(name, props){\n  for (var i in props){\n    if (props.hasOwnProperty(i)){\n      this.setVendorProperty('animation-' + i, props[i])\n    }\n  }\n  return this.setVendorProperty('animation-name', name);\n}\n\n/**\n * Set duration to `n`.\n *\n * @param {Number|String} n\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.duration = function(n){\n  n = this._duration = 'string' == typeof n\n    ? parseFloat(n) * 1000\n    : n;\n  return this.setVendorProperty('transition-duration', n + 'ms');\n};\n\n/**\n * Delay the animation by `n`.\n *\n * @param {Number|String} n\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.delay = function(n){\n  n = 'string' == typeof n\n    ? parseFloat(n) * 1000\n    : n;\n  return this.setVendorProperty('transition-delay', n + 'ms');\n};\n\n/**\n * Set `prop` to `val`, deferred until `.end()` is invoked.\n *\n * @param {String} prop\n * @param {String} val\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.setProperty = function(prop, val){\n  this._props[prop] = val;\n  return this;\n};\n\n/**\n * Set a vendor prefixed `prop` with the given `val`.\n *\n * @param {String} prop\n * @param {String} val\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.setVendorProperty = function(prop, val){\n  this.setProperty('-webkit-' + prop, val);\n  this.setProperty('-moz-' + prop, val);\n  this.setProperty('-ms-' + prop, val);\n  this.setProperty('-o-' + prop, val);\n  return this;\n};\n\n/**\n * Set `prop` to `value`, deferred until `.end()` is invoked\n * and adds the property to the list of transition props.\n *\n * @param {String} prop\n * @param {String} val\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.set = function(prop, val){\n  this.transition(prop);\n  this._props[prop] = val;\n  return this;\n};\n\n/**\n * Increment `prop` by `val`, deferred until `.end()` is invoked\n * and adds the property to the list of transition props.\n *\n * @param {String} prop\n * @param {Number} val\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.add = function(prop, val){\n  if (!style) return;\n  var self = this;\n  return this.on('start', function(){\n    var curr = parseInt(self.current(prop), 10);\n    self.set(prop, curr + val + 'px');\n  });\n};\n\n/**\n * Decrement `prop` by `val`, deferred until `.end()` is invoked\n * and adds the property to the list of transition props.\n *\n * @param {String} prop\n * @param {Number} val\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.sub = function(prop, val){\n  if (!style) return;\n  var self = this;\n  return this.on('start', function(){\n    var curr = parseInt(self.current(prop), 10);\n    self.set(prop, curr - val + 'px');\n  });\n};\n\n/**\n * Get computed or \"current\" value of `prop`.\n *\n * @param {String} prop\n * @return {String}\n * @api public\n */\n\nMove.prototype.current = function(prop){\n  return style(this.el).getPropertyValue(prop);\n};\n\n/**\n * Add `prop` to the list of internal transition properties.\n *\n * @param {String} prop\n * @return {Move} for chaining\n * @api private\n */\n\nMove.prototype.transition = function(prop){\n  if (!this._transitionProps.indexOf(prop)) return this;\n  this._transitionProps.push(prop);\n  return this;\n};\n\n/**\n * Commit style properties, aka apply them to `el.style`.\n *\n * @return {Move} for chaining\n * @see Move#end()\n * @api private\n */\n\nMove.prototype.applyProperties = function(){\n  for (var prop in this._props) {\n    this.el.style.setProperty(prop, this._props[prop], '');\n  }\n  return this;\n};\n\n/**\n * Re-select element via `selector`, replacing\n * the current element.\n *\n * @param {String} selector\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.move =\nMove.prototype.select = function(selector){\n  this.el = Move.select(selector);\n  return this;\n};\n\n/**\n * Defer the given `fn` until the animation\n * is complete. `fn` may be one of the following:\n *\n *   - a function to invoke\n *   - an instanceof `Move` to call `.end()`\n *   - nothing, to return a clone of this `Move` instance for chaining\n *\n * @param {Function|Move} fn\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.then = function(fn){\n  // invoke .end()\n  if (fn instanceof Move) {\n    this.on('end', function(){\n      fn.end();\n    });\n  // callback\n  } else if ('function' == typeof fn) {\n    this.on('end', fn);\n  // chain\n  } else {\n    var clone = new Move(this.el);\n    clone._transforms = this._transforms.slice(0);\n    this.then(clone);\n    clone.parent = this;\n    return clone;\n  }\n\n  return this;\n};\n\n/**\n * Pop the move context.\n *\n * @return {Move} parent Move\n * @api public\n */\n\nMove.prototype.pop = function(){\n  return this.parent;\n};\n\n/**\n * Reset duration.\n *\n * @return {Move}\n * @api public\n */\n\nMove.prototype.reset = function(){\n  this.el.style.webkitTransitionDuration =\n  this.el.style.mozTransitionDuration =\n  this.el.style.msTransitionDuration =\n  this.el.style.oTransitionDuration = '';\n  return this;\n};\n\n/**\n * Start animation, optionally calling `fn` when complete.\n *\n * @param {Function} fn\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.end = function(fn){\n  var self = this;\n\n  // emit \"start\" event\n  this.emit('start');\n\n  // transforms\n  if (this._transforms.length) {\n    this.setVendorProperty('transform', this._transforms.join(' '));\n  }\n\n  // transition properties\n  this.setVendorProperty('transition-properties', this._transitionProps.join(', '));\n  this.applyProperties();\n\n  // callback given\n  if (fn) this.then(fn);\n\n  // emit \"end\" when complete\n  after.once(this.el, function(){\n    self.reset();\n    self.emit('end');\n  });\n\n  return this;\n};\n\n/**\n * Fix value units\n *\n * @param {Number|String} val\n * @return {String}\n * @api private\n */\n\nfunction fixUnits(val) {\n  return 'string' === typeof val && isNaN(+val) ? val : val + 'px';\n}\n","var Transform = require('./Transform');\n\nmodule.exports = function (domain, range, pivot) {\n  var i, N, D, a0, b0, a, b, c, d, ac, bd, aa, bb, shat, tx, ty;\n\n  N = Math.min(domain.length, range.length);\n  ac = bd = aa = bb = 0;\n\n  if (typeof pivot === 'undefined') {\n    a0 = b0 = 0;\n  } else {\n    a0 = pivot[0];\n    b0 = pivot[1];\n  }\n\n  for (i = 0; i < N; i += 1) {\n    a = domain[i][0] - a0;\n    b = domain[i][1] - b0;\n    c = range[i][0] - a0;\n    d = range[i][1] - b0;\n    ac += a * c;\n    bd += b * d;\n    aa += a * a;\n    bb += b * b;\n  }\n\n  D = aa + bb;\n\n  if (D === 0) {\n    // All domain points equal the pivot.\n    // Identity transform is then only solution.\n    // D === 0 also if N === 0.\n    // Assume identity transform to be the best guess\n    return Transform.IDENTITY;\n  }\n\n  // Prevent negative scaling because it would be same as positive scaling\n  // and rotation => limit to zero\n  shat = Math.max(0, (ac + bd) / D);\n  tx = (1 - shat) * a0;\n  ty = (1 - shat) * b0;\n\n  return new Transform(shat, 0, tx, ty);\n};\n","var Transform = require('./Transform');\n\nmodule.exports = function (domain, range, pivot) {\n  var i, N, D, a0, b0, a, b, c, d, ac, ad, bc, bd, shat, rhat, tx, ty;\n\n  N = Math.min(domain.length, range.length);\n  ac = ad = bc = bd = 0;\n\n  if (typeof pivot === 'undefined') {\n    a0 = b0 = 0;\n  } else {\n    a0 = pivot[0];\n    b0 = pivot[1];\n  }\n\n  for (i = 0; i < N; i += 1) {\n    a = domain[i][0] - a0;\n    b = domain[i][1] - b0;\n    c = range[i][0] - a0;\n    d = range[i][1] - b0;\n    ac += a * c;\n    ad += a * d;\n    bc += b * c;\n    bd += b * d;\n  }\n\n  p = ac + bd;\n  q = ad - bc;\n\n  D = Math.sqrt(p * p + q * q);\n\n  if (D === 0) {\n    // D === 0\n    // <=> q === 0 and p === 0.\n    // <=> ad === bc and ac === -bd\n    // <=> domain in pivot OR range in pivot OR yet unknown cases\n    //     where the angle cannot be determined.\n    // D === 0 also if N === 0.\n    // Assume identity transform to be the best guess\n    return Transform.IDENTITY;\n  }\n\n  shat = p / D;\n  rhat = q / D;\n  tx = a0 - a0 * shat + b0 * rhat;\n  ty = b0 - a0 * rhat - b0 * shat;\n\n  return new Transform(shat, rhat, tx, ty);\n};\n","var Transform = require('./Transform');\n\nmodule.exports = function (domain, range, pivot) {\n  // Estimate optimal transformation given the domain and the range\n  // so that the pivot point remains the same.\n  //\n  // Use cases\n  //   - transform an image that has one corner fixed with a pin.\n  //   - allow only scale and rotation by fixing the middle of the object\n  //     to transform.\n  //\n  // Parameters\n  //   domain, an array of [x, y] points\n  //   range, an array of [x, y] points\n  //   pivot, optional\n  //     the point [x, y] that must remain constant in the tranformation.\n  //     Defaults to origo [0, 0]\n  //\n  //\n  var X, Y, N, s, r, tx, ty;\n\n  // Optional pivot\n  if (typeof pivot === 'undefined') {\n    pivot = [0, 0];\n  }\n\n  // Alias\n  X = domain;\n  Y = range;\n\n  // Allow arrays of different length but\n  // ignore the extra points.\n  N = Math.min(X.length, Y.length);\n\n  var v = pivot[0];\n  var w = pivot[1];\n\n  var i, a, b, c, d;\n  var a2, b2;\n  a2 = b2 = 0;\n  var ac, bd, bc, ad;\n  ac = bd = bc = ad = 0;\n\n  for (i = 0; i < N; i += 1) {\n    a = X[i][0] - v;\n    b = X[i][1] - w;\n    c = Y[i][0] - v;\n    d = Y[i][1] - w;\n    a2 += a * a;\n    b2 += b * b;\n    ac += a * c;\n    bd += b * d;\n    bc += b * c;\n    ad += a * d;\n  }\n\n  // Denominator = determinant.\n  // It becomes zero iff N = 0 or X[i] = [v, w] for every i in [0, n).\n  // In other words, iff all the domain points are under the fixed point or\n  // there is no domain points.\n  var den = a2 + b2;\n\n  var eps = 0.00000001;\n  if (Math.abs(den) < eps) {\n    // The domain points are under the pivot or there is no domain points.\n    // We assume identity transform be the simplest guess. It keeps\n    // the domain points under the pivot if there is some.\n    return new Transform(1, 0, 0, 0);\n  }\n\n  // Estimators\n  s = (ac + bd) / den;\n  r = (-bc + ad) / den;\n  tx =  w * r - v * s + v;\n  ty = -v * r - w * s + w;\n\n  return new Transform(s, r, tx, ty);\n};\n","var Transform = require('./Transform');\n\nmodule.exports = function (domain, range) {\n  // Parameters\n  //   domain\n  //     array of [x, y] 2D arrays\n  //   range\n  //     array of [x, y] 2D arrays\n\n  // Alias\n  var X = domain;\n  var Y = range;\n\n  // Allow arrays of different length but\n  // ignore the extra points.\n  var N = Math.min(X.length, Y.length);\n\n  var i, a, b, c, d, a1, b1, c1, d1, a2, b2, ac, bd;\n  a1 = b1 = c1 = d1 = a2 = b2 = ac = bd = 0;\n  for (i = 0; i < N; i += 1) {\n    a = X[i][0];\n    b = X[i][1];\n    c = Y[i][0];\n    d = Y[i][1];\n    a1 += a;\n    b1 += b;\n    c1 += c;\n    d1 += d;\n    a2 += a * a;\n    b2 += b * b;\n    ac += a * c;\n    bd += b * d;\n  }\n\n  // Denominator.\n  var N2 = N * N;\n  var a12 = a1 * a1;\n  var b12 = b1 * b1;\n  var p = a2 + b2;\n  var q = ac + bd;\n  var D = N2 * p - N * (a12 + b12);\n\n  if (D === 0) {\n    // N === 0 => D === 0\n    if (N === 0) {\n      return new Transform(1, 0, 0, 0);\n    } // else\n    // D === 0 <=> all the domain points are the same\n    // We guess the translation to the mean of the range to be the best guess.\n    // Here a, b represents the mean of domain points.\n    return new Transform(1, 0, (c1 / N) - a, (d1 / N) - b);\n  }\n\n  // Estimators\n  var shat = (N2 * q - N * (a1 * c1 + b1 * d1)) / D;\n  var txhat = (-N * a1 * q + N * c1 * p - b12 * c1 + a1 * b1 * d1) / D;\n  var tyhat = (-N * b1 * q + N * d1 * p - a12 * d1 + a1 * b1 * c1) / D;\n\n  return new Transform(shat, 0, txhat, tyhat);\n};\n","var Transform = require('./Transform');\n\nmodule.exports = function (domain, range) {\n  // Parameters\n  //   domain\n  //     array of [x, y] 2D arrays\n  //   range\n  //     array of [x, y] 2D arrays\n  var X, Y, N, s, r, tx, ty;\n\n  // Alias\n  X = domain;\n  Y = range;\n\n  // Allow arrays of different length but\n  // ignore the extra points.\n  N = Math.min(X.length, Y.length);\n\n  // If length is zero, no estimation can be done. We choose the indentity\n  // transformation be the best quess.\n  if (N === 0) {\n    return new Transform(1, 0, 0, 0);\n  } // else\n\n  var i, a, b, c, d;\n  var a1 = 0;\n  var b1 = 0;\n  var c1 = 0;\n  var d1 = 0;\n  var a2 = 0;\n  var b2 = 0;\n  var ad = 0;\n  var bc = 0;\n  var ac = 0;\n  var bd = 0;\n  for (i = 0; i < N; i += 1) {\n    a = X[i][0];\n    b = X[i][1];\n    c = Y[i][0];\n    d = Y[i][1];\n    a1 += a;\n    b1 += b;\n    c1 += c;\n    d1 += d;\n    a2 += a * a;\n    b2 += b * b;\n    ad += a * d;\n    bc += b * c;\n    ac += a * c;\n    bd += b * d;\n  }\n\n  // Denominator.\n  // It is zero iff X[i] = X[j] for every i and j in [0, n).\n  // In other words, iff all the domain points are the same or there is only one domain point.\n  var den = N * a2 + N * b2 - a1 * a1 - b1 * b1;\n\n  var eps = 0.00000001;\n  if (-eps < den && den < eps) {\n    // The domain points are the same.\n    // We guess the translation to the mean of the range to be the best guess.\n    // Here a, b represents the mean of domain points.\n    return new Transform(1, 0, (c1 / N) - a, (d1 / N) - b);\n  }\n\n  // Estimators\n  s = (N * (ac + bd) - a1 * c1 - b1 * d1) / den;\n  r = (N * (ad - bc) + b1 * c1 - a1 * d1) / den;\n  tx = (-a1 * (ac + bd) + b1 * (ad - bc) + a2 * c1 + b2 * c1) / den;\n  ty = (-b1 * (ac + bd) - a1 * (ad - bc) + a2 * d1 + b2 * d1) / den;\n\n  return new Transform(s, r, tx, ty);\n};\n","var Transform = require('./Transform');\n\nmodule.exports = function (domain, range) {\n  // Parameters\n  //   domain\n  //     array of [x, y] 2D arrays\n  //   range\n  //     array of [x, y] 2D arrays\n\n  // Alias\n  var X = domain;\n  var Y = range;\n\n  // Allow arrays of different length but\n  // ignore the extra points.\n  var N = Math.min(X.length, Y.length);\n\n  var i, a, b, c, d, a1, b1, c1, d1, ac, ad, bc, bd;\n  a1 = b1 = c1 = d1 = ac = ad = bc = bd = 0;\n  for (i = 0; i < N; i += 1) {\n    a = X[i][0];\n    b = X[i][1];\n    c = Y[i][0];\n    d = Y[i][1];\n    a1 += a;\n    b1 += b;\n    c1 += c;\n    d1 += d;\n    ac += a * c;\n    ad += a * d;\n    bc += b * c;\n    bd += b * d;\n  }\n\n  // Denominator.\n  var v = N * (ad - bc) - a1 * d1 + b1 * c1;\n  var w = N * (ac + bd) - a1 * c1 - b1 * d1;\n  var D = Math.sqrt(v * v + w * w);\n\n  if (D === 0) {\n    // N === 0 => D === 0\n    if (N === 0) {\n      return new Transform(1, 0, 0, 0);\n    } // else\n    // D === 0 <=> undecidable\n    // We guess the translation to the mean of the range to be the best guess.\n    // Here a, b represents the mean of domain points.\n    return new Transform(1, 0, (c1 - a1) / N, (d1 - b1) / N);\n  }\n\n  // Estimators\n  var shat = w / D;\n  var rhat = v / D;\n  var txhat = (-a1 * shat + b1 * rhat + c1) / N;\n  var tyhat = (-a1 * rhat - b1 * shat + d1) / N;\n\n  return new Transform(shat, rhat, txhat, tyhat);\n};\n","var Transform = require('./Transform');\n\nmodule.exports = function (domain, range) {\n  var i, N, a1, b1, c1, d1, txhat, tyhat;\n\n  N = Math.min(domain.length, range.length);\n  a1 = b1 = c1 = d1 = 0;\n\n  if (N < 1) {\n    // Assume identity transform be the best guess\n    return Transform.IDENTITY;\n  }\n\n  for (i = 0; i < N; i += 1) {\n    a1 += domain[i][0];\n    b1 += domain[i][1];\n    c1 += range[i][0];\n    d1 += range[i][1];\n  }\n\n  txhat = (c1 - a1) / N;\n  tyhat = (d1 - b1) / N;\n\n  return new Transform(1, 0, txhat, tyhat);\n};\n","\nvar Transform = function (s, r, tx, ty) {\n\n  // Public, to allow user access\n  this.s = s;\n  this.r = r;\n  this.tx = tx;\n  this.ty = ty;\n\n  this.equals = function (t) {\n    return (s === t.s && r === t.r && tx === t.tx && ty === t.ty);\n  };\n\n  this.transform = function (p) {\n    // p\n    //   point [x, y] or array of points [[x1,y1], [x2, y2], ...]\n\n    if (typeof p[0] === 'number') {\n      // Single point\n      return [s * p[0] - r * p[1] + tx, r * p[0] + s * p[1] + ty];\n    } // else\n\n    var i, c = [];\n    for (i = 0; i < p.length; i += 1) {\n      c.push([s * p[i][0] - r * p[i][1] + tx, r * p[i][0] + s * p[i][1] + ty]);\n    }\n    return c;\n  };\n\n  this.getMatrix = function () {\n    // Get the transformation matrix in the format common to\n    // many APIs, including:\n    // - kld-affine\n    //\n    // Return\n    //   object o, having properties a, b, c, d, e, f:\n    //   [ s  -r  tx ]   [ o.a  o.c  o.e ]\n    //   [ r   s  ty ] = [ o.b  o.d  o.f ]\n    //   [ 0   0   1 ]   [  -    -    -  ]\n    return { a: s, b: r, c: -r, d: s, e: tx, f: ty };\n  };\n\n  this.getRotation = function () {\n    // in rads\n    return Math.atan2(r, s);\n  };\n\n  this.getScale = function () {\n    // scale multiplier\n    return Math.sqrt(r * r + s * s);\n  };\n\n  this.getTranslation = function () {\n    return [tx, ty];\n  };\n\n  this.inverse = function () {\n    // Return inversed transform instance\n    // See note 2015-10-26-16-30\n    var det = s * s + r * r;\n    // Test if singular transformation. These might occur when all the range\n    // points are the same, forcing the scale to drop to zero.\n    var eps = 0.00000001;\n    if (Math.abs(det) < eps) {\n      throw new Error('Singular transformations cannot be inversed.');\n    }\n    var shat = s / det;\n    var rhat = -r / det;\n    var txhat = (-s * tx - r * ty) / det;\n    var tyhat = ( r * tx - s * ty) / det;\n    return new Transform(shat, rhat, txhat, tyhat);\n  };\n\n  this.translateBy = function (dx, dy) {\n    return new Transform(s, r, tx + dx, ty + dy);\n  };\n\n  this.scaleBy = function (multiplier, pivot) {\n    // Parameter\n    //   multiplier\n    //   pivot\n    //     optional, a [x, y] point\n    var m, x, y;\n    m = multiplier; // alias\n    if (typeof pivot === 'undefined') {\n      x = y = 0;\n    } else {\n      x = pivot[0];\n      y = pivot[1];\n    }\n    return new Transform(m * s, m * r, m * tx + (1-m) * x, m * ty + (1-m) * y);\n  };\n\n  this.rotateBy = function (radians, pivot) {\n    // Parameter\n    //   radians\n    //     from positive x to positive y axis\n    //   pivot\n    //     optional, a [x, y] point\n    var co, si, x, y, shat, rhat, txhat, tyhat;\n    co = Math.cos(radians);\n    si = Math.sin(radians);\n    if (typeof pivot === 'undefined') {\n      x = y = 0;\n    } else {\n      x = pivot[0];\n      y = pivot[1];\n    }\n    shat = s * co - r * si;\n    rhat = s * si + r * co;\n    txhat = (tx - x) * co - (ty - y) * si + x;\n    tyhat = (tx - x) * si + (ty - y) * co + y;\n    return new Transform(shat, rhat, txhat, tyhat);\n  };\n\n\n  this.multiplyBy = function (transform) {\n    // Multiply this transformation matrix A\n    // from the right with the given transformation matrix B\n    // and return the result AB\n\n    // For reading aid:\n    // s -r tx  t.s -r tx\n    // r  s ty *  r  s ty\n    // 0  0  1    0  0  1\n    var t = transform; // alias\n    var shat = s * t.s - r * t.r;\n    var rhat = s * t.r + r * t.s;\n    var txhat = s * t.tx - r * t.ty + tx;\n    var tyhat = r * t.tx + s * t.ty + ty;\n    return new Transform(shat, rhat, txhat, tyhat);\n  };\n};\n\nTransform.IDENTITY = new Transform(1, 0, 0, 0);\n\nmodule.exports = Transform;\n","module.exports = '1.0.1';\n","\"use strict\";\n\nmodule.exports = SeqId\n\nfunction SeqId(initial) {\n  if (!(this instanceof SeqId)) {\n    return new SeqId(initial)\n  }\n  if (initial == null) {\n    initial = (Math.random() - 0.5) * Math.pow(2, 32)\n  }\n  this._id = initial | 0\n}\nSeqId.prototype.next = function () {\n  this._id = (this._id + 1) | 0\n  return this._id\n}\n","var hasTransitions = require('has-transitions');\nvar emitter = require('css-emitter');\n\nfunction afterTransition(el, callback) {\n  if(hasTransitions(el)) {\n    return emitter(el).bind(callback);\n  }\n  return callback.apply(el);\n};\n\nafterTransition.once = function(el, callback) {\n  afterTransition(el, function fn(){\n    callback.apply(el);\n    emitter(el).unbind(fn);\n  });\n};\n\nmodule.exports = afterTransition;","function one(selector, el) {\n  return el.querySelector(selector);\n}\n\nexports = module.exports = function(selector, el){\n  el = el || document;\n  return one(selector, el);\n};\n\nexports.all = function(selector, el){\n  el = el || document;\n  return el.querySelectorAll(selector);\n};\n\nexports.engine = function(obj){\n  if (!obj.one) throw new Error('.one callback required');\n  if (!obj.all) throw new Error('.all callback required');\n  one = obj.one;\n  exports.all = obj.all;\n  return exports;\n};\n","\nvar prop = require('transform-property');\n\n// IE <=8 doesn't have `getComputedStyle`\nif (!prop || !window.getComputedStyle) {\n  module.exports = false;\n\n} else {\n  var map = {\n    webkitTransform: '-webkit-transform',\n    OTransform: '-o-transform',\n    msTransform: '-ms-transform',\n    MozTransform: '-moz-transform',\n    transform: 'transform'\n  };\n\n  // from: https://gist.github.com/lorenzopolidori/3794226\n  var el = document.createElement('div');\n  el.style[prop] = 'translate3d(1px,1px,1px)';\n  document.body.insertBefore(el, null);\n  var val = getComputedStyle(el).getPropertyValue(map[prop]);\n  document.body.removeChild(el);\n  module.exports = null != val && val.length && 'none' != val;\n}\n","\n/**\n * CSS Easing functions\n */\n\nmodule.exports = {\n    'in':                'ease-in'\n  , 'out':               'ease-out'\n  , 'in-out':            'ease-in-out'\n  , 'snap':              'cubic-bezier(0,1,.5,1)'\n  , 'linear':            'cubic-bezier(0.250, 0.250, 0.750, 0.750)'\n  , 'ease-in-quad':      'cubic-bezier(0.550, 0.085, 0.680, 0.530)'\n  , 'ease-in-cubic':     'cubic-bezier(0.550, 0.055, 0.675, 0.190)'\n  , 'ease-in-quart':     'cubic-bezier(0.895, 0.030, 0.685, 0.220)'\n  , 'ease-in-quint':     'cubic-bezier(0.755, 0.050, 0.855, 0.060)'\n  , 'ease-in-sine':      'cubic-bezier(0.470, 0.000, 0.745, 0.715)'\n  , 'ease-in-expo':      'cubic-bezier(0.950, 0.050, 0.795, 0.035)'\n  , 'ease-in-circ':      'cubic-bezier(0.600, 0.040, 0.980, 0.335)'\n  , 'ease-in-back':      'cubic-bezier(0.600, -0.280, 0.735, 0.045)'\n  , 'ease-out-quad':     'cubic-bezier(0.250, 0.460, 0.450, 0.940)'\n  , 'ease-out-cubic':    'cubic-bezier(0.215, 0.610, 0.355, 1.000)'\n  , 'ease-out-quart':    'cubic-bezier(0.165, 0.840, 0.440, 1.000)'\n  , 'ease-out-quint':    'cubic-bezier(0.230, 1.000, 0.320, 1.000)'\n  , 'ease-out-sine':     'cubic-bezier(0.390, 0.575, 0.565, 1.000)'\n  , 'ease-out-expo':     'cubic-bezier(0.190, 1.000, 0.220, 1.000)'\n  , 'ease-out-circ':     'cubic-bezier(0.075, 0.820, 0.165, 1.000)'\n  , 'ease-out-back':     'cubic-bezier(0.175, 0.885, 0.320, 1.275)'\n  , 'ease-out-quad':     'cubic-bezier(0.455, 0.030, 0.515, 0.955)'\n  , 'ease-out-cubic':    'cubic-bezier(0.645, 0.045, 0.355, 1.000)'\n  , 'ease-in-out-quart': 'cubic-bezier(0.770, 0.000, 0.175, 1.000)'\n  , 'ease-in-out-quint': 'cubic-bezier(0.860, 0.000, 0.070, 1.000)'\n  , 'ease-in-out-sine':  'cubic-bezier(0.445, 0.050, 0.550, 0.950)'\n  , 'ease-in-out-expo':  'cubic-bezier(1.000, 0.000, 0.000, 1.000)'\n  , 'ease-in-out-circ':  'cubic-bezier(0.785, 0.135, 0.150, 0.860)'\n  , 'ease-in-out-back':  'cubic-bezier(0.680, -0.550, 0.265, 1.550)'\n};\n","/**\n * This will store the property that the current\n * browser uses for transitionDuration\n */\nvar property;\n\n/**\n * The properties we'll check on an element\n * to determine if it actually has transitions\n * We use duration as this is the only property\n * needed to technically have transitions\n * @type {Array}\n */\nvar types = [\n  \"transitionDuration\",\n  \"MozTransitionDuration\",\n  \"webkitTransitionDuration\"\n];\n\n/**\n * Determine the correct property for this browser\n * just once so we done need to check every time\n */\nwhile(types.length) {\n  var type = types.shift();\n  if(type in document.body.style) {\n    property = type;\n  }\n}\n\n/**\n * Determine if the browser supports transitions or\n * if an element has transitions at all.\n * @param  {Element}  el Optional. Returns browser support if not included\n * @return {Boolean}\n */\nfunction hasTransitions(el){\n  if(!property) {\n    return false; // No browser support for transitions\n  }\n  if(!el) {\n    return property != null; // We just want to know if browsers support it\n  }\n  var duration = getComputedStyle(el)[property];\n  return duration !== \"\" && parseFloat(duration) !== 0; // Does this element have transitions?\n}\n\nmodule.exports = hasTransitions;","/**\n * Module Dependencies\n */\n\nvar events = require('event');\n\n// CSS events\n\nvar watch = [\n  'transitionend'\n, 'webkitTransitionEnd'\n, 'oTransitionEnd'\n, 'MSTransitionEnd'\n, 'animationend'\n, 'webkitAnimationEnd'\n, 'oAnimationEnd'\n, 'MSAnimationEnd'\n];\n\n/**\n * Expose `CSSnext`\n */\n\nmodule.exports = CssEmitter;\n\n/**\n * Initialize a new `CssEmitter`\n *\n */\n\nfunction CssEmitter(element){\n  if (!(this instanceof CssEmitter)) return new CssEmitter(element);\n  this.el = element;\n}\n\n/**\n * Bind CSS events.\n *\n * @api public\n */\n\nCssEmitter.prototype.bind = function(fn){\n  for (var i=0; i < watch.length; i++) {\n    events.bind(this.el, watch[i], fn);\n  }\n  return this;\n};\n\n/**\n * Unbind CSS events\n * \n * @api public\n */\n\nCssEmitter.prototype.unbind = function(fn){\n  for (var i=0; i < watch.length; i++) {\n    events.unbind(this.el, watch[i], fn);\n  }\n  return this;\n};\n\n/**\n * Fire callback only once\n * \n * @api public\n */\n\nCssEmitter.prototype.once = function(fn){\n  var self = this;\n  function on(){\n    self.unbind(on);\n    fn.apply(self.el, arguments);\n  }\n  self.bind(on);\n  return this;\n};\n\n","\nvar styles = [\n  'webkitTransform',\n  'MozTransform',\n  'msTransform',\n  'OTransform',\n  'transform'\n];\n\nvar el = document.createElement('p');\nvar style;\n\nfor (var i = 0; i < styles.length; i++) {\n  style = styles[i];\n  if (null != el.style[style]) {\n    module.exports = style;\n    break;\n  }\n}\n","\n/**\n * Bind `el` event `type` to `fn`.\n *\n * @param {Element} el\n * @param {String} type\n * @param {Function} fn\n * @param {Boolean} capture\n * @return {Function}\n * @api public\n */\n\nexports.bind = function(el, type, fn, capture){\n  if (el.addEventListener) {\n    el.addEventListener(type, fn, capture);\n  } else {\n    el.attachEvent('on' + type, fn);\n  }\n  return fn;\n};\n\n/**\n * Unbind `el` event `type`'s callback `fn`.\n *\n * @param {Element} el\n * @param {String} type\n * @param {Function} fn\n * @param {Boolean} capture\n * @return {Function}\n * @api public\n */\n\nexports.unbind = function(el, type, fn, capture){\n  if (el.removeEventListener) {\n    el.removeEventListener(type, fn, capture);\n  } else {\n    el.detachEvent('on' + type, fn);\n  }\n  return fn;\n};\n"]}