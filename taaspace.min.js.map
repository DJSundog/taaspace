{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","src/index.js","src/Taa.js","src/SpaceTaa.js","src/SpaceHTML.js","src/Space.js","src/HTMLSpaceView.js","src/version.js","src/SpaceNode.js","src/SpacePlane.js","src/Transformer.js","src/SpaceRectangle.js","src/SpacePoint.js","src/Transform.js","node_modules/loadimages/index.js","node_modules/component-emitter/index.js","node_modules/movejs/index.js","node_modules/seqid/seqid.js","node_modules/nudged/index.js","node_modules/movejs/node_modules/css-ease/index.js","node_modules/movejs/node_modules/component-query/index.js","node_modules/movejs/node_modules/after-transition/index.js","node_modules/movejs/node_modules/has-translate3d/index.js","node_modules/nudged/lib/Transform.js","node_modules/nudged/lib/estimateT.js","node_modules/nudged/lib/estimateS.js","node_modules/nudged/lib/estimateR.js","node_modules/nudged/lib/estimateTS.js","node_modules/nudged/lib/estimateTR.js","node_modules/nudged/lib/estimateSR.js","node_modules/nudged/lib/estimateTSR.js","node_modules/nudged/lib/version.js","node_modules/movejs/node_modules/after-transition/node_modules/css-emitter-component/index.js","node_modules/movejs/node_modules/after-transition/node_modules/has-transitions/index.js","node_modules/movejs/node_modules/has-translate3d/node_modules/transform-property/index.js","node_modules/movejs/node_modules/after-transition/node_modules/css-emitter-component/node_modules/event-component/index.js"],"names":["exports","Taa","require","SpaceTaa","SpaceHTML","Space","HTMLSpaceView","version","Emitter","loadimages","NOOP","imgSrc","onLoaded","this","this2","image","src","notCached","err","emiterr","emittaa","emit","setTimeout","module","SpaceNode","SpacePlane","Transformer","SpaceRectangle","parent","taa","resize","setParent","html","getHTML","move","defaults","duration","space","htmlContainer","_el","_elements","_nodes","w","clientWidth","h","clientHeight","transformNode","htmlElement","spaceNode","node_global_T","getGlobalTransform","T","_T","inverse","multiplyBy","prec","s","toFixed","r","tx","ty","matrix","end","getViewSpecificId","spaceNodeId","id","contentAddedHandler","newParent","oldParent","node","el","wh","getRootParent","hasOwnProperty","Image","className","appendChild","document","createElement","innerHTML","getSize","style","width","height","on","Exception","contentRemovedHandler","sameRoot","removeChild","contentTransformedHandler","nodes","i","getDescendants","push","length","self","newSpace","oldSpace","des","off","element","getElementBySpaceNode","getSpaceNodeByElementId","split","spaceViewId","getRootElement","superSetParent","call","seqid","emitter","next","toString","_parent","_children","_addedHandlers","_removedHandlers","_transformedHandlers","getParent","getChildren","arr","obj","children","child","concat","hasChild","_addChild","_removeChild","remove","sc","addedHandler","a","b","c","removedHandler","transformedHandler","nudged","SpacePoint","at","xy","Transform","IDENTITY","getTransform","resetTransform","normalize","points","plane","p","np","normalized","Array","isArray","to","transformByEstimate","type","domain","range","pivot","normPivot","normDomain","normRange","H_space","estimate","setTransform","setGlobalTransform","parent_global","translate","scale","multiplierOrDomain","useMultiplier","multiplier","S_parent","scaleBy","rotate","radiansOrDomain","useRadians","radians","R_parent","rotateBy","translateScale","translateRotate","scaleRotate","translateScaleRotate","opgt","npgt","ot","nt","transformer","t","atNorm","atMid","atMidN","atMidW","atMidE","atMidS","atNW","atNE","atSW","atSE","dimensions","reference","proto","prototype","equals","point","offset","dx","dy","polarOffset","radius","x","Math","cos","y","sin","target","toSpace","target_gT","C","xy_target","transform","xy_space","space_mock","tr","xy_hat","imgSrcs","then","numberOfImages","stringGiven","thereWasSuccess","thereWasError","imgs","onloadsCalled","onload","onerror","Error","isFinalImage","errMsg","mixin","key","addEventListener","event","fn","_callbacks","once","apply","arguments","removeListener","removeAllListeners","removeEventListener","callbacks","cb","splice","args","slice","len","listeners","hasListeners","Move","query","TypeError","_props","_rotate","_transitionProps","_transforms","after","has3d","ease","window","getComputedStyle","currentStyle","select","selector","skew","skewX","n","skewY","join","translateX","translateY","scaleX","m11","m12","m21","m22","m31","m32","scaleY","setVendorProperty","animate","name","props","_duration","parseFloat","delay","setProperty","prop","val","set","transition","add","curr","parseInt","current","sub","getPropertyValue","indexOf","applyProperties","clone","pop","reset","webkitTransitionDuration","mozTransitionDuration","msTransitionDuration","oTransitionDuration","SeqId","initial","random","pow","_id","estimateT","estimateS","estimateR","estimateTS","estimateTR","estimateSR","estimateTSR","toUpperCase","in","out","in-out","snap","linear","ease-in-quad","ease-in-cubic","ease-in-quart","ease-in-quint","ease-in-sine","ease-in-expo","ease-in-circ","ease-in-back","ease-out-quad","ease-out-cubic","ease-out-quart","ease-out-quint","ease-out-sine","ease-out-expo","ease-out-circ","ease-out-back","ease-in-out-quart","ease-in-out-quint","ease-in-out-sine","ease-in-out-expo","ease-in-out-circ","ease-in-out-back","one","querySelector","all","querySelectorAll","engine","afterTransition","callback","hasTransitions","bind","unbind","map","webkitTransform","OTransform","msTransform","MozTransform","body","insertBefore","getMatrix","d","e","f","getRotation","atan2","getScale","sqrt","getTranslation","det","eps","abs","shat","rhat","txhat","tyhat","translateBy","m","co","si","N","a1","b1","c1","d1","min","D","a0","b0","ac","bd","aa","bb","max","ad","bc","q","a2","b2","X","Y","N2","a12","b12","v","den","CssEmitter","events","watch","property","types","shift","styles","capture","attachEvent","detachEvent"],"mappings":"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","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","\nexports.Taa = require('./Taa');\nexports.SpaceTaa = require('./SpaceTaa');\nexports.SpaceHTML = require('./SpaceHTML');\nexports.Space = require('./Space');\nexports.HTMLSpaceView = require('./HTMLSpaceView');\n\nexports.version = require('./version');\n","// API v0.6.0\nvar Emitter = require('component-emitter');\nvar loadimages = require('loadimages');\n\nvar NOOP = function () {};\n\nvar Taa = function (imgSrc, onLoaded) {\n  // Parameters\n  //   imgSrc\n  //   onLoaded(err, taa)\n  //     optional, function (taa)\n  Emitter(this);\n  var this2 = this;\n\n  // onLoaded is optional\n  if (typeof onLoaded !== 'function') {\n    onLoaded = NOOP;\n  }\n\n  // This object will be replaced by a real Image object but before that\n  // src is needed in SpaceView.\n  this.image = { src: imgSrc };\n\n  // If the image is cached, the 'load' event of Image element is\n  // fired instantly when calling loadimages. If we did not care\n  // about this, the on('loaded', fn) listeners would experience\n  // different execution order depending whether the images was\n  // cached or not.\n  var notCached = false;\n\n  loadimages(imgSrc, function (err, image) {\n    var emiterr, emittaa;\n    if (err) {\n      emiterr = err;\n      emittaa = null;\n    } else {\n      this2.image = image;\n      emiterr = null;\n      emittaa = this2;\n    }\n\n    if (notCached) {\n      this2.emit('loaded', emiterr, emittaa);\n      onLoaded(emiterr, emittaa);\n    } else {\n      // Postpone emitting of the loaded event\n      setTimeout(function () {\n        this2.emit('loaded', emiterr, emittaa);\n        onLoaded(emiterr, emittaa);\n      }, 0);\n    }\n  });\n\n  notCached = true;\n};\n\nmodule.exports = Taa;\n","// API v0.6.0\n\nvar Emitter = require('component-emitter');\nvar SpaceNode = require('./SpaceNode');\nvar SpacePlane = require('./SpacePlane');\nvar Transformer = require('./Transformer');\nvar SpaceRectangle = require('./SpaceRectangle');\n\nvar SpaceTaa = function (parent, taa) {\n  // Parameters:\n  //   parent\n  //     a SpaceNode\n  //   taa\n  //     a Taa\n  Emitter(this);\n  SpaceNode(this);\n  SpacePlane(this);\n  Transformer(this);\n  SpaceRectangle(this);\n\n  this.taa = taa;\n  this.resize([256, 256]);  // Size of taa.\n\n  this.setParent(parent);\n};\n\nmodule.exports = SpaceTaa;\n","/*\n# SpaceElement\n\nA HTMLElement [1] in the space.\n\n[1] https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement\n*/\n\nvar Emitter = require('component-emitter');\nvar SpaceNode = require('./SpaceNode');\nvar SpacePlane = require('./SpacePlane');\nvar Transformer = require('./Transformer');\nvar SpaceRectangle = require('./SpaceRectangle');\n\nvar SpaceHTML = function (parent, html) {\n  // Parameters:\n  //   parent:\n  //     a SpaceNode\n  //   html:\n  //     a string, containing html\n  Emitter(this);\n  SpaceNode(this);\n  SpacePlane(this);\n  Transformer(this);\n  SpaceRectangle(this);\n\n  this.html = html;\n  this.resize([256, 256]);  // Initial element size.\n\n  this.getHTML = function () {\n    return this.html;\n  };\n\n  // Ready\n  this.setParent(parent);\n};\n\nmodule.exports = SpaceHTML;\n","/*\nEmits\n  contentAdded\n  contentRemoved\n    not thrown if the content to remove did not exist in the first place.\n  contentTransformed\n*/\nvar Emitter = require('component-emitter');\nvar SpaceNode = require('./SpaceNode');\nvar SpacePlane = require('./SpacePlane');\n\nvar Space = function () {\n  Emitter(this);\n\n  SpaceNode(this);\n  // TODO remove possibility to add to parent.\n\n  SpacePlane(this);\n  // Space has constant identity transformation _T\n};\n\nmodule.exports = Space;\n","/*\n\nView\n\n*/\nvar Emitter = require('component-emitter');\nvar SpaceNode = require('./SpaceNode');\nvar SpacePlane = require('./SpacePlane');\nvar Transformer = require('./Transformer');\nvar SpaceRectangle = require('./SpaceRectangle');\nvar SpaceTaa = require('./SpaceTaa');\nvar SpaceHTML = require('./SpaceHTML');\nvar Space = require('./Space');\nvar move = require('movejs');\n\n// Disable animations by default.\nmove.defaults = { duration: 0 };\n\nvar HTMLSpaceView = function (space, htmlContainer) {\n  // Test if valid space\n  if (!(space instanceof Space)) {\n    throw 'Parent of a View must be a Space.';\n  }\n  // Test if valid dom element\n  if (!('tagName' in htmlContainer)) {\n    throw 'Container should be a DOM Element';\n  }\n\n  Emitter(this);\n  SpaceNode(this);\n  SpacePlane(this);\n  Transformer(this);\n  SpaceRectangle(this);\n  var this2 = this;\n\n  this._el = htmlContainer;\n\n  // Two mappings from space taa ids:\n  // 1. to HTML elements of the space nodes.\n  // 2. to SpaceNode instances\n  // Dev decision:\n  //   For data structure, dict over list because key search time complexity.\n  this._elements = {};\n  this._nodes = {};\n\n  (function initSize() {\n    var w = this2._el.clientWidth;\n    var h = this2._el.clientHeight;\n    this2.resize([w, h]);\n  }());\n\n  var transformNode = function (htmlElement, spaceNode) {\n    // Transform elements because the view orientation.\n    // See 2016-03-05-09 for math.\n    var node_global_T = spaceNode.getGlobalTransform();\n    var T = this2._T.inverse().multiplyBy(node_global_T);\n    // TODO What if view parent is not the root?\n    //   Solution: getTransformTo(plane)\n    // TODO Current move.js does not prevent scientific notation reaching CSS\n    // which leads to problems with Safari and Opera. Therefore we must\n    // prevent the notation here.\n    // Of course this will cause error in the presentation.\n    // However the error is only in the presentation and thus not a problem.\n    var prec = 8;\n    var s = T.s.toFixed(prec);\n    var r = T.r.toFixed(prec);\n    var tx = T.tx.toFixed(prec);\n    var ty = T.ty.toFixed(prec);\n    move(htmlElement).matrix(s, r,-r, s, tx, ty).end();\n  };\n\n  var getViewSpecificId = function (spaceNodeId) {\n    // Each rendered element has own ID. The ID differs from\n    // the id of space nodes because a space node can become\n    // visualized through multiple views.\n    return this2.id + '/' + spaceNodeId;\n  };\n\n  // Listen the space for new or removed taas or transformations\n\n  var contentAddedHandler = function (spaceNode, newParent, oldParent) {\n    // Parameters:\n    //   spaceNode: a SpaceNode i.e. the content unit that was added.\n    //   newParent: optional. The new parent of the SpaceNode\n    //     Not used for anything for now but probably in the future.\n    //   oldParent: optional. The old parent of the SpaceNode.\n    //     Not used for anything for now but probably in the future.\n    if (typeof oldParent === 'undefined') { oldParent = null; }\n    if (typeof newParent === 'undefined') { newParent = null; }\n\n    var node, el, wh;\n\n    // SpaceView, SpaceTaa ...\n    node = spaceNode;\n\n    // Ensure the spaceNode is in same space. Otherwise,\n    // if view's space has been just changed, a waiting\n    // contentAdded event could add spaceNode from the old space.\n    if (spaceNode.getRootParent() !== this2.getRootParent()) {\n      return;\n    }\n\n    if (this2._elements.hasOwnProperty(node.id)) {\n      // Content is already drawn.\n    } else {\n      if (node instanceof SpaceTaa) {\n        el = new Image(256, 256);\n        el.src = node.taa.image.src;\n        el.id = getViewSpecificId(node.id);\n        el.className = 'taaspace-taa';\n        // Show to client\n        this2._el.appendChild(el);\n        // Make referencable\n        this2._elements[node.id] = el;\n        this2._nodes[node.id] = node;\n        // Make transformation\n        transformNode(el, node);\n      } else if (node instanceof SpaceHTML) {\n        // Create container div.\n        el = document.createElement('div');\n        el.innerHTML = node.html;\n        el.id = getViewSpecificId(node.id);\n        el.className = 'taaspace-html';\n        // Resize, and let taaspace styles do the rest.\n        wh = node.getSize();\n        el.style.width = wh[0] + 'px';\n        el.style.height = wh[1] + 'px';\n        // TODO react to size change\n        // on resize reset the style.width and style.height\n        node.on('resized', function () {\n          // TODO remove listener\n          var wh = node.getSize();\n          el.style.width = wh[0] + 'px';\n          el.style.height = wh[1] + 'px';\n        });\n        // Render\n        this2._el.appendChild(el);\n        // Make referencable\n        this2._elements[node.id] = el;\n        this2._nodes[node.id] = node;\n        // Make transformation\n        transformNode(el, node);\n      } else if (node instanceof HTMLSpaceView) {\n        // No representation for views.\n      } else {\n        throw new Exception('Unknown SpaceNode subtype; cannot represent');\n      }\n    }\n  };\n\n  var contentRemovedHandler = function (spaceNode, oldParent, newParent) {\n    if (typeof oldParent === 'undefined') { oldParent = null; }\n    if (typeof newParent === 'undefined') { newParent = null; }\n\n    var sameRoot, el, node;\n\n    node = spaceNode; // Alias\n\n    // Decide sameRoot\n    if (oldParent === null || newParent === null) {\n      sameRoot = false;\n    } else {\n      sameRoot = oldParent.getRootParent() === newParent.getRootParent();\n    }\n\n    if (sameRoot) {\n      // No reason to remove and then add again.\n    } else {\n      // New parent in different space, so not displayed in this view anymore.\n      if (this2._elements.hasOwnProperty(node.id)) {\n        // Remove HTML element\n        el = this2._elements[node.id];\n        this2._el.removeChild(el);\n        // Remove from memory.\n        // JS feature of delete: does not throw if key does not exist\n        delete this2._elements[node.id];\n        delete this2._nodes[node.id];\n      }\n    }\n\n  };\n\n  var contentTransformedHandler = function (spaceNode) {\n    // Update css transformation.\n    // If the node has children, they must also be transformed.\n    var nodes, i, node, el;\n    nodes = spaceNode.getDescendants();\n    nodes.push(spaceNode);\n\n    for (i = 0; i < nodes.length; i += 1) {\n      node = nodes[i];\n      if (this2._elements.hasOwnProperty(node.id)) {\n        if (node instanceof SpaceTaa) {\n          el = this2._elements[node.id];\n          // Make transformation\n          transformNode(el, node);\n        } else if (node instanceof SpaceHTML) {\n          el = this2._elements[node.id];\n          transformNode(el, node);\n        }\n        // Else: no transformable representation for Views.\n      }\n    }\n  };\n\n  // View added to new parent.\n  this.on('added', function (self, newSpace, oldSpace) {\n    var des, i;\n\n    if (oldSpace === newSpace) {\n      // Already set up. Do nothing.\n      return;\n    }\n\n    // Render nodes from the new space.\n    des = newSpace.getDescendants();\n    for (i = 0; i < des.length; i += 1) {\n      contentAddedHandler(des[i]);\n    }\n\n    // Start to listen for changes.\n    newSpace.on('contentAdded', contentAddedHandler);\n    newSpace.on('contentRemoved', contentRemovedHandler);\n    newSpace.on('contentTransformed', contentTransformedHandler);\n  });\n\n  // View removed from parent.\n  this.on('removed', function (self, oldSpace, newSpace) {\n    var des, i;\n\n    if (newSpace === oldSpace) {\n      // Already set up. Do nothing.\n      return;\n    }\n\n    // Stop listening for changes.\n    oldSpace.off('contentAdded', contentAddedHandler);\n    oldSpace.off('contentRemoved', contentRemovedHandler);\n    oldSpace.off('contentTransformed', contentTransformedHandler);\n\n    // Remove all nodes from old space.\n    des = oldSpace.getDescendants();\n    for (i = 0; i < des.length; i += 1) {\n      contentRemovedHandler(des[i]);\n    }\n  });\n\n  // If the view is transformed, we of course need to retransform everything.\n  this.on('transformed', function () {\n    var id, element, node;\n    for (id in this2._elements) {\n      if (this2._elements.hasOwnProperty(id)) {\n        element  = this2._elements[id];\n        node = this2._nodes[id];\n        transformNode(element, node);\n      }\n    }\n  });\n\n  this.getElementBySpaceNode = function (spaceNode) {\n    // Get HTML element representation of the space taa.\n    // Return null if not found.\n    if (this._elements.hasOwnProperty(spaceNode.id)) {\n      return this._elements[spaceNode.id];\n    }\n    return null;\n  };\n\n  this.getSpaceNodeByElementId = function (id) {\n    // Get space taa by HTML element id\n    // Return null if no space taa for such id.\n    var i = id.split('/');\n    var spaceViewId = i[0];\n    var spaceNodeId = i[1];\n    if (this.id === spaceViewId) {\n      if (this._nodes.hasOwnProperty(spaceNodeId)) {\n        return this._nodes[spaceNodeId];\n      }\n    }\n    return null;\n  };\n\n  this.getRootElement = function () {\n    // Return the container HTML element.\n    return this._el;\n  };\n\n  // Override the setParent so that only a Space\n  // is allowed to become the parent.\n  var superSetParent = this.setParent;\n  this.setParent = function (space) {\n    if (!(space instanceof Space)) {\n      throw 'A View can only be a child of a Space';\n    }\n    superSetParent.call(this, space);\n  };\n\n  // View ready to be added to Space.\n  this.setParent(space);\n};\n\nmodule.exports = HTMLSpaceView;\n","module.exports = '3.0.0';\n","/*\nEmits\n  contentAdded\n  contentRemoved\n    not thrown if the content to remove did not exist in the first place.\n  contentTransformed\n*/\nvar Emitter = require('component-emitter');\n\n// Unique ID generator. Unique over session.\n// Usage: seqid.next()\n// Return: int\nvar seqid = require('seqid')(0);\n\nvar SpaceNode = function (emitter) {\n  // Parameters\n  //   emitter, an Emitter.\n\n  // Each node has an id. That is used by the parent nodes and in views.\n  emitter.id = seqid.next().toString();\n\n  // Nodes with null parent are root nodes i.e. spaces.\n  // SpaceNode#remove sets _parent to null.\n  emitter._parent = null;\n\n  // Dict over list because key search time complexity\n  emitter._children = {};\n\n  // We need to store built handlers bound to children\n  // to be able to remove the handlers when child is removed.\n  emitter._addedHandlers = {};\n  emitter._removedHandlers = {};\n  emitter._transformedHandlers = {};\n\n  emitter.getParent = function () {\n    return this._parent;\n  };\n\n  emitter.getRootParent = function () {\n    if (this._parent === null) {\n      return this;\n    } // else\n    return this._parent.getRootParent();\n  };\n\n  emitter.getChildren = function () {\n    // Return child SpaceNodes in a list.\n    // Does not include the children of the children.\n    var id, arr, obj;\n    arr = [];\n    obj = this._children;\n    for (id in obj) {\n      arr.push(obj[id]);\n    }\n    return arr;\n  };\n\n  emitter.getDescendants = function () {\n    // All descendants in a list, including the children.\n    var i, children, child, arr;\n    arr = [];\n    children = this.getChildren();\n    for (i = 0; i < children.length; i += 1) {\n      child = children[i];\n      arr = arr.concat(child, child.getDescendants());\n    }\n    return arr;\n  };\n\n  emitter.hasChild = function (spaceNode) {\n    // Return\n    //   true if spacetaa in space\n    return spaceNode._parent === this;\n  };\n\n  emitter.setParent = function (newParent) {\n    // Add to new parent.\n\n    var oldParent = this._parent;\n\n    if (oldParent === null) {\n      if (newParent === null) {\n        // From root to root.\n        // Do nothing\n      } else {\n        // From root to child.\n        this._parent = newParent;\n        this._parent._addChild(this);\n        this.emit('added', this, this._parent, null);\n        newParent.emit('contentAdded', this, this._parent, null);\n      }\n    } else {\n      if (newParent === null) {\n        // From child to root.\n        this._parent = null; // Becomes new root node.\n        oldParent._removeChild(this);\n        this.emit('removed', this, oldParent, null);\n        oldParent.emit('contentRemoved', this, oldParent, null);\n      } else {\n        // From child to child.\n        this._parent = newParent;\n        oldParent._removeChild(this);\n        newParent._addChild(this);\n        this.emit('removed', this, oldParent, newParent);\n        this.emit('added', this, newParent, oldParent);\n        // With both oldParent and newParent, SpaceView is able to\n        // decide whether to keep same HTMLElement or recreate it.\n        oldParent.emit('contentRemoved', this, oldParent, newParent);\n        newParent.emit('contentAdded', this, newParent, oldParent);\n      }\n    }\n\n  };\n\n  emitter.remove = function () {\n    // Remove this space node from its parent.\n    // Return: see setParent\n    return this.setParent(null);\n  };\n\n  emitter._addChild = function (child) {\n    // To be called from child.setParent().\n    //\n    // Parameters\n    //   child, A SpaceNode\n    //\n    // Return\n    //   undefined\n    //\n    // Dev. note:\n    //   Previously this was called from the SpaceNode constructor.\n    //   However, because SpaceNode upgrade is done before other\n    //   upgrades, the child would not be ready to be added to parent.\n\n    var sc = child; // alias\n    var self = this;\n\n    this._children[sc.id] = sc;\n\n    // Start to listen if child has beed added, removed or transformed\n    var addedHandler = function (a, b, c) {\n      self.emit('contentAdded', a, b, c);\n    };\n    var removedHandler = function (a, b, c) {\n      self.emit('contentRemoved', a, b, c);\n    };\n    var transformedHandler = function (a, b, c) {\n      self.emit('contentTransformed', a, b, c);\n    };\n    // added and removed events are not listened because\n    // for after successfully made add or remove,\n    // contentAdded and contentRemoved are fired in setParent.\n    sc.on('contentAdded', addedHandler);\n    sc.on('contentRemoved', removedHandler);\n    sc.on('transformed', transformedHandler);\n    sc.on('contentTransformed', transformedHandler);\n    this._addedHandlers[sc.id] = addedHandler;\n    this._removedHandlers[sc.id] = removedHandler;\n    this._transformedHandlers[sc.id] = transformedHandler;\n  };\n\n  emitter._removeChild = function (child) {\n    // To be called from SpaceNode#remove\n    // Precondition: child in space\n    var sc, h;\n\n    sc = child; // alias\n    delete this._children[sc.id];\n\n    // Remove handlers\n    h = this._addedHandlers[sc.id];\n    delete this._addedHandlers[sc.id];\n    sc.off('contentAdded', h);\n\n    h = this._removedHandlers[sc.id];\n    delete this._removedHandlers[sc.id];\n    sc.off('contentRemoved', h);\n\n    h = this._transformedHandlers[sc.id];\n    delete this._transformedHandlers[sc.id];\n    sc.off('transformed', h);\n    sc.off('contentTransformed', h);\n  };\n};\n\nmodule.exports = SpaceNode;\n","/*\nSpacePlane\nAPI v0.6.0\n\nA SpacePlane represents a coordinate system. It does not include\nmethods to transform the system. SpacePlane and Transformer are separated\nbecause we want to have planes that cannot be transformed, as the Space.\n\n*/\n\nvar nudged = require('nudged');\nvar SpacePoint = require('./SpacePoint');\n\nvar at = function (xy) {\n  // Return\n  //   A SpacePoint at (x,y) on the plane.\n  if (xy.length !== 2) {  // DEBUG TODO remove this\n    throw 'Invalid point, use array [x, y]';\n  }\n  return new SpacePoint(xy, this);  // Note: this === spaceNode\n};\n\nvar SpacePlane = function (spaceNode) {\n  // Parameters\n  //   spaceNode\n  //     A SpaceNode to monkey patch to SpacePlane\n\n  // Coordinate transformation.\n  // The transformation from the plane to the parent (space).\n  // See 2016-03-05-09\n  // Let:\n  //   x_space, a point in space\n  //   x_plane, a point on the plane.\n  //   T, the coordinate transformation of the plane\n  // Then:\n  //   x_space = T * x_plane\n  //\n  // For Space, it is obviously the identity transform:\n  //   x_space = T * x_space\n  spaceNode._T = nudged.Transform.IDENTITY; // identity transformation\n\n  spaceNode.at = at;\n\n  spaceNode.getTransform = function () {\n    // Local transform from plane to parent\n    //\n    // Return\n    //   transformation from plane to parent, i.e.\n    //     xy_parent = T * xy_plane\n    // Needed when we want to store transformer's position for later use.\n    return this._T;\n  };\n\n  spaceNode.getGlobalTransform = function () {\n    // Return\n    //   transformation from the plane to root container.\n    //\n    // Dev note:\n    //   Local transformations go like:\n    //     xy_parent = T_plane * xy_plane\n    //     xy_parent_parent = T_parent * xy_parent\n    //     ...\n    //     xy_root = T_parent_parent..._parent * xy_parent_parent..._parent\n    //   Therefore global transformation is:\n    //     xy_root = T_parent_..._parent * ... * T_parent * T_plane * xy_plane\n    if (this._parent === null) {\n      // TODO maybe too far: this._parent._parent might be sufficient.\n      return this._T;\n    } // else\n    return this._parent.getGlobalTransform().multiplyBy(this._T);\n  };\n\n  spaceNode.resetTransform = function () {\n    // Become space. Called e.g. when plane is removed from parent.\n    this._T = nudged.Transform.IDENTITY;\n  };\n\n};\n\nmodule.exports = SpacePlane;\n","// API v3.0.0\nvar nudged = require('nudged');\nvar Transform = require('./Transform');\nvar SpacePoint = require('./SpacePoint');\n\nvar normalize = function (points, plane) {\n  // Transform all the points onto the parent and\n  // represent them in array [[x0,y0], [x1,y1], ...].\n  //\n  // Arguments:\n  //   points, a single spacepoint or a list of spacepoints\n  //   plane, a SpacePlane e.g. a SpaceTaa onto normalize.\n  // Return:\n  //   array of xy points in space.\n  var i, p, np, normalized;\n\n  if (!Array.isArray(points)) {\n    // Single SpacePoint\n    p = points;\n    np = p.to(plane).xy;\n    return [np];\n  } // else\n  normalized = [];\n  for (i = 0; i < points.length; i += 1) {\n    p = points[i];\n    np = p.to(plane).xy;\n    normalized.push(np);\n  }\n  return normalized;\n};\n\n\nvar transformByEstimate = function (plane, type, domain, range, pivot) {\n  // Types: T,S,R,TS,TR,SR,TSR (see nudged for further details)\n\n  var normPivot;\n  if (typeof pivot !== 'undefined') {\n    normPivot = normalize(pivot, plane._parent)[0];\n  }\n\n  // Convert all SpacePoints onto the space and to arrays\n  var normDomain = normalize(domain, plane._parent);\n  var normRange = normalize(range, plane._parent);\n\n  // Then compute optimal transformation in space\n  var H_space = nudged.estimate(type, normDomain, normRange, normPivot);\n  // See 2016-03-05-11:\n  //   To apply transformation to a space object:\n  //     T_hat = toParent(H) * T\n  // Therefore:\n  plane._T = H_space.multiplyBy(plane._T);\n\n  // Notify especially view about transformation.\n  plane.emit('transformed', plane);\n};\n\n\nvar Transformer = function (plane) {\n  //\n  // Parameters\n  //   plane\n  //     a SpacePlane\n\n  plane.setTransform = function (T) {\n    // Needed when we whan to restore stored position, maybe after\n    // modification.\n    if (this._parent === null) {\n      // We are root, cannot set.\n      return;\n    }\n    this._T = T;\n    this.emit('transformed', this);\n  };\n\n  plane.setGlobalTransform = function (T) {\n    // Set local transform so that the global transform becomes the given T.\n    //\n    // Dev note:\n    //   Given T is coord. transf. from the plane to root (space).\n    //   So is this._T.\n    //   current_glob_trans = parent_glob_trans * this_T\n    //   new_glob_trans = parent_glob_trans * X\n    //   <=> X = inv(parent_glob_trans) * new_glob_trans\n    if (this._parent === null) {\n      // We are root, cannot set.\n      return;\n    }\n    var parent_global = this._parent.getGlobalTransform();\n    this._T = parent_global.inverse().multiplyBy(T);\n    this.emit('transformed', this);\n  };\n\n  plane.translate = function (domain, range) {\n    // Move plane horizontally and vertically by example.\n    //\n    // Translate the plane so that after the translation, the domain points\n    // would be as close to given range points as possible.\n    //\n    // Parameter\n    //   domain\n    //   range\n\n    transformByEstimate(this, 'T', domain, range);\n  };\n\n  plane.scale = function (pivot, multiplierOrDomain, range) {\n    // Parameter\n    //   pivot, a SpacePoint\n    //   multiplier, the scale factor, > 0\n    //  OR\n    //   pivot\n    //   domain\n    //   range\n\n    var useMultiplier = (typeof range === 'undefined');\n\n    if (useMultiplier) {\n      var normPivot = normalize(pivot, this._parent)[0];\n      var multiplier = multiplierOrDomain;\n      // Multiplier does not depend on plane.\n      // We create a pivoted scaling transform on parent.\n      var S_parent = Transform.IDENTITY.scaleBy(multiplier, normPivot);\n      // See 2016-03-05-11\n      //   We transform space objects by:\n      //   T_hat = H_space * T\n      this._T = S_parent.multiplyBy(this._T);\n      this.emit('transformed', this);\n    } else {\n      var domain = multiplierOrDomain;\n      transformByEstimate(this, 'S', domain, range, pivot);\n    }\n  };\n\n  plane.rotate = function (pivot, radiansOrDomain, range) {\n    // Parameter\n    //   pivot\n    //   radians\n    //  OR\n    //   pivot\n    //   domain\n    //   range\n\n    var useRadians = (typeof range === 'undefined');\n\n    if (useRadians) {\n      var normPivot = normalize(pivot, this._parent)[0];\n      var radians = radiansOrDomain;\n      // Radians do not depend on plane.\n      // We create a pivoted rotation transform on parent.\n      var R_parent = Transform.IDENTITY.rotateBy(radians, normPivot);\n      // See 2016-03-05-11\n      //   We transform space objects by:\n      //   T_hat = H_space * T\n      this._T = R_parent.multiplyBy(this._T);\n      this.emit('transformed', this);\n    } else {\n      var domain = radiansOrDomain;\n      transformByEstimate(this, 'R', domain, range, pivot);\n    }\n  };\n\n  plane.translateScale = function (domain, range) {\n    // Parameter\n    //   domain\n    //   range\n\n    transformByEstimate(this, 'TS', domain, range);\n  };\n\n  plane.translateRotate = function (domain, range) {\n    // Parameter\n    //   domain\n    //   range\n\n    transformByEstimate(this, 'TR', domain, range);\n  };\n\n  plane.scaleRotate = function (pivot, domain, range) {\n    // Parameter\n    //   domain\n    //   range\n\n    transformByEstimate(this, 'SR', domain, range, pivot);\n  };\n\n  plane.translateScaleRotate = function (domain, range) {\n    // Parameter\n    //   domain\n    //   range\n\n    transformByEstimate(this, 'TSR', domain, range);\n  };\n\n  // plane.translateAndScaleToFit, not sure if necessary for now\n\n  plane.on('removed', function (self, oldParent, newParent) {\n    // Maintain global location\n    \n    if (typeof oldParent === 'undefined') { oldParent = null; }\n    if (typeof newParent === 'undefined') { newParent = null; }\n\n    var sameRoot;\n    if (newParent === null) {\n      // Root nodes cannot move.\n      this.resetTransform();\n    } else {\n      if (oldParent === null) {\n        // Removed from null parent?\n        throw new Exception('Cannot remove from null parent');\n      } else {\n        // Moved onto another parent.\n        // Let us keep the location in space the same if possible.\n        // It is possible only if the parents share same root i.e.\n        // are in the same space.\n        sameRoot = oldParent.getRootParent() === newParent.getRootParent();\n        if (sameRoot) {\n          // Keep the location.\n          // Let\n          //   OT be the old local coord. transformation.\n          //   NT be the unknown new local coord. transf.\n          //   OPGT be the global coord. transf. of old parent\n          //   NPGT be the global coord. transf. of new parent\n          // Now, we want to keep global transf. unchanged.\n          //   OPGT * OT = NPGT * NT\n          //   <=> NT = inv(NPGT) * OPGT * OT\n          var opgt = oldParent.getGlobalTransform();\n          var npgt = newParent.getGlobalTransform();\n          var ot = this._T;\n          var nt = npgt.inverse().multiplyBy(opgt).multiplyBy(ot);\n          this._T = nt;\n          this.emit('transformed', this); // TODO Is needed because inplace?\n        } else {\n          // In different space: reset\n          this.resetTransform();\n        }\n        // Note: there could be a need to change parent with the same\n        // local transformation. Not needed for now.\n      }\n\n    }\n  });\n};\n\nmodule.exports = Transformer;\n","// API v0.6.0\n\nvar SpacePoint = require('./SpacePoint');\n\nvar SpaceRectangle = function (transformer) {\n\n  var t = transformer;  // Alias\n\n  // Rectangles have size.\n  // In its own coordinates, rectangle's right bottom corner\n  // is located at [width, height].\n  // By default transformation, width 1 and height 1 equal to 1 space unit.\n  var width = 1;\n  var height = 1;\n\n  t.atNorm = function (xy) {\n    // Return a SpacePoint by coordinates normalized about the size.\n    // atNorm([1,0]) returns the point at the right upper corner.\n    return new SpacePoint([width * xy[0], height * xy[1]], t);\n  };\n\n  t.atMid = function () {\n    return new SpacePoint([width / 2, height / 2], t);\n  };\n\n  t.atMidN = function () {\n    return new SpacePoint([width / 2, 0], t);\n  };\n\n  t.atMidW = function () {\n    return new SpacePoint([0, height / 2], t);\n  };\n\n  t.atMidE = function () {\n    return new SpacePoint([width, height / 2], t);\n  };\n\n  t.atMidS = function () {\n    return new SpacePoint([width / 2, height], t);\n  };\n\n  t.atNW = function () {\n    return new SpacePoint([0, 0], t);\n  };\n\n  t.atNE = function () {\n    return new SpacePoint([width, 0], t);\n  };\n\n  t.atSW = function () {\n    return new SpacePoint([0, height], t);\n  };\n\n  t.atSE = function () {\n    return new SpacePoint([width, height], t);\n  };\n\n  t.getSize = function () {\n    return [width, height];\n  };\n\n  t.resize = function (dimensions) {\n    // Parameter\n    //   dimensions, [width, height]\n    width = dimensions[0];\n    height = dimensions[1];\n\n    this.emit('resized', t);\n  };\n\n};\n\nmodule.exports = SpaceRectangle;\n","// API v0.6.0\n\nvar Transform = require('./Transform');\n\nvar SpacePoint = function (xy, reference) {\n  // Example\n  //   var p = taaspace.SpacePoint([x, y], taa);\n  //\n  // Parameter\n  //   xy\n  //     2D array\n  //   reference\n  //     a SpaceNode or SpacePoint\n  //       an item in space, enabling coord projections.\n  this.xy = xy;\n\n  // The SpacePlane's transformation the xy are on.\n  // Design note: at first, the references were SpacePlanes and not\n  // transformations. But because a SpacePlane can move or be removed,\n  // we chose only the transformation to be remembered.\n  // Design note: later we found it would be convenient for debugging\n  // to know where the point came from, which led to this._origin.\n  // After that we found that in toSpace method, we would need reference\n  // to space, although we only have implicit reference to its coords.\n  // Therefore this._origin was dropped.\n\n  if (reference.hasOwnProperty('getGlobalTransform')) {\n    // Is a SpacePlane\n    this._T = reference.getGlobalTransform();\n  } else {\n    // Is a SpacePoint\n    this._T = reference._T;\n  }\n};\n\nvar proto = SpacePoint.prototype;\n\nproto.equals = function (point) {\n  return (this.xy[0] === point.xy[0] &&\n    this.xy[1] === point.xy[1] &&\n    this._T.equals(point._T));\n  };\n\nproto.offset = function (dx, dy) {\n  // Create a new point nearby.\n  //\n  // Parameter\n  //   dx\n  //     Movement towards positive x\n  //   dy\n  //     ...\n  var xy = [this.xy[0] + dx, this.xy[1] + dy];\n  return new SpacePoint(xy, this);\n};\n\nproto.polarOffset = function (radius, radians) {\n  // Create a new point moved by the polar coordinates\n  var x = this.xy[0] + radius * Math.cos(radians);\n  var y = this.xy[1] + radius * Math.sin(radians);\n  return new SpacePoint([x, y], this);\n};\n\nproto.to = function (target) {\n  // Create a new SpacePoint at same location but on a\n  // different SpacePlane.\n  //\n  // Parameter\n  //   target, a SpacePlane or null.\n  //\n  // Implementation note (See 2016-03-05-09):\n  //\n  // First, compute coord. transf. B from the current plane\n  // to the space:\n  //   x_space = B * x_plane  <=>  x_plane = inv(B) * x_space\n  //   B = plane._T\n  // Second, let A be coord. transf. from the space to the target plane:\n  //   x_target = A * x_space\n  //   A = inv(target._T)\n  // Therefore combined coord. transf. C from the curr. plane to the target:\n  //   x_target = C * x_plane\n  //   <=> A * x_space = C * inv(B) * x_space\n  //   <=> A = C * inv(B)\n  //   <=> C = AB\n  //   <=> C = inv(target._T) * plane._T\n  //\n\n  if (target === null) {\n    // target is the root node (space)\n    return this.toSpace();\n  }\n\n  // Target's global transformation. This._T is already global.\n  var target_gT = target.getGlobalTransform();\n\n  if (target_gT.equals(this._T)) {\n    return this;\n  } // else\n  var C = target_gT.inverse().multiplyBy(this._T);\n  var xy_target = C.transform(this.xy);\n  return new SpacePoint(xy_target, target);\n};\n\nproto.toSpace = function () {\n  // Create a new SpacePoint at same location but represented on space coords.\n  //\n  // Implementation note:\n  //   We already have coord. transf. from the current plane to the space:\n  //     plane._T\n  var xy_space = this._T.transform(this.xy);\n  var space_mock = {'_T': Transform.IDENTITY};\n  return new SpacePoint(xy_space, space_mock);\n};\n\nproto.transform = function (tr) {\n  // Create a new point by transformation.\n  //\n  // Parameter\n  //   tr\n  //     a Transform\n  var xy_hat = tr.transform(this.xy);\n  return new SpacePoint(xy_hat, this);\n};\n\n\nmodule.exports = SpacePoint;\n","// API v0.6.0\nvar nudged = require('nudged');\n\n// TODO\n// monkeypatch \"to(plane)\"\n\nmodule.exports = nudged.Transform;\n","module.exports = function loadimages(imgSrcs, then) {\n  // Parameters\n  //   imgSrcs\n  //     array of image source paths OR single source path string.\n  //   then(err, imgElements)\n  //     Will be called after all the images are loaded. If string was given,\n  //     imgElements is an Image instead of array of Images.\n\n  var numberOfImages, stringGiven, thereWasSuccess, thereWasError, imgs;\n  var onloadsCalled, onload, onerror;\n\n  if (typeof then !== 'function') {\n    throw new Error('callback should be a function: ' + then);\n  }\n\n  if (typeof imgSrcs === 'string') {\n    numberOfImages = 1;\n    stringGiven = true;\n    imgSrcs = [imgSrcs]; // Normalize\n  } else {\n    // Array of images\n    numberOfImages = imgSrcs.length;\n    stringGiven = false;\n  }\n  thereWasSuccess = false;\n  thereWasError = false;\n\n  imgs = [];\n\n  onloadsCalled = 0;\n  onload = function () {\n    // Note:\n    //   this = Image\n    if (!thereWasError) {\n      onloadsCalled += 1;\n      var isFinalImage = (onloadsCalled === numberOfImages);\n      if (isFinalImage) {\n        thereWasSuccess = true;\n        if (stringGiven) {\n          then(null, imgs[0]);\n        } else {\n          then(null, imgs);\n        }\n      }\n    }\n  };\n\n  onerror = function (errMsg) {\n    // Note:\n    //   this = Image\n\n    // No errors after success.\n    if (!thereWasSuccess) {\n      thereWasError = true;\n      then(errMsg, null);\n    }\n\n    // Prevent firing the default event handler\n    // https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers.onerror#Parameters\n    return true;\n  };\n\n  for (i = 0; i < imgSrcs.length; i += 1) {\n    imgs.push(new Image());\n    imgs[i].onload = onload;\n    imgs[i].onerror = onerror;\n    imgs[i].src = imgSrcs[i];\n  }\n};\n","\n/**\n * Expose `Emitter`.\n */\n\nmodule.exports = Emitter;\n\n/**\n * Initialize a new `Emitter`.\n *\n * @api public\n */\n\nfunction Emitter(obj) {\n  if (obj) return mixin(obj);\n};\n\n/**\n * Mixin the emitter properties.\n *\n * @param {Object} obj\n * @return {Object}\n * @api private\n */\n\nfunction mixin(obj) {\n  for (var key in Emitter.prototype) {\n    obj[key] = Emitter.prototype[key];\n  }\n  return obj;\n}\n\n/**\n * Listen on the given `event` with `fn`.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.on =\nEmitter.prototype.addEventListener = function(event, fn){\n  this._callbacks = this._callbacks || {};\n  (this._callbacks['$' + event] = this._callbacks['$' + event] || [])\n    .push(fn);\n  return this;\n};\n\n/**\n * Adds an `event` listener that will be invoked a single\n * time then automatically removed.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.once = function(event, fn){\n  function on() {\n    this.off(event, on);\n    fn.apply(this, arguments);\n  }\n\n  on.fn = fn;\n  this.on(event, on);\n  return this;\n};\n\n/**\n * Remove the given callback for `event` or all\n * registered callbacks.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.off =\nEmitter.prototype.removeListener =\nEmitter.prototype.removeAllListeners =\nEmitter.prototype.removeEventListener = function(event, fn){\n  this._callbacks = this._callbacks || {};\n\n  // all\n  if (0 == arguments.length) {\n    this._callbacks = {};\n    return this;\n  }\n\n  // specific event\n  var callbacks = this._callbacks['$' + event];\n  if (!callbacks) return this;\n\n  // remove all handlers\n  if (1 == arguments.length) {\n    delete this._callbacks['$' + event];\n    return this;\n  }\n\n  // remove specific handler\n  var cb;\n  for (var i = 0; i < callbacks.length; i++) {\n    cb = callbacks[i];\n    if (cb === fn || cb.fn === fn) {\n      callbacks.splice(i, 1);\n      break;\n    }\n  }\n  return this;\n};\n\n/**\n * Emit `event` with the given args.\n *\n * @param {String} event\n * @param {Mixed} ...\n * @return {Emitter}\n */\n\nEmitter.prototype.emit = function(event){\n  this._callbacks = this._callbacks || {};\n  var args = [].slice.call(arguments, 1)\n    , callbacks = this._callbacks['$' + event];\n\n  if (callbacks) {\n    callbacks = callbacks.slice(0);\n    for (var i = 0, len = callbacks.length; i < len; ++i) {\n      callbacks[i].apply(this, args);\n    }\n  }\n\n  return this;\n};\n\n/**\n * Return array of callbacks for `event`.\n *\n * @param {String} event\n * @return {Array}\n * @api public\n */\n\nEmitter.prototype.listeners = function(event){\n  this._callbacks = this._callbacks || {};\n  return this._callbacks['$' + event] || [];\n};\n\n/**\n * Check if this emitter has `event` handlers.\n *\n * @param {String} event\n * @return {Boolean}\n * @api public\n */\n\nEmitter.prototype.hasListeners = function(event){\n  return !! this.listeners(event).length;\n};\n","/**\n * Module Dependencies.\n */\n\nvar Emitter = require('component-emitter');\nvar query = require('component-query');\nvar after = require('after-transition');\nvar has3d = require('has-translate3d');\nvar ease = require('css-ease');\n\n/**\n * CSS Translate\n */\n\nvar translate = has3d\n  ? ['translate3d(', ', 0)']\n  : ['translate(', ')'];\n\n/**\n * Export `Move`\n */\n\nmodule.exports = Move;\n\n/**\n * Get computed style.\n */\n\nvar style = window.getComputedStyle\n  || window.currentStyle;\n\n/**\n * Library version.\n */\n\nMove.version = '0.5.0';\n\n/**\n * Export `ease`\n */\n\nMove.ease = ease;\n\n/**\n * Defaults.\n *\n *   `duration` - default duration of 500ms\n *\n */\n\nMove.defaults = {\n  duration: 500\n};\n\n/**\n * Default element selection utilized by `move(selector)`.\n *\n * Override to implement your own selection, for example\n * with jQuery one might write:\n *\n *     move.select = function(selector) {\n *       return jQuery(selector).get(0);\n *     };\n *\n * @param {Object|String} selector\n * @return {Element}\n * @api public\n */\n\nMove.select = function(selector){\n  if ('string' != typeof selector) return selector;\n  return query(selector);\n};\n\n/**\n * Initialize a new `Move` with the given `el`.\n *\n * @param {Element} el\n * @api public\n */\n\nfunction Move(el) {\n  if (!(this instanceof Move)) return new Move(el);\n  if ('string' == typeof el) el = query(el);\n  if (!el) throw new TypeError('Move must be initialized with element or selector');\n  this.el = el;\n  this._props = {};\n  this._rotate = 0;\n  this._transitionProps = [];\n  this._transforms = [];\n  this.duration(Move.defaults.duration)\n};\n\n\n/**\n * Inherit from `EventEmitter.prototype`.\n */\n\nEmitter(Move.prototype);\n\n/**\n * Buffer `transform`.\n *\n * @param {String} transform\n * @return {Move} for chaining\n * @api private\n */\n\nMove.prototype.transform = function(transform){\n  this._transforms.push(transform);\n  return this;\n};\n\n/**\n * Skew `x` and `y`.\n *\n * @param {Number} x\n * @param {Number} y\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.skew = function(x, y){\n  return this.transform('skew('\n    + x + 'deg, '\n    + (y || 0)\n    + 'deg)');\n};\n\n/**\n * Skew x by `n`.\n *\n * @param {Number} n\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.skewX = function(n){\n  return this.transform('skewX(' + n + 'deg)');\n};\n\n/**\n * Skew y by `n`.\n *\n * @param {Number} n\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.skewY = function(n){\n  return this.transform('skewY(' + n + 'deg)');\n};\n\n/**\n * Translate `x` and `y` axis.\n *\n * @param {Number} x\n * @param {Number} y\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.translate =\nMove.prototype.to = function(x, y){\n  return this.transform(translate.join(''\n    + x +'px, '\n    + (y || 0)\n    + 'px'));\n};\n\n/**\n * Translate on the x axis to `n`.\n *\n * @param {Number} n\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.translateX =\nMove.prototype.x = function(n){\n  return this.transform('translateX(' + n + 'px)');\n};\n\n/**\n * Translate on the y axis to `n`.\n *\n * @param {Number} n\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.translateY =\nMove.prototype.y = function(n){\n  return this.transform('translateY(' + n + 'px)');\n};\n\n/**\n * Scale the x and y axis by `x`, or\n * individually scale `x` and `y`.\n *\n * @param {Number} x\n * @param {Number} y\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.scale = function(x, y){\n  return this.transform('scale('\n    + x + ', '\n    + (y || x)\n    + ')');\n};\n\n/**\n * Scale x axis by `n`.\n *\n * @param {Number} n\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.scaleX = function(n){\n  return this.transform('scaleX(' + n + ')')\n};\n\n/**\n * Apply a matrix transformation\n *\n * @param {Number} m11 A matrix coefficient\n * @param {Number} m12 A matrix coefficient\n * @param {Number} m21 A matrix coefficient\n * @param {Number} m22 A matrix coefficient\n * @param {Number} m31 A matrix coefficient\n * @param {Number} m32 A matrix coefficient\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.matrix = function(m11, m12, m21, m22, m31, m32){\n  return this.transform('matrix(' + [m11,m12,m21,m22,m31,m32].join(',') + ')');\n};\n\n/**\n * Scale y axis by `n`.\n *\n * @param {Number} n\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.scaleY = function(n){\n  return this.transform('scaleY(' + n + ')')\n};\n\n/**\n * Rotate `n` degrees.\n *\n * @param {Number} n\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.rotate = function(n){\n  return this.transform('rotate(' + n + 'deg)');\n};\n\n/**\n * Set transition easing function to to `fn` string.\n *\n * When:\n *\n *   - null \"ease\" is used\n *   - \"in\" \"ease-in\" is used\n *   - \"out\" \"ease-out\" is used\n *   - \"in-out\" \"ease-in-out\" is used\n *\n * @param {String} fn\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.ease = function(fn){\n  fn = ease[fn] || fn || 'ease';\n  return this.setVendorProperty('transition-timing-function', fn);\n};\n\n/**\n * Set animation properties\n *\n * @param {String} name\n * @param {Object} props\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.animate = function(name, props){\n  for (var i in props){\n    if (props.hasOwnProperty(i)){\n      this.setVendorProperty('animation-' + i, props[i])\n    }\n  }\n  return this.setVendorProperty('animation-name', name);\n}\n\n/**\n * Set duration to `n`.\n *\n * @param {Number|String} n\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.duration = function(n){\n  n = this._duration = 'string' == typeof n\n    ? parseFloat(n) * 1000\n    : n;\n  return this.setVendorProperty('transition-duration', n + 'ms');\n};\n\n/**\n * Delay the animation by `n`.\n *\n * @param {Number|String} n\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.delay = function(n){\n  n = 'string' == typeof n\n    ? parseFloat(n) * 1000\n    : n;\n  return this.setVendorProperty('transition-delay', n + 'ms');\n};\n\n/**\n * Set `prop` to `val`, deferred until `.end()` is invoked.\n *\n * @param {String} prop\n * @param {String} val\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.setProperty = function(prop, val){\n  this._props[prop] = val;\n  return this;\n};\n\n/**\n * Set a vendor prefixed `prop` with the given `val`.\n *\n * @param {String} prop\n * @param {String} val\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.setVendorProperty = function(prop, val){\n  this.setProperty('-webkit-' + prop, val);\n  this.setProperty('-moz-' + prop, val);\n  this.setProperty('-ms-' + prop, val);\n  this.setProperty('-o-' + prop, val);\n  return this;\n};\n\n/**\n * Set `prop` to `value`, deferred until `.end()` is invoked\n * and adds the property to the list of transition props.\n *\n * @param {String} prop\n * @param {String} val\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.set = function(prop, val){\n  this.transition(prop);\n  this._props[prop] = val;\n  return this;\n};\n\n/**\n * Increment `prop` by `val`, deferred until `.end()` is invoked\n * and adds the property to the list of transition props.\n *\n * @param {String} prop\n * @param {Number} val\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.add = function(prop, val){\n  if (!style) return;\n  var self = this;\n  return this.on('start', function(){\n    var curr = parseInt(self.current(prop), 10);\n    self.set(prop, curr + val + 'px');\n  });\n};\n\n/**\n * Decrement `prop` by `val`, deferred until `.end()` is invoked\n * and adds the property to the list of transition props.\n *\n * @param {String} prop\n * @param {Number} val\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.sub = function(prop, val){\n  if (!style) return;\n  var self = this;\n  return this.on('start', function(){\n    var curr = parseInt(self.current(prop), 10);\n    self.set(prop, curr - val + 'px');\n  });\n};\n\n/**\n * Get computed or \"current\" value of `prop`.\n *\n * @param {String} prop\n * @return {String}\n * @api public\n */\n\nMove.prototype.current = function(prop){\n  return style(this.el).getPropertyValue(prop);\n};\n\n/**\n * Add `prop` to the list of internal transition properties.\n *\n * @param {String} prop\n * @return {Move} for chaining\n * @api private\n */\n\nMove.prototype.transition = function(prop){\n  if (!this._transitionProps.indexOf(prop)) return this;\n  this._transitionProps.push(prop);\n  return this;\n};\n\n/**\n * Commit style properties, aka apply them to `el.style`.\n *\n * @return {Move} for chaining\n * @see Move#end()\n * @api private\n */\n\nMove.prototype.applyProperties = function(){\n  for (var prop in this._props) {\n    this.el.style.setProperty(prop, this._props[prop], '');\n  }\n  return this;\n};\n\n/**\n * Re-select element via `selector`, replacing\n * the current element.\n *\n * @param {String} selector\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.move =\nMove.prototype.select = function(selector){\n  this.el = Move.select(selector);\n  return this;\n};\n\n/**\n * Defer the given `fn` until the animation\n * is complete. `fn` may be one of the following:\n *\n *   - a function to invoke\n *   - an instanceof `Move` to call `.end()`\n *   - nothing, to return a clone of this `Move` instance for chaining\n *\n * @param {Function|Move} fn\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.then = function(fn){\n  // invoke .end()\n  if (fn instanceof Move) {\n    this.on('end', function(){\n      fn.end();\n    });\n  // callback\n  } else if ('function' == typeof fn) {\n    this.on('end', fn);\n  // chain\n  } else {\n    var clone = new Move(this.el);\n    clone._transforms = this._transforms.slice(0);\n    this.then(clone);\n    clone.parent = this;\n    return clone;\n  }\n\n  return this;\n};\n\n/**\n * Pop the move context.\n *\n * @return {Move} parent Move\n * @api public\n */\n\nMove.prototype.pop = function(){\n  return this.parent;\n};\n\n/**\n * Reset duration.\n *\n * @return {Move}\n * @api public\n */\n\nMove.prototype.reset = function(){\n  this.el.style.webkitTransitionDuration =\n  this.el.style.mozTransitionDuration =\n  this.el.style.msTransitionDuration =\n  this.el.style.oTransitionDuration = '';\n  return this;\n};\n\n/**\n * Start animation, optionally calling `fn` when complete.\n *\n * @param {Function} fn\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.end = function(fn){\n  var self = this;\n\n  // emit \"start\" event\n  this.emit('start');\n\n  // transforms\n  if (this._transforms.length) {\n    this.setVendorProperty('transform', this._transforms.join(' '));\n  }\n\n  // transition properties\n  this.setVendorProperty('transition-properties', this._transitionProps.join(', '));\n  this.applyProperties();\n\n  // callback given\n  if (fn) this.then(fn);\n\n  // emit \"end\" when complete\n  after.once(this.el, function(){\n    self.reset();\n    self.emit('end');\n  });\n\n  return this;\n};\n","\"use strict\";\n\nmodule.exports = SeqId\n\nfunction SeqId(initial) {\n  if (!(this instanceof SeqId)) {\n    return new SeqId(initial)\n  }\n  if (initial == null) {\n    initial = (Math.random() - 0.5) * Math.pow(2, 32)\n  }\n  this._id = initial | 0\n}\nSeqId.prototype.next = function () {\n  this._id = (this._id + 1) | 0\n  return this._id\n}\n","/*\n\n*/\nexports.Transform = require('./lib/Transform');\nexports.estimateT = require('./lib/estimateT');\nexports.estimateS = require('./lib/estimateS');\nexports.estimateR = require('./lib/estimateR');\nexports.estimateTS = require('./lib/estimateTS');\nexports.estimateTR = require('./lib/estimateTR');\nexports.estimateSR = require('./lib/estimateSR');\nexports.estimateTSR = require('./lib/estimateTSR');\nexports.version = require('./lib/version');\n\nexports.estimate = function (type, domain, range, pivot) {\n  // Parameter\n  //   type\n  //     string. One of the following: 'T', 'S', 'R', 'TS', 'TR', 'SR', 'TSR'\n  //   domain\n  //     array of 2d arrays\n  //   range\n  //     array of 2d arrays\n  //   pivot\n  //     optional 2d array, does nothing for translation estimators\n  var name = 'estimate' + type.toUpperCase();\n  if (exports.hasOwnProperty(name)) {\n    return exports[name](domain, range, pivot);\n  } // else\n  throw new Error('Unknown estimator type: ' + type);\n};\n","\n/**\n * CSS Easing functions\n */\n\nmodule.exports = {\n    'in':                'ease-in'\n  , 'out':               'ease-out'\n  , 'in-out':            'ease-in-out'\n  , 'snap':              'cubic-bezier(0,1,.5,1)'\n  , 'linear':            'cubic-bezier(0.250, 0.250, 0.750, 0.750)'\n  , 'ease-in-quad':      'cubic-bezier(0.550, 0.085, 0.680, 0.530)'\n  , 'ease-in-cubic':     'cubic-bezier(0.550, 0.055, 0.675, 0.190)'\n  , 'ease-in-quart':     'cubic-bezier(0.895, 0.030, 0.685, 0.220)'\n  , 'ease-in-quint':     'cubic-bezier(0.755, 0.050, 0.855, 0.060)'\n  , 'ease-in-sine':      'cubic-bezier(0.470, 0.000, 0.745, 0.715)'\n  , 'ease-in-expo':      'cubic-bezier(0.950, 0.050, 0.795, 0.035)'\n  , 'ease-in-circ':      'cubic-bezier(0.600, 0.040, 0.980, 0.335)'\n  , 'ease-in-back':      'cubic-bezier(0.600, -0.280, 0.735, 0.045)'\n  , 'ease-out-quad':     'cubic-bezier(0.250, 0.460, 0.450, 0.940)'\n  , 'ease-out-cubic':    'cubic-bezier(0.215, 0.610, 0.355, 1.000)'\n  , 'ease-out-quart':    'cubic-bezier(0.165, 0.840, 0.440, 1.000)'\n  , 'ease-out-quint':    'cubic-bezier(0.230, 1.000, 0.320, 1.000)'\n  , 'ease-out-sine':     'cubic-bezier(0.390, 0.575, 0.565, 1.000)'\n  , 'ease-out-expo':     'cubic-bezier(0.190, 1.000, 0.220, 1.000)'\n  , 'ease-out-circ':     'cubic-bezier(0.075, 0.820, 0.165, 1.000)'\n  , 'ease-out-back':     'cubic-bezier(0.175, 0.885, 0.320, 1.275)'\n  , 'ease-out-quad':     'cubic-bezier(0.455, 0.030, 0.515, 0.955)'\n  , 'ease-out-cubic':    'cubic-bezier(0.645, 0.045, 0.355, 1.000)'\n  , 'ease-in-out-quart': 'cubic-bezier(0.770, 0.000, 0.175, 1.000)'\n  , 'ease-in-out-quint': 'cubic-bezier(0.860, 0.000, 0.070, 1.000)'\n  , 'ease-in-out-sine':  'cubic-bezier(0.445, 0.050, 0.550, 0.950)'\n  , 'ease-in-out-expo':  'cubic-bezier(1.000, 0.000, 0.000, 1.000)'\n  , 'ease-in-out-circ':  'cubic-bezier(0.785, 0.135, 0.150, 0.860)'\n  , 'ease-in-out-back':  'cubic-bezier(0.680, -0.550, 0.265, 1.550)'\n};\n","function one(selector, el) {\n  return el.querySelector(selector);\n}\n\nexports = module.exports = function(selector, el){\n  el = el || document;\n  return one(selector, el);\n};\n\nexports.all = function(selector, el){\n  el = el || document;\n  return el.querySelectorAll(selector);\n};\n\nexports.engine = function(obj){\n  if (!obj.one) throw new Error('.one callback required');\n  if (!obj.all) throw new Error('.all callback required');\n  one = obj.one;\n  exports.all = obj.all;\n  return exports;\n};\n","var hasTransitions = require('has-transitions');\nvar emitter = require('css-emitter');\n\nfunction afterTransition(el, callback) {\n  if(hasTransitions(el)) {\n    return emitter(el).bind(callback);\n  }\n  return callback.apply(el);\n};\n\nafterTransition.once = function(el, callback) {\n  afterTransition(el, function fn(){\n    callback.apply(el);\n    emitter(el).unbind(fn);\n  });\n};\n\nmodule.exports = afterTransition;","\nvar prop = require('transform-property');\n\n// IE <=8 doesn't have `getComputedStyle`\nif (!prop || !window.getComputedStyle) {\n  module.exports = false;\n\n} else {\n  var map = {\n    webkitTransform: '-webkit-transform',\n    OTransform: '-o-transform',\n    msTransform: '-ms-transform',\n    MozTransform: '-moz-transform',\n    transform: 'transform'\n  };\n\n  // from: https://gist.github.com/lorenzopolidori/3794226\n  var el = document.createElement('div');\n  el.style[prop] = 'translate3d(1px,1px,1px)';\n  document.body.insertBefore(el, null);\n  var val = getComputedStyle(el).getPropertyValue(map[prop]);\n  document.body.removeChild(el);\n  module.exports = null != val && val.length && 'none' != val;\n}\n","\nvar Transform = function (s, r, tx, ty) {\n\n  // Public, to allow user access\n  this.s = s;\n  this.r = r;\n  this.tx = tx;\n  this.ty = ty;\n\n  this.equals = function (t) {\n    return (s === t.s && r === t.r && tx === t.tx && ty === t.ty);\n  };\n\n  this.transform = function (p) {\n    // p\n    //   point [x, y] or array of points [[x1,y1], [x2, y2], ...]\n\n    if (typeof p[0] === 'number') {\n      // Single point\n      return [s * p[0] - r * p[1] + tx, r * p[0] + s * p[1] + ty];\n    } // else\n\n    var i, c = [];\n    for (i = 0; i < p.length; i += 1) {\n      c.push([s * p[i][0] - r * p[i][1] + tx, r * p[i][0] + s * p[i][1] + ty]);\n    }\n    return c;\n  };\n\n  this.getMatrix = function () {\n    // Get the transformation matrix in the format common to\n    // many APIs, including:\n    // - kld-affine\n    //\n    // Return\n    //   object o, having properties a, b, c, d, e, f:\n    //   [ s  -r  tx ]   [ o.a  o.c  o.e ]\n    //   [ r   s  ty ] = [ o.b  o.d  o.f ]\n    //   [ 0   0   1 ]   [  -    -    -  ]\n    return { a: s, b: r, c: -r, d: s, e: tx, f: ty };\n  };\n\n  this.getRotation = function () {\n    // in rads\n    return Math.atan2(r, s);\n  };\n\n  this.getScale = function () {\n    // scale multiplier\n    return Math.sqrt(r * r + s * s);\n  };\n\n  this.getTranslation = function () {\n    return [tx, ty];\n  };\n\n  this.inverse = function () {\n    // Return inversed transform instance\n    // See note 2015-10-26-16-30\n    var det = s * s + r * r;\n    // Test if singular transformation. These might occur when all the range\n    // points are the same, forcing the scale to drop to zero.\n    var eps = 0.00000001;\n    if (Math.abs(det) < eps) {\n      throw new Error('Singular transformations cannot be inversed.');\n    }\n    var shat = s / det;\n    var rhat = -r / det;\n    var txhat = (-s * tx - r * ty) / det;\n    var tyhat = ( r * tx - s * ty) / det;\n    return new Transform(shat, rhat, txhat, tyhat);\n  };\n\n  this.translateBy = function (dx, dy) {\n    return new Transform(s, r, tx + dx, ty + dy);\n  };\n\n  this.scaleBy = function (multiplier, pivot) {\n    // Parameter\n    //   multiplier\n    //   pivot\n    //     optional, a [x, y] point\n    var m, x, y;\n    m = multiplier; // alias\n    if (typeof pivot === 'undefined') {\n      x = y = 0;\n    } else {\n      x = pivot[0];\n      y = pivot[1];\n    }\n    return new Transform(m * s, m * r, m * tx + (1-m) * x, m * ty + (1-m) * y);\n  };\n\n  this.rotateBy = function (radians, pivot) {\n    // Parameter\n    //   radians\n    //     from positive x to positive y axis\n    //   pivot\n    //     optional, a [x, y] point\n    var co, si, x, y, shat, rhat, txhat, tyhat;\n    co = Math.cos(radians);\n    si = Math.sin(radians);\n    if (typeof pivot === 'undefined') {\n      x = y = 0;\n    } else {\n      x = pivot[0];\n      y = pivot[1];\n    }\n    shat = s * co - r * si;\n    rhat = s * si + r * co;\n    txhat = (tx - x) * co - (ty - y) * si + x;\n    tyhat = (tx - x) * si + (ty - y) * co + y;\n    return new Transform(shat, rhat, txhat, tyhat);\n  };\n\n\n  this.multiplyBy = function (transform) {\n    // Multiply this transformation matrix A\n    // from the right with the given transformation matrix B\n    // and return the result AB\n\n    // For reading aid:\n    // s -r tx  t.s -r tx\n    // r  s ty *  r  s ty\n    // 0  0  1    0  0  1\n    var t = transform; // alias\n    var shat = s * t.s - r * t.r;\n    var rhat = s * t.r + r * t.s;\n    var txhat = s * t.tx - r * t.ty + tx;\n    var tyhat = r * t.tx + s * t.ty + ty;\n    return new Transform(shat, rhat, txhat, tyhat);\n  };\n};\n\nTransform.IDENTITY = new Transform(1, 0, 0, 0);\n\nmodule.exports = Transform;\n","var Transform = require('./Transform');\n\nmodule.exports = function (domain, range) {\n  var i, N, a1, b1, c1, d1, txhat, tyhat;\n\n  N = Math.min(domain.length, range.length);\n  a1 = b1 = c1 = d1 = 0;\n\n  if (N < 1) {\n    // Assume identity transform be the best guess\n    return Transform.IDENTITY;\n  }\n\n  for (i = 0; i < N; i += 1) {\n    a1 += domain[i][0];\n    b1 += domain[i][1];\n    c1 += range[i][0];\n    d1 += range[i][1];\n  }\n\n  txhat = (c1 - a1) / N;\n  tyhat = (d1 - b1) / N;\n\n  return new Transform(1, 0, txhat, tyhat);\n};\n","var Transform = require('./Transform');\n\nmodule.exports = function (domain, range, pivot) {\n  var i, N, D, a0, b0, a, b, c, d, ac, bd, aa, bb, shat, tx, ty;\n\n  N = Math.min(domain.length, range.length);\n  ac = bd = aa = bb = 0;\n\n  if (typeof pivot === 'undefined') {\n    a0 = b0 = 0;\n  } else {\n    a0 = pivot[0];\n    b0 = pivot[1];\n  }\n\n  for (i = 0; i < N; i += 1) {\n    a = domain[i][0] - a0;\n    b = domain[i][1] - b0;\n    c = range[i][0] - a0;\n    d = range[i][1] - b0;\n    ac += a * c;\n    bd += b * d;\n    aa += a * a;\n    bb += b * b;\n  }\n\n  D = aa + bb;\n\n  if (D === 0) {\n    // All domain points equal the pivot.\n    // Identity transform is then only solution.\n    // D === 0 also if N === 0.\n    // Assume identity transform to be the best guess\n    return Transform.IDENTITY;\n  }\n\n  // Prevent negative scaling because it would be same as positive scaling\n  // and rotation => limit to zero\n  shat = Math.max(0, (ac + bd) / D);\n  tx = (1 - shat) * a0;\n  ty = (1 - shat) * b0;\n\n  return new Transform(shat, 0, tx, ty);\n};\n","var Transform = require('./Transform');\n\nmodule.exports = function (domain, range, pivot) {\n  var i, N, D, a0, b0, a, b, c, d, ac, ad, bc, bd, shat, rhat, tx, ty;\n\n  N = Math.min(domain.length, range.length);\n  ac = ad = bc = bd = 0;\n\n  if (typeof pivot === 'undefined') {\n    a0 = b0 = 0;\n  } else {\n    a0 = pivot[0];\n    b0 = pivot[1];\n  }\n\n  for (i = 0; i < N; i += 1) {\n    a = domain[i][0] - a0;\n    b = domain[i][1] - b0;\n    c = range[i][0] - a0;\n    d = range[i][1] - b0;\n    ac += a * c;\n    ad += a * d;\n    bc += b * c;\n    bd += b * d;\n  }\n\n  p = ac + bd;\n  q = ad - bc;\n\n  D = Math.sqrt(p * p + q * q);\n\n  if (D === 0) {\n    // D === 0\n    // <=> q === 0 and p === 0.\n    // <=> ad === bc and ac === -bd\n    // <=> domain in pivot OR range in pivot OR yet unknown cases\n    //     where the angle cannot be determined.\n    // D === 0 also if N === 0.\n    // Assume identity transform to be the best guess\n    return Transform.IDENTITY;\n  }\n\n  shat = p / D;\n  rhat = q / D;\n  tx = a0 - a0 * shat + b0 * rhat;\n  ty = b0 - a0 * rhat - b0 * shat;\n\n  return new Transform(shat, rhat, tx, ty);\n};\n","var Transform = require('./Transform');\n\nmodule.exports = function (domain, range) {\n  // Parameters\n  //   domain\n  //     array of [x, y] 2D arrays\n  //   range\n  //     array of [x, y] 2D arrays\n\n  // Alias\n  var X = domain;\n  var Y = range;\n\n  // Allow arrays of different length but\n  // ignore the extra points.\n  var N = Math.min(X.length, Y.length);\n\n  var i, a, b, c, d, a1, b1, c1, d1, a2, b2, ac, bd;\n  a1 = b1 = c1 = d1 = a2 = b2 = ac = bd = 0;\n  for (i = 0; i < N; i += 1) {\n    a = X[i][0];\n    b = X[i][1];\n    c = Y[i][0];\n    d = Y[i][1];\n    a1 += a;\n    b1 += b;\n    c1 += c;\n    d1 += d;\n    a2 += a * a;\n    b2 += b * b;\n    ac += a * c;\n    bd += b * d;\n  }\n\n  // Denominator.\n  var N2 = N * N;\n  var a12 = a1 * a1;\n  var b12 = b1 * b1;\n  var p = a2 + b2;\n  var q = ac + bd;\n  var D = N2 * p - N * (a12 + b12);\n\n  if (D === 0) {\n    // N === 0 => D === 0\n    if (N === 0) {\n      return new Transform(1, 0, 0, 0);\n    } // else\n    // D === 0 <=> all the domain points are the same\n    // We guess the translation to the mean of the range to be the best guess.\n    // Here a, b represents the mean of domain points.\n    return new Transform(1, 0, (c1 / N) - a, (d1 / N) - b);\n  }\n\n  // Estimators\n  var shat = (N2 * q - N * (a1 * c1 + b1 * d1)) / D;\n  var txhat = (-N * a1 * q + N * c1 * p - b12 * c1 + a1 * b1 * d1) / D;\n  var tyhat = (-N * b1 * q + N * d1 * p - a12 * d1 + a1 * b1 * c1) / D;\n\n  return new Transform(shat, 0, txhat, tyhat);\n};\n","var Transform = require('./Transform');\n\nmodule.exports = function (domain, range) {\n  // Parameters\n  //   domain\n  //     array of [x, y] 2D arrays\n  //   range\n  //     array of [x, y] 2D arrays\n\n  // Alias\n  var X = domain;\n  var Y = range;\n\n  // Allow arrays of different length but\n  // ignore the extra points.\n  var N = Math.min(X.length, Y.length);\n\n  var i, a, b, c, d, a1, b1, c1, d1, ac, ad, bc, bd;\n  a1 = b1 = c1 = d1 = ac = ad = bc = bd = 0;\n  for (i = 0; i < N; i += 1) {\n    a = X[i][0];\n    b = X[i][1];\n    c = Y[i][0];\n    d = Y[i][1];\n    a1 += a;\n    b1 += b;\n    c1 += c;\n    d1 += d;\n    ac += a * c;\n    ad += a * d;\n    bc += b * c;\n    bd += b * d;\n  }\n\n  // Denominator.\n  var v = N * (ad - bc) - a1 * d1 + b1 * c1;\n  var w = N * (ac + bd) - a1 * c1 - b1 * d1;\n  var D = Math.sqrt(v * v + w * w);\n\n  if (D === 0) {\n    // N === 0 => D === 0\n    if (N === 0) {\n      return new Transform(1, 0, 0, 0);\n    } // else\n    // D === 0 <=> undecidable\n    // We guess the translation to the mean of the range to be the best guess.\n    // Here a, b represents the mean of domain points.\n    return new Transform(1, 0, (c1 - a1) / N, (d1 - b1) / N);\n  }\n\n  // Estimators\n  var shat = w / D;\n  var rhat = v / D;\n  var txhat = (-a1 * shat + b1 * rhat + c1) / N;\n  var tyhat = (-a1 * rhat - b1 * shat + d1) / N;\n\n  return new Transform(shat, rhat, txhat, tyhat);\n};\n","var Transform = require('./Transform');\n\nmodule.exports = function (domain, range, pivot) {\n  // Estimate optimal transformation given the domain and the range\n  // so that the pivot point remains the same.\n  //\n  // Use cases\n  //   - transform an image that has one corner fixed with a pin.\n  //   - allow only scale and rotation by fixing the middle of the object\n  //     to transform.\n  //\n  // Parameters\n  //   domain, an array of [x, y] points\n  //   range, an array of [x, y] points\n  //   pivot, optional\n  //     the point [x, y] that must remain constant in the tranformation.\n  //     Defaults to origo [0, 0]\n  //\n  //\n  var X, Y, N, s, r, tx, ty;\n\n  // Optional pivot\n  if (typeof pivot === 'undefined') {\n    pivot = [0, 0];\n  }\n\n  // Alias\n  X = domain;\n  Y = range;\n\n  // Allow arrays of different length but\n  // ignore the extra points.\n  N = Math.min(X.length, Y.length);\n\n  var v = pivot[0];\n  var w = pivot[1];\n\n  var i, a, b, c, d;\n  var a2, b2;\n  a2 = b2 = 0;\n  var ac, bd, bc, ad;\n  ac = bd = bc = ad = 0;\n\n  for (i = 0; i < N; i += 1) {\n    a = X[i][0] - v;\n    b = X[i][1] - w;\n    c = Y[i][0] - v;\n    d = Y[i][1] - w;\n    a2 += a * a;\n    b2 += b * b;\n    ac += a * c;\n    bd += b * d;\n    bc += b * c;\n    ad += a * d;\n  }\n\n  // Denominator = determinant.\n  // It becomes zero iff N = 0 or X[i] = [v, w] for every i in [0, n).\n  // In other words, iff all the domain points are under the fixed point or\n  // there is no domain points.\n  var den = a2 + b2;\n\n  var eps = 0.00000001;\n  if (Math.abs(den) < eps) {\n    // The domain points are under the pivot or there is no domain points.\n    // We assume identity transform be the simplest guess. It keeps\n    // the domain points under the pivot if there is some.\n    return new Transform(1, 0, 0, 0);\n  }\n\n  // Estimators\n  s = (ac + bd) / den;\n  r = (-bc + ad) / den;\n  tx =  w * r - v * s + v;\n  ty = -v * r - w * s + w;\n\n  return new Transform(s, r, tx, ty);\n};\n","var Transform = require('./Transform');\n\nmodule.exports = function (domain, range) {\n  // Parameters\n  //   domain\n  //     array of [x, y] 2D arrays\n  //   range\n  //     array of [x, y] 2D arrays\n  var X, Y, N, s, r, tx, ty;\n\n  // Alias\n  X = domain;\n  Y = range;\n\n  // Allow arrays of different length but\n  // ignore the extra points.\n  N = Math.min(X.length, Y.length);\n\n  // If length is zero, no estimation can be done. We choose the indentity\n  // transformation be the best quess.\n  if (N === 0) {\n    return new Transform(1, 0, 0, 0);\n  } // else\n\n  var i, a, b, c, d;\n  var a1 = 0;\n  var b1 = 0;\n  var c1 = 0;\n  var d1 = 0;\n  var a2 = 0;\n  var b2 = 0;\n  var ad = 0;\n  var bc = 0;\n  var ac = 0;\n  var bd = 0;\n  for (i = 0; i < N; i += 1) {\n    a = X[i][0];\n    b = X[i][1];\n    c = Y[i][0];\n    d = Y[i][1];\n    a1 += a;\n    b1 += b;\n    c1 += c;\n    d1 += d;\n    a2 += a * a;\n    b2 += b * b;\n    ad += a * d;\n    bc += b * c;\n    ac += a * c;\n    bd += b * d;\n  }\n\n  // Denominator.\n  // It is zero iff X[i] = X[j] for every i and j in [0, n).\n  // In other words, iff all the domain points are the same or there is only one domain point.\n  var den = N * a2 + N * b2 - a1 * a1 - b1 * b1;\n\n  var eps = 0.00000001;\n  if (-eps < den && den < eps) {\n    // The domain points are the same.\n    // We guess the translation to the mean of the range to be the best guess.\n    // Here a, b represents the mean of domain points.\n    return new Transform(1, 0, (c1 / N) - a, (d1 / N) - b);\n  }\n\n  // Estimators\n  s = (N * (ac + bd) - a1 * c1 - b1 * d1) / den;\n  r = (N * (ad - bc) + b1 * c1 - a1 * d1) / den;\n  tx = (-a1 * (ac + bd) + b1 * (ad - bc) + a2 * c1 + b2 * c1) / den;\n  ty = (-b1 * (ac + bd) - a1 * (ad - bc) + a2 * d1 + b2 * d1) / den;\n\n  return new Transform(s, r, tx, ty);\n};\n","module.exports = '1.0.1';\n","/**\n * Module Dependencies\n */\n\nvar events = require('event');\n\n// CSS events\n\nvar watch = [\n  'transitionend'\n, 'webkitTransitionEnd'\n, 'oTransitionEnd'\n, 'MSTransitionEnd'\n, 'animationend'\n, 'webkitAnimationEnd'\n, 'oAnimationEnd'\n, 'MSAnimationEnd'\n];\n\n/**\n * Expose `CSSnext`\n */\n\nmodule.exports = CssEmitter;\n\n/**\n * Initialize a new `CssEmitter`\n *\n */\n\nfunction CssEmitter(element){\n  if (!(this instanceof CssEmitter)) return new CssEmitter(element);\n  this.el = element;\n}\n\n/**\n * Bind CSS events.\n *\n * @api public\n */\n\nCssEmitter.prototype.bind = function(fn){\n  for (var i=0; i < watch.length; i++) {\n    events.bind(this.el, watch[i], fn);\n  }\n  return this;\n};\n\n/**\n * Unbind CSS events\n * \n * @api public\n */\n\nCssEmitter.prototype.unbind = function(fn){\n  for (var i=0; i < watch.length; i++) {\n    events.unbind(this.el, watch[i], fn);\n  }\n  return this;\n};\n\n/**\n * Fire callback only once\n * \n * @api public\n */\n\nCssEmitter.prototype.once = function(fn){\n  var self = this;\n  function on(){\n    self.unbind(on);\n    fn.apply(self.el, arguments);\n  }\n  self.bind(on);\n  return this;\n};\n\n","/**\n * This will store the property that the current\n * browser uses for transitionDuration\n */\nvar property;\n\n/**\n * The properties we'll check on an element\n * to determine if it actually has transitions\n * We use duration as this is the only property\n * needed to technically have transitions\n * @type {Array}\n */\nvar types = [\n  \"transitionDuration\",\n  \"MozTransitionDuration\",\n  \"webkitTransitionDuration\"\n];\n\n/**\n * Determine the correct property for this browser\n * just once so we done need to check every time\n */\nwhile(types.length) {\n  var type = types.shift();\n  if(type in document.body.style) {\n    property = type;\n  }\n}\n\n/**\n * Determine if the browser supports transitions or\n * if an element has transitions at all.\n * @param  {Element}  el Optional. Returns browser support if not included\n * @return {Boolean}\n */\nfunction hasTransitions(el){\n  if(!property) {\n    return false; // No browser support for transitions\n  }\n  if(!el) {\n    return property != null; // We just want to know if browsers support it\n  }\n  var duration = getComputedStyle(el)[property];\n  return duration !== \"\" && parseFloat(duration) !== 0; // Does this element have transitions?\n}\n\nmodule.exports = hasTransitions;","\nvar styles = [\n  'webkitTransform',\n  'MozTransform',\n  'msTransform',\n  'OTransform',\n  'transform'\n];\n\nvar el = document.createElement('p');\nvar style;\n\nfor (var i = 0; i < styles.length; i++) {\n  style = styles[i];\n  if (null != el.style[style]) {\n    module.exports = style;\n    break;\n  }\n}\n","\n/**\n * Bind `el` event `type` to `fn`.\n *\n * @param {Element} el\n * @param {String} type\n * @param {Function} fn\n * @param {Boolean} capture\n * @return {Function}\n * @api public\n */\n\nexports.bind = function(el, type, fn, capture){\n  if (el.addEventListener) {\n    el.addEventListener(type, fn, capture);\n  } else {\n    el.attachEvent('on' + type, fn);\n  }\n  return fn;\n};\n\n/**\n * Unbind `el` event `type`'s callback `fn`.\n *\n * @param {Element} el\n * @param {String} type\n * @param {Function} fn\n * @param {Boolean} capture\n * @return {Function}\n * @api public\n */\n\nexports.unbind = function(el, type, fn, capture){\n  if (el.removeEventListener) {\n    el.removeEventListener(type, fn, capture);\n  } else {\n    el.detachEvent('on' + type, fn);\n  }\n  return fn;\n};\n"]}