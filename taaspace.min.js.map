{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","src/index.js","src/SpacePoint.js","src/Transform.js","src/SpaceTransform.js","src/Taa.js","src/SpaceTaa.js","src/SpaceHTML.js","src/SpacePixel.js","src/Space.js","src/HTMLSpaceView.js","src/version.js","src/SpaceNode.js","src/SpacePlane.js","src/SpaceTransformer.js","src/SpaceRectangle.js","node_modules/loadimages/index.js","node_modules/nudged/index.js","node_modules/component-emitter/index.js","node_modules/movejs/index.js","node_modules/seqid/seqid.js","node_modules/nudged/lib/Transform.js","node_modules/nudged/lib/estimateT.js","node_modules/nudged/lib/estimateS.js","node_modules/nudged/lib/estimateR.js","node_modules/nudged/lib/estimateTS.js","node_modules/nudged/lib/estimateSR.js","node_modules/nudged/lib/estimateTR.js","node_modules/nudged/lib/estimateTSR.js","node_modules/nudged/lib/version.js","node_modules/movejs/node_modules/after-transition/index.js","node_modules/movejs/node_modules/css-ease/index.js","node_modules/movejs/node_modules/component-query/index.js","node_modules/movejs/node_modules/has-translate3d/index.js","node_modules/movejs/node_modules/after-transition/node_modules/has-transitions/index.js","node_modules/movejs/node_modules/has-translate3d/node_modules/transform-property/index.js","node_modules/movejs/node_modules/after-transition/node_modules/css-emitter-component/index.js","node_modules/movejs/node_modules/after-transition/node_modules/css-emitter-component/node_modules/event-component/index.js"],"names":["exports","SpacePoint","require","Transform","SpaceTransform","Taa","SpaceTaa","SpaceHTML","SpacePixel","Space","HTMLSpaceView","version","xy","reference","this","hasOwnProperty","_T","getGlobalTransform","proto","prototype","equals","point","offset","dx","dy","polarOffset","radius","radians","x","Math","cos","y","sin","to","target","toSpace","target_gT","C","inverse","multiplyBy","xy_target","transform","xySpace","spaceMock","IDENTITY","tr","xy_hat","normalize","points","plane","i","p","normalized","length","push","toXY","xys","module","nudged","T","st","targetGT","this2target","tOnTarget","tOnSpace","translate","domain","range","ndom","nran","spaceE","planeE","estimate","Emitter","loadimages","NOOP","imgSrc","onLoaded","this2","image","src","notCached","err","emiterr","emittaa","emit","setTimeout","SpaceNode","SpacePlane","SpaceTransformer","SpaceRectangle","parent","taa","resize","setParent","html","getHTML","move","defaults","duration","space","htmlContainer","_el","_elements","_nodes","w","clientWidth","h","clientHeight","_hasNodeId","nodeid","transformNode","htmlElement","spaceNode","node_global_T","prec","s","toFixed","r","tx","ty","matrix","end","getViewSpecificId","spaceNodeId","id","transformedHandler","nodes","node","el","getDescendants","resizedHandler","wh","getSize","style","width","height","contentAddedHandler","newParent","oldParent","getRootParent","Image","className","appendChild","on","document","createElement","innerHTML","Exception","contentRemovedHandler","sameRoot","removeChild","off","self","newSpace","oldSpace","des","element","getElementBySpaceNode","getSpaceNodeByElementId","split","spaceViewId","getRootElement","superSetParent","call","seqid","emitter","next","toString","_parent","_children","_addedHandlers","_removedHandlers","getChildren","arr","obj","children","child","concat","getParent","hasChild","remove","_addChild","_removeChild","sc","addedHandler","a","b","c","removedHandler","at","getTransform","resetTransform","np","Array","isArray","transformByEstimate","type","pivot","normPivot","normDomain","normRange","H_space","setTransform","setGlobalTransform","parent_global","applySpaceTransform","spaceTransform","normST","scale","multiplierOrDomain","useMultiplier","multiplier","S_parent","scaleBy","rotate","radiansOrDomain","useRadians","R_parent","rotateBy","translateScale","translateRotate","scaleRotate","translateScaleRotate","opgt","npgt","ot","nt","spaceTransformer","t","atNorm","atMid","atMidN","atMidW","atMidE","atMidS","atNW","atNE","atSW","atSE","dimensions","imgSrcs","then","numberOfImages","stringGiven","thereWasSuccess","thereWasError","imgs","onloadsCalled","onload","onerror","Error","isFinalImage","errMsg","estimateT","estimateS","estimateR","estimateTS","estimateTR","estimateSR","estimateTSR","name","toUpperCase","mixin","key","addEventListener","event","fn","_callbacks","once","apply","arguments","removeListener","removeAllListeners","removeEventListener","callbacks","cb","splice","args","slice","len","listeners","hasListeners","Move","query","TypeError","_props","_rotate","_transitionProps","_transforms","after","has3d","ease","window","getComputedStyle","currentStyle","select","selector","skew","skewX","n","skewY","join","translateX","translateY","scaleX","m11","m12","m21","m22","m31","m32","scaleY","setVendorProperty","animate","props","_duration","parseFloat","delay","setProperty","prop","val","set","transition","add","curr","parseInt","current","sub","getPropertyValue","indexOf","applyProperties","clone","pop","reset","webkitTransitionDuration","mozTransitionDuration","msTransitionDuration","oTransitionDuration","SeqId","initial","random","pow","_id","getMatrix","d","e","f","getRotation","atan2","getScale","sqrt","getTranslation","det","eps","abs","shat","rhat","txhat","tyhat","translateBy","m","co","si","N","a1","b1","c1","d1","min","D","a0","b0","ac","bd","aa","bb","max","ad","bc","q","a2","b2","X","Y","N2","a12","b12","v","den","afterTransition","callback","hasTransitions","bind","unbind","in","out","in-out","snap","linear","ease-in-quad","ease-in-cubic","ease-in-quart","ease-in-quint","ease-in-sine","ease-in-expo","ease-in-circ","ease-in-back","ease-out-quad","ease-out-cubic","ease-out-quart","ease-out-quint","ease-out-sine","ease-out-expo","ease-out-circ","ease-out-back","ease-in-out-quart","ease-in-out-quint","ease-in-out-sine","ease-in-out-expo","ease-in-out-circ","ease-in-out-back","one","querySelector","all","querySelectorAll","engine","map","webkitTransform","OTransform","msTransform","MozTransform","body","insertBefore","property","types","shift","styles","CssEmitter","events","watch","capture","attachEvent","detachEvent"],"mappings":"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","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","// API v3.0.0\n\nexports.SpacePoint = require('./SpacePoint');\nexports.Transform = require('./Transform');\nexports.SpaceTransform = require('./SpaceTransform');\nexports.Taa = require('./Taa');\nexports.SpaceTaa = require('./SpaceTaa');\nexports.SpaceHTML = require('./SpaceHTML');\nexports.SpacePixel = require('./SpacePixel');\nexports.Space = require('./Space');\nexports.HTMLSpaceView = require('./HTMLSpaceView');\n\nexports.version = require('./version');\n","// API v3.0.0\n\nvar Transform = require('./Transform');\n\nvar SpacePoint = function (xy, reference) {\n  // Example\n  //   var p = taaspace.SpacePoint([x, y], taa);\n  //\n  // Parameter\n  //   xy\n  //     2D array\n  //   reference\n  //     a SpaceNode or SpacePoint\n  //       an item in space, enabling coord projections.\n  this.xy = xy;\n\n  // The SpacePlane's transformation the xy are on.\n  // Design note: at first, the references were SpacePlanes and not\n  // transformations. But because a SpacePlane can move or be removed,\n  // we chose only the transformation to be remembered.\n  // Design note: later we found it would be convenient for debugging\n  // to know where the point came from, which led to this._origin.\n  // After that we found that in toSpace method, we would need reference\n  // to space, although we only have implicit reference to its coords.\n  // Therefore this._origin was dropped.\n\n  if (reference.hasOwnProperty('getGlobalTransform')) {\n    // Is a SpacePlane\n    this._T = reference.getGlobalTransform();\n  } else {\n    // Is a SpacePoint\n    this._T = reference._T;\n  }\n};\n\nvar proto = SpacePoint.prototype;\n\nproto.equals = function (point) {\n  return (this.xy[0] === point.xy[0] &&\n    this.xy[1] === point.xy[1] &&\n    this._T.equals(point._T));\n};\n\nproto.offset = function (dx, dy) {\n  // Create a new point nearby.\n  //\n  // Parameter\n  //   dx\n  //     Movement towards positive x\n  //   dy\n  //     ...\n  var xy = [this.xy[0] + dx, this.xy[1] + dy];\n  return new SpacePoint(xy, this);\n};\n\nproto.polarOffset = function (radius, radians) {\n  // Create a new point moved by the polar coordinates\n  var x = this.xy[0] + radius * Math.cos(radians);\n  var y = this.xy[1] + radius * Math.sin(radians);\n  return new SpacePoint([x, y], this);\n};\n\nproto.to = function (target) {\n  // Create a new SpacePoint at same location but on a\n  // different SpacePlane.\n  //\n  // Parameter\n  //   target, a SpacePlane or null.\n  //\n  // Implementation note (See 2016-03-05-09):\n  //\n  // First, compute coord. transf. B from the current plane\n  // to the space:\n  //   x_space = B * x_plane  <=>  x_plane = inv(B) * x_space\n  //   B = plane._T\n  // Second, let A be coord. transf. from the space to the target plane:\n  //   x_target = A * x_space\n  //   A = inv(target._T)\n  // Therefore combined coord. transf. C from the curr. plane to the target:\n  //   x_target = C * x_plane\n  //   <=> A * x_space = C * inv(B) * x_space\n  //   <=> A = C * inv(B)\n  //   <=> C = AB\n  //   <=> C = inv(target._T) * plane._T\n  //\n\n  if (target === null) {\n    // target is the root node (space)\n    return this.toSpace();\n  }\n\n  // Target's global transformation. This._T is already global.\n  var target_gT = target.getGlobalTransform();\n\n  if (target_gT.equals(this._T)) {\n    return this;\n  } // else\n  var C = target_gT.inverse().multiplyBy(this._T);\n  var xy_target = C.transform(this.xy);\n  return new SpacePoint(xy_target, target);\n};\n\nproto.toSpace = function () {\n  // Create a new SpacePoint at same location but represented on space coords.\n  //\n  // Implementation note:\n  //   We already have coord. transf. from the current plane to the space:\n  //     plane._T\n  var xySpace = this._T.transform(this.xy);\n  var spaceMock = {'_T': Transform.IDENTITY};\n  return new SpacePoint(xySpace, spaceMock);\n};\n\nproto.transform = function (tr) {\n  // Create a new point by transformation.\n  //\n  // Parameter\n  //   tr\n  //     a Transform\n  var xy_hat = tr.transform(this.xy);\n  return new SpacePoint(xy_hat, this);\n};\n\n\nSpacePoint.normalize = function (points, plane) {\n  // Convert all the space points onto same plane and.\n  //\n  // Arguments:\n  //   points, array of SpacePoints\n  //   plane, a SpacePlane onto normalize. null = space\n  // Return:\n  //   array of SpacePoints\n  var i, p, normalized;\n  normalized = [];\n  for (i = 0; i < points.length; i += 1) {\n    p = points[i];\n    normalized.push(p.to(plane));\n  }\n  return normalized;\n};\n\nSpacePoint.toXY = function (points) {\n  // Convert SpacePoints to [[x1,y1], [x2,y2], ...]\n  var i, xys;\n  xys = [];\n  for (i = 0; i < points.length; i += 1) {\n    xys.push(points[i].xy);\n  }\n  return xys;\n};\n\n\nmodule.exports = SpacePoint;\n","// API v3.0.0\n\nvar nudged = require('nudged');\n\nmodule.exports = nudged.Transform;\n","/*\nSimilarly as a point can be represented in multiple coordinate systems,\nso can a transformation. To prevent users from figuring out how transformations\nare converted to other representations, we have SpaceTransform.\n\nThe API is similar to SpacePoint. However, instead of offset methods, we have\na set of similarity transformation methods.\n*/\nvar Transform = require('./Transform');\nvar SpacePoint = require('./SpacePoint');\nvar nudged = require('nudged');\n\nvar SpaceTransform = function (reference, T) {\n  // Immutable i.e. new instances are returned.\n  //\n  // Example\n  //   var t = taaspace.SpaceTransform(taa, taaspace.Transform.IDENTITY);\n  //\n  // Parameter\n  //   reference\n  //     a SpacePlane, SpacePoint, or SpaceTransform\n  //       an item in space, enabling coord projections.\n  //   T\n  //     Optional. A taaspace.Transform. Default to identity transform.\n\n  // DEBUG\n  if (!reference.hasOwnProperty('_T')) throw 'invalid reference';\n  if (T && !T.hasOwnProperty('tx')) throw 'invalid transform';\n\n  // A transformation on the plane.\n  if (typeof T === 'undefined') { T = Transform.IDENTITY; }\n  this.T = T;\n\n  // The coordinate transformation of the plane.\n  if (reference.hasOwnProperty('getGlobalTransform')) {\n    // Is a SpacePlane\n    this._T = reference.getGlobalTransform();\n  } else {\n    // Is a SpacePoint or SpaceTransform\n    this._T = reference._T;\n  }\n};\n\nvar proto = SpaceTransform.prototype;\n\nproto.equals = function (st) {\n  // Parameters:\n  //   st: a SpaceTransform\n  return (this.T.equals(st.T) && this._T.equals(st._T));\n};\n\nproto.to = function (target) {\n  // Convert the transform onto the target coordinate plane.\n  //\n  // Parameters:\n  //   target: a SpacePlane, SpacePoint, or SpaceTransform\n  //\n  // Return:\n  //   new SpaceTransform\n  var targetGT, this2target, tOnTarget;\n\n  if (target === null) {\n    // target is the root node (space)\n    return this.toSpace();\n  }\n\n  // Target's global transformation. This._T is already global.\n  if (target.hasOwnProperty('getGlobalTransform')) {\n    targetGT = target.getGlobalTransform();\n  } else {\n    targetGT = target._T;\n  }\n\n  // Avoid unnecessary, probably rounding errors inducing computation.\n  if (targetGT.equals(this._T)) {\n    return this;\n  } // else\n\n  // The transformation on the target plane equals to:\n  // 1) convert from target to current\n  // 2) execute the transformation\n  // 3) convert back to target.\n  // Fortunately we can combine these steps into a one transformation matrix.\n  // Let us first compute conversion from this to target and remember that:\n  //   x_space = T_plane * x_plane\n  this2target = targetGT.inverse().multiplyBy(this._T);\n  tOnTarget = this2target.multiplyBy(this.T.multiplyBy(this2target.inverse()));\n  return new SpaceTransform(target, tOnTarget);\n};\n\nproto.toSpace = function () {\n  // Convert the transform onto the space coordinate plane.\n  // Return a new SpaceTransform.\n  //\n  // Implementation note:\n  //   We already have coord. transf. from the current plane to the space:\n  //     this._T\n\n  // To simulate the transformation on space:\n  // 1) convert from space to the plane: this._T.inverse()\n  // 2) apply the transformation\n  // 3) convert from plane back to the space: this._T\n  var tOnSpace = this._T.multiplyBy(this.T.multiplyBy(this._T.inverse()));\n  var spaceMock = {'_T': Transform.IDENTITY};\n  return new SpaceTransform(spaceMock, tOnSpace);\n};\n\nproto.translate = function (domain, range) {\n  // Move transform image horizontally and vertically by example.\n  //\n  // Translate the plane so that after the translation, the domain points\n  // would be as close to given range points as possible.\n  //\n  // Parameter\n  //   domain\n  //   range\n  var ndom, nran, spaceE, planeE, spaceMock;\n\n  // Allow single points\n  if (domain.hasOwnProperty('_T')) { domain = [domain]; }\n  if (range.hasOwnProperty('_T')) { range = [range]; }\n\n  // Normalize to space\n  ndom = SpacePoint.normalize(domain, null);\n  nran = SpacePoint.normalize(range, null);\n\n  // Convert to nudged compatible.\n  ndom = SpacePoint.toXY(ndom);\n  nran = SpacePoint.toXY(nran);\n\n  // Estimate transformation on space\n  spaceE = nudged.estimate('T', ndom, nran);\n\n  // Convert it to this plane\n  // x_space = this._T * x_plane\n  planeE = this._T.inverse().multiplyBy(spaceE.multiplyBy(this._T));\n\n  // Apply\n  spaceMock = {'_T': this._T};\n  return new SpaceTransform(spaceMock, planeE.multiplyBy(this.T));\n};\n\nmodule.exports = SpaceTransform;\n","// API v0.6.0\nvar Emitter = require('component-emitter');\nvar loadimages = require('loadimages');\n\nvar NOOP = function () {};\n\nvar Taa = function (imgSrc, onLoaded) {\n  // Parameters\n  //   imgSrc\n  //   onLoaded(err, taa)\n  //     optional, function (taa)\n  Emitter(this);\n  var this2 = this;\n\n  // onLoaded is optional\n  if (typeof onLoaded !== 'function') {\n    onLoaded = NOOP;\n  }\n\n  // This object will be replaced by a real Image object but before that\n  // src is needed in SpaceView.\n  this.image = { src: imgSrc };\n\n  // If the image is cached, the 'load' event of Image element is\n  // fired instantly when calling loadimages. If we did not care\n  // about this, the on('loaded', fn) listeners would experience\n  // different execution order depending whether the images was\n  // cached or not.\n  var notCached = false;\n\n  loadimages(imgSrc, function (err, image) {\n    var emiterr, emittaa;\n    if (err) {\n      emiterr = err;\n      emittaa = null;\n    } else {\n      this2.image = image;\n      emiterr = null;\n      emittaa = this2;\n    }\n\n    if (notCached) {\n      this2.emit('loaded', emiterr, emittaa);\n      onLoaded(emiterr, emittaa);\n    } else {\n      // Postpone emitting of the loaded event\n      setTimeout(function () {\n        this2.emit('loaded', emiterr, emittaa);\n        onLoaded(emiterr, emittaa);\n      }, 0);\n    }\n  });\n\n  notCached = true;\n};\n\nmodule.exports = Taa;\n","// API v3.0.0\n\nvar Emitter = require('component-emitter');\nvar SpaceNode = require('./SpaceNode');\nvar SpacePlane = require('./SpacePlane');\nvar SpaceTransformer = require('./SpaceTransformer');\nvar SpaceRectangle = require('./SpaceRectangle');\n\nvar SpaceTaa = function (parent, taa) {\n  // Parameters:\n  //   parent\n  //     a SpaceNode\n  //   taa\n  //     a Taa\n  Emitter(this);\n  SpaceNode(this);\n  SpacePlane(this);\n  SpaceTransformer(this);\n  SpaceRectangle(this);\n\n  this.taa = taa;\n  this.resize([256, 256]);  // Size of taa.\n\n  this.setParent(parent);\n};\n\nmodule.exports = SpaceTaa;\n","/*\n# SpaceElement\n\nA HTMLElement [1] in the space.\n\n[1] https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement\n*/\n\nvar Emitter = require('component-emitter');\nvar SpaceNode = require('./SpaceNode');\nvar SpacePlane = require('./SpacePlane');\nvar SpaceTransformer = require('./SpaceTransformer');\nvar SpaceRectangle = require('./SpaceRectangle');\n\nvar SpaceHTML = function (parent, html) {\n  // Parameters:\n  //   parent:\n  //     a SpaceNode\n  //   html:\n  //     a string, containing html\n  Emitter(this);\n  SpaceNode(this);\n  SpacePlane(this);\n  SpaceTransformer(this);\n  SpaceRectangle(this);\n\n  this.html = html;\n  this.resize([256, 256]);  // Initial element size.\n\n  this.getHTML = function () {\n    return this.html;\n  };\n\n  // Ready\n  this.setParent(parent);\n};\n\nmodule.exports = SpaceHTML;\n","// API v3.0.0\n\nvar Emitter = require('component-emitter');\nvar SpaceNode = require('./SpaceNode');\nvar SpacePlane = require('./SpacePlane');\nvar SpaceTransformer = require('./SpaceTransformer');\nvar SpaceRectangle = require('./SpaceRectangle');\n\nvar SpacePixel = function (parent) {\n  // A 1x1 rectangle\n  //\n  // Parameters:\n  //   parent\n  //     a SpaceNode\n  Emitter(this);\n  SpaceNode(this);\n  SpacePlane(this);\n  SpaceTransformer(this);\n  SpaceRectangle(this);\n\n  this.resize([1, 1]);\n  this.setParent(parent);\n};\n\nmodule.exports = SpacePixel;\n","/*\nEmits\n  contentAdded\n  contentRemoved\n    not thrown if the content to remove did not exist in the first place.\n  contentTransformed\n*/\nvar Emitter = require('component-emitter');\nvar SpaceNode = require('./SpaceNode');\nvar SpacePlane = require('./SpacePlane');\n\nvar Space = function () {\n  Emitter(this);\n\n  SpaceNode(this);\n  // TODO remove possibility to add to parent.\n\n  SpacePlane(this);\n  // Space has constant identity transformation _T\n};\n\nmodule.exports = Space;\n","/*\n\nView\n\n*/\nvar Emitter = require('component-emitter');\nvar SpaceNode = require('./SpaceNode');\nvar SpacePlane = require('./SpacePlane');\nvar SpaceTransformer = require('./SpaceTransformer');\nvar SpaceRectangle = require('./SpaceRectangle');\nvar SpaceTaa = require('./SpaceTaa');\nvar SpaceHTML = require('./SpaceHTML');\nvar Space = require('./Space');\nvar move = require('movejs');\n\n// Disable animations by default.\nmove.defaults = { duration: 0 };\n\nvar HTMLSpaceView = function (space, htmlContainer) {\n  // Test if valid space\n  if (!(space instanceof Space)) {\n    throw 'Parent of a View must be a Space.';\n  }\n  // Test if valid dom element\n  if (!('tagName' in htmlContainer)) {\n    throw 'Container should be a DOM Element';\n  }\n\n  Emitter(this);\n  SpaceNode(this);\n  SpacePlane(this);\n  SpaceTransformer(this);\n  SpaceRectangle(this);\n  var this2 = this;\n\n  this._el = htmlContainer;\n\n  // Two mappings from space taa ids:\n  // 1. to HTML elements of the space nodes.\n  // 2. to SpaceNode instances\n  // Dev decision:\n  //   For data structure, dict over list because key search time complexity.\n  this._elements = {};\n  this._nodes = {};\n\n  (function initSize() {\n    var w = this2._el.clientWidth;\n    var h = this2._el.clientHeight;\n    this2.resize([w, h]);\n  }());\n\n  var _hasNodeId = function (nodeid) {\n    return this2._elements.hasOwnProperty(nodeid);\n  };\n\n  var transformNode = function (htmlElement, spaceNode) {\n    // Transform elements because the view orientation.\n    // See 2016-03-05-09 for math.\n    var node_global_T = spaceNode.getGlobalTransform();\n    var T = this2._T.inverse().multiplyBy(node_global_T);\n    // Current move.js does not prevent scientific notation reaching CSS\n    // which leads to problems with Safari and Opera. Therefore we must\n    // prevent the notation here.\n    // Of course this will cause error in the presentation.\n    // However the error is only in the presentation and thus not a problem.\n    var prec = 8;\n    var s = T.s.toFixed(prec);\n    var r = T.r.toFixed(prec);\n    var tx = T.tx.toFixed(prec);\n    var ty = T.ty.toFixed(prec);\n    move(htmlElement).matrix(s, r,-r, s, tx, ty).end();\n  };\n\n  var getViewSpecificId = function (spaceNodeId) {\n    // Each rendered element has own ID. The ID differs from\n    // the id of space nodes because a space node can become\n    // visualized through multiple views.\n    return this2.id + '-' + spaceNodeId;\n  };\n\n\n  // Listen the space for new or removed nodes or transformations\n\n  var transformedHandler = function (spaceNode) {\n    // Update css transformation.\n    // If the node has children, they must also be transformed\n    // because the children do not emit transformed by themselves.\n    var nodes, i, node, el;\n    nodes = spaceNode.getDescendants();\n    nodes.push(spaceNode);\n\n    for (i = 0; i < nodes.length; i += 1) {\n      node = nodes[i];\n      if (_hasNodeId(node.id)) {\n        if (node instanceof SpaceTaa) {\n          el = this2._elements[node.id];\n          transformNode(el, node);\n        } else if (node instanceof SpaceHTML) {\n          el = this2._elements[node.id];\n          transformNode(el, node);\n        }\n        // Else: no transformable representation for Views.\n      }\n    }\n  };\n\n  var resizedHandler = function (node) {\n    var el, wh;\n    if (_hasNodeId(node.id)) {\n      // Safeguard: if is a SpaceRectangle\n      if (node.hasOwnProperty('resize')) {\n        wh = node.getSize();\n        el = this2._elements[node.id];\n        el.style.width = wh[0] + 'px';\n        el.style.height = wh[1] + 'px';\n      }\n    }\n  };\n\n  var contentAddedHandler = function (spaceNode, newParent, oldParent) {\n    // Parameters:\n    //   spaceNode: a SpaceNode i.e. the content unit that was added.\n    //   newParent: optional. The new parent of the SpaceNode\n    //     Not used for anything for now but probably in the future.\n    //   oldParent: optional. The old parent of the SpaceNode.\n    //     Not used for anything for now but probably in the future.\n    if (typeof oldParent === 'undefined') { oldParent = null; }\n    if (typeof newParent === 'undefined') { newParent = null; }\n\n    var node, el, wh;\n\n    // SpaceView, SpaceTaa ...\n    node = spaceNode;\n\n    // Ensure the spaceNode is in same space. Otherwise,\n    // if view's space has been just changed, a waiting\n    // contentAdded event could add spaceNode from the old space.\n    if (spaceNode.getRootParent() !== this2.getRootParent()) {\n      return;\n    }\n\n    if (_hasNodeId(node.id)) {\n      // Content is already drawn.\n    } else {\n      if (node instanceof SpaceTaa) {\n        el = new Image(256, 256);\n        el.src = node.taa.image.src;\n        el.id = getViewSpecificId(node.id);\n        el.className = 'taaspace-taa';\n        // Show to client\n        this2._el.appendChild(el);\n        // Make referencable\n        this2._elements[node.id] = el;\n        this2._nodes[node.id] = node;\n        // Make transformation\n        transformNode(el, node);\n        // Listen to further transformations\n        node.on('transformed', transformedHandler);\n        node.on('resized', resizedHandler);\n      } else if (node instanceof SpaceHTML) {\n        // Create container div.\n        el = document.createElement('div');\n        el.innerHTML = node.html;\n        el.id = getViewSpecificId(node.id);\n        el.className = 'taaspace-html';\n        // Resize, and let taaspace styles do the rest.\n        wh = node.getSize();\n        el.style.width = wh[0] + 'px';\n        el.style.height = wh[1] + 'px';\n        // Render\n        this2._el.appendChild(el);\n        // Make referencable\n        this2._elements[node.id] = el;\n        this2._nodes[node.id] = node;\n        // Make transformation\n        transformNode(el, node);\n        // Listen to further transformations\n        node.on('transformed', transformedHandler);\n        node.on('resized', resizedHandler);\n      } else if (node instanceof HTMLSpaceView) {\n        // No representation for views.\n      } else {\n        throw new Exception('Unknown SpaceNode subtype; cannot represent');\n      }\n    }\n  };\n\n  var contentRemovedHandler = function (spaceNode, oldParent, newParent) {\n    if (typeof oldParent === 'undefined') { oldParent = null; }\n    if (typeof newParent === 'undefined') { newParent = null; }\n\n    var sameRoot, el, node;\n\n    node = spaceNode; // Alias\n\n    // Decide sameRoot\n    if (oldParent === null || newParent === null) {\n      sameRoot = false;\n    } else {\n      sameRoot = oldParent.getRootParent() === newParent.getRootParent();\n    }\n\n    if (sameRoot) {\n      // No reason to remove and then add again.\n    } else {\n      // New parent in different space, so not displayed in this view anymore.\n      if (_hasNodeId(node.id)) {\n        // Remove HTML element\n        el = this2._elements[node.id];\n        this2._el.removeChild(el);\n        // Remove from memory.\n        // JS feature of delete: does not throw if key does not exist\n        delete this2._elements[node.id];\n        delete this2._nodes[node.id];\n        // Remove handlers.\n        node.off('transformed', transformedHandler);\n        node.off('resized', resizedHandler);\n      }\n    }\n\n  };\n\n  // View added to new parent.\n  this.on('added', function (self, newSpace, oldSpace) {\n    var des, i;\n\n    if (oldSpace === newSpace) {\n      // Already set up. Do nothing.\n      return;\n    }\n\n    // Render nodes from the new space.\n    des = newSpace.getDescendants();\n    for (i = 0; i < des.length; i += 1) {\n      contentAddedHandler(des[i]);\n    }\n\n    // Start to listen for changes.\n    newSpace.on('contentAdded', contentAddedHandler);\n    newSpace.on('contentRemoved', contentRemovedHandler);\n  });\n\n  // View removed from parent.\n  this.on('removed', function (self, oldSpace, newSpace) {\n    var des, i;\n\n    if (newSpace === oldSpace) {\n      // Already set up. Do nothing.\n      return;\n    }\n\n    // Stop listening for changes.\n    oldSpace.off('contentAdded', contentAddedHandler);\n    oldSpace.off('contentRemoved', contentRemovedHandler);\n\n    // Remove all nodes from old space.\n    des = oldSpace.getDescendants();\n    for (i = 0; i < des.length; i += 1) {\n      contentRemovedHandler(des[i]);\n    }\n  });\n\n  // If the view is transformed, we of course need to retransform everything.\n  this.on('transformed', function () {\n    var id, element, node;\n    for (id in this2._elements) {\n      if (this2._elements.hasOwnProperty(id)) {\n        element  = this2._elements[id];\n        node = this2._nodes[id];\n        transformNode(element, node);\n      }\n    }\n  });\n\n  this.getElementBySpaceNode = function (spaceNode) {\n    // Get HTML element representation of the space taa.\n    // Return null if not found.\n    if (_hasNodeId(spaceNode.id)) {\n      return this._elements[spaceNode.id];\n    }\n    return null;\n  };\n\n  this.getSpaceNodeByElementId = function (id) {\n    // Get space taa by HTML element id\n    // Return null if no space taa for such id.\n    var i = id.split('-');\n    var spaceViewId = i[0];\n    var spaceNodeId = i[1];\n    if (this.id === spaceViewId) {\n      if (_hasNodeId(spaceNodeId)) {\n        return this._nodes[spaceNodeId];\n      }\n    }\n    return null;\n  };\n\n  this.getRootElement = function () {\n    // Return the container HTML element.\n    return this._el;\n  };\n\n  // Override the setParent so that only a Space\n  // is allowed to become the parent.\n  var superSetParent = this.setParent;\n  this.setParent = function (space) {\n    if (!(space instanceof Space)) {\n      throw 'A View can only be a child of a Space';\n    }\n    superSetParent.call(this, space);\n  };\n\n  // View ready to be added to Space.\n  this.setParent(space);\n};\n\nmodule.exports = HTMLSpaceView;\n","module.exports = '3.0.0';\n","/*\nAPI v3.0.0\n\nEmits\n  contentAdded\n  contentRemoved\n    not thrown if the content to remove did not exist in the first place.\n*/\nvar Emitter = require('component-emitter');\n\n// Unique ID generator. Unique over session.\n// Usage: seqid.next()\n// Return: int\nvar seqid = require('seqid')(0);\n\nvar SpaceNode = function (emitter) {\n  // Parameters\n  //   emitter, an Emitter.\n\n  // Each node has an id. That is used by the parent nodes and in views.\n  emitter.id = seqid.next().toString();\n\n  // Nodes with null parent are root nodes i.e. spaces.\n  // SpaceNode#remove sets _parent to null.\n  emitter._parent = null;\n\n  // Dict over list because key search time complexity\n  emitter._children = {};\n\n  // We need to store built handlers bound to children\n  // to be able to remove the handlers when child is removed.\n  emitter._addedHandlers = {};\n  emitter._removedHandlers = {};\n\n  emitter.getChildren = function () {\n    // Return child SpaceNodes in a list.\n    // Does not include the children of the children.\n    var id, arr, obj;\n    arr = [];\n    obj = this._children;\n    for (id in obj) {\n      arr.push(obj[id]);\n    }\n    return arr;\n  };\n\n  emitter.getDescendants = function () {\n    // All descendants in a list, including the children.\n    var i, children, child, arr;\n    arr = [];\n    children = this.getChildren();\n    for (i = 0; i < children.length; i += 1) {\n      child = children[i];\n      arr = arr.concat(child, child.getDescendants());\n    }\n    return arr;\n  };\n\n  emitter.getParent = function () {\n    return this._parent;\n  };\n\n  emitter.getRootParent = function () {\n    // Get the predecessor without parents in recursive manner.\n    if (this._parent === null) {\n      return this;\n    } // else\n    return this._parent.getRootParent();\n  };\n\n  emitter.hasChild = function (spaceNode) {\n    // Return\n    //   true if spaceNode is a child of this.\n    return spaceNode._parent === this;\n  };\n\n  emitter.remove = function () {\n    // Remove this space node from its parent.\n    // Return: see setParent\n    return this.setParent(null);\n  };\n\n  emitter.setParent = function (newParent) {\n    // Add to new parent.\n\n    var oldParent = this._parent;\n\n    if (oldParent === null) {\n      if (newParent === null) {\n        // From root to root.\n        // Do nothing\n      } else {\n        // From root to child.\n        this._parent = newParent;\n        this._parent._addChild(this);\n        this.emit('added', this, this._parent, null);\n        newParent.emit('contentAdded', this, this._parent, null);\n      }\n    } else {\n      if (newParent === null) {\n        // From child to root.\n        this._parent = null; // Becomes new root node.\n        oldParent._removeChild(this);\n        this.emit('removed', this, oldParent, null);\n        oldParent.emit('contentRemoved', this, oldParent, null);\n      } else {\n        // From child to child.\n        this._parent = newParent;\n        oldParent._removeChild(this);\n        newParent._addChild(this);\n        this.emit('removed', this, oldParent, newParent);\n        this.emit('added', this, newParent, oldParent);\n        // With both oldParent and newParent, SpaceView is able to\n        // decide whether to keep same HTMLElement or recreate it.\n        oldParent.emit('contentRemoved', this, oldParent, newParent);\n        newParent.emit('contentAdded', this, newParent, oldParent);\n      }\n    }\n\n  };\n\n  emitter._addChild = function (child) {\n    // To be called from child.setParent().\n    //\n    // Parameters\n    //   child, A SpaceNode\n    //\n    // Return\n    //   undefined\n    //\n    // Dev. note:\n    //   Previously this was called from the SpaceNode constructor.\n    //   However, because SpaceNode upgrade is done before other\n    //   upgrades, the child would not be ready to be added to parent.\n\n    var sc = child; // alias\n    var self = this;\n\n    this._children[sc.id] = sc;\n\n    // Start to listen if child has beed added, removed or transformed\n    var addedHandler = function (a, b, c) {\n      self.emit('contentAdded', a, b, c);\n    };\n    var removedHandler = function (a, b, c) {\n      self.emit('contentRemoved', a, b, c);\n    };\n    // added and removed events are not listened because\n    // for after successfully made add or remove,\n    // contentAdded and contentRemoved are fired in setParent.\n    sc.on('contentAdded', addedHandler);\n    sc.on('contentRemoved', removedHandler);\n    this._addedHandlers[sc.id] = addedHandler;\n    this._removedHandlers[sc.id] = removedHandler;\n  };\n\n  emitter._removeChild = function (child) {\n    // To be called from SpaceNode#remove\n    // Precondition: child in space\n    var sc, h;\n\n    sc = child; // alias\n    delete this._children[sc.id];\n\n    // Remove handlers\n    h = this._addedHandlers[sc.id];\n    delete this._addedHandlers[sc.id];\n    sc.off('contentAdded', h);\n\n    h = this._removedHandlers[sc.id];\n    delete this._removedHandlers[sc.id];\n    sc.off('contentRemoved', h);\n  };\n};\n\nmodule.exports = SpaceNode;\n","/*\nSpacePlane\nAPI v0.6.0\n\nA SpacePlane represents a coordinate system. It does not include\nmethods to transform the system. SpacePlane and SpaceTransformer are separated\nbecause we want to have planes that cannot be transformed, as the Space.\n\n*/\n\nvar nudged = require('nudged');\nvar SpacePoint = require('./SpacePoint');\n\nvar at = function (xy) {\n  // Return\n  //   A SpacePoint at (x,y) on the plane.\n  if (xy.length !== 2) {  // DEBUG TODO remove this\n    throw 'Invalid point, use array [x, y]';\n  }\n  return new SpacePoint(xy, this);  // Note: this === spaceNode\n};\n\nvar SpacePlane = function (spaceNode) {\n  // Parameters\n  //   spaceNode\n  //     A SpaceNode to monkey patch to SpacePlane\n\n  // Coordinate transformation.\n  // The transformation from the plane to the parent (space).\n  // See 2016-03-05-09\n  // Let:\n  //   x_space, a point in space\n  //   x_plane, a point on the plane.\n  //   T, the coordinate transformation of the plane\n  // Then:\n  //   x_space = T * x_plane\n  //\n  // For Space, it is obviously the identity transform:\n  //   x_space = T * x_space\n  spaceNode._T = nudged.Transform.IDENTITY; // identity transformation\n\n  spaceNode.at = at;\n\n  spaceNode.getTransform = function () {\n    // Local transform from plane to parent\n    //\n    // Return\n    //   transformation from plane to parent, i.e.\n    //     xy_parent = T * xy_plane\n    // Needed when we want to store transformer's position for later use.\n    return this._T;\n  };\n\n  spaceNode.getGlobalTransform = function () {\n    // Return\n    //   transformation from the plane to root container.\n    //\n    // Dev note:\n    //   Local transformations go like:\n    //     xy_parent = T_plane * xy_plane\n    //     xy_parent_parent = T_parent * xy_parent\n    //     ...\n    //     xy_root = T_parent_parent..._parent * xy_parent_parent..._parent\n    //   Therefore global transformation is:\n    //     xy_root = T_parent_..._parent * ... * T_parent * T_plane * xy_plane\n    if (this._parent === null) {\n      // TODO maybe too far: this._parent._parent might be sufficient.\n      return this._T;\n    } // else\n    return this._parent.getGlobalTransform().multiplyBy(this._T);\n  };\n\n  spaceNode.resetTransform = function () {\n    // Become space. Called e.g. when plane is removed from parent.\n    this._T = nudged.Transform.IDENTITY;\n  };\n\n};\n\nmodule.exports = SpacePlane;\n","// API v3.0.0\nvar nudged = require('nudged');\nvar Transform = require('./Transform');\nvar SpacePoint = require('./SpacePoint');\n\nvar normalize = function (points, plane) {\n  // Transform all the points onto the plane and\n  // represent them in array [[x0,y0], [x1,y1], ...].\n  //\n  // Arguments:\n  //   points, a single spacepoint or a list of spacepoints\n  //   plane, a SpacePlane e.g. a SpaceTaa onto normalize.\n  // Return:\n  //   array of xy points in space.\n  var i, p, np, normalized;\n\n  // Single SpacePoint\n  if (!Array.isArray(points)) { points = [points]; }\n\n  // To same plane\n  np = SpacePoint.normalize(points, plane);\n\n  // Convert to [[x0,y0], [x1,y1], ...]\n  normalized = [];\n  for (i = 0; i < np.length; i += 1) {\n    normalized.push(np[i].xy);\n  }\n  return normalized;\n};\n\n// DEPRECATED\n// var normalize = function (points, plane) {\n//   var i, p, np, normalized;\n//\n//   if (!Array.isArray(points)) {\n//     // Single SpacePoint\n//     p = points;\n//     np = p.to(plane).xy;\n//     return [np];\n//   } // else\n//   normalized = [];\n//   for (i = 0; i < points.length; i += 1) {\n//     p = points[i];\n//     np = p.to(plane).xy;\n//     normalized.push(np);\n//   }\n//   return normalized;\n// };\n\n\nvar transformByEstimate = function (plane, type, domain, range, pivot) {\n  // Types: T,S,R,TS,TR,SR,TSR (see nudged for further details)\n\n  var normPivot;\n  if (typeof pivot !== 'undefined') {\n    normPivot = normalize(pivot, plane._parent)[0];\n  }\n\n  // Convert all SpacePoints onto the space and to arrays\n  var normDomain = normalize(domain, plane._parent);\n  var normRange = normalize(range, plane._parent);\n\n  // Then compute optimal transformation in space\n  var H_space = nudged.estimate(type, normDomain, normRange, normPivot);\n  // See 2016-03-05-11:\n  //   To apply transformation to a space object:\n  //     T_hat = toParent(H) * T\n  // Therefore:\n  plane._T = H_space.multiplyBy(plane._T);\n\n  // Notify especially view about transformation.\n  plane.emit('transformed', plane);\n};\n\n\nvar SpaceTransformer = function (plane) {\n  //\n  // Parameters\n  //   plane\n  //     a SpacePlane\n\n  plane.setTransform = function (T) {\n    // Needed when we whan to restore stored position, maybe after\n    // modification.\n    if (this._parent === null) {\n      // We are root, cannot set.\n      return;\n    }\n    this._T = T;\n    this.emit('transformed', this);\n  };\n\n  plane.setGlobalTransform = function (T) {\n    // Set local transform so that the global transform becomes the given T.\n    //\n    // Dev note:\n    //   Given T is coord. transf. from the plane to root (space).\n    //   So is this._T.\n    //   current_glob_trans = parent_glob_trans * this_T\n    //   new_glob_trans = parent_glob_trans * X\n    //   <=> X = inv(parent_glob_trans) * new_glob_trans\n    if (this._parent === null) {\n      // We are root, cannot set.\n      return;\n    }\n    var parent_global = this._parent.getGlobalTransform();\n    this._T = parent_global.inverse().multiplyBy(T);\n    this.emit('transformed', this);\n  };\n\n  plane.applySpaceTransform = function (spaceTransform) {\n    // Apply a SpaceTransform to the node.\n    // Root nodes cannot be transformed.\n\n    if (this._parent === null) {\n      // We are root, cannot set.\n      return;\n    }\n    // Convert on parent plane so we can multiply.\n    var normST = spaceTransform.to(this._parent);\n    this._T = normST.T.multiplyBy(this._T);\n    this.emit('transformed', this);\n  };\n\n  plane.translate = function (domain, range) {\n    // Move plane horizontally and vertically by example.\n    //\n    // Translate the plane so that after the translation, the domain points\n    // would be as close to given range points as possible.\n    //\n    // Parameter\n    //   domain\n    //   range\n\n    transformByEstimate(this, 'T', domain, range);\n  };\n\n  plane.scale = function (pivot, multiplierOrDomain, range) {\n    // Parameter\n    //   pivot, a SpacePoint\n    //   multiplier, the scale factor, > 0\n    //  OR\n    //   pivot\n    //   domain\n    //   range\n\n    var useMultiplier = (typeof range === 'undefined');\n\n    if (useMultiplier) {\n      var normPivot = normalize(pivot, this._parent)[0];\n      var multiplier = multiplierOrDomain;\n      // Multiplier does not depend on plane.\n      // We create a pivoted scaling transform on parent.\n      var S_parent = Transform.IDENTITY.scaleBy(multiplier, normPivot);\n      // See 2016-03-05-11\n      //   We transform space objects by:\n      //   T_hat = H_space * T\n      this._T = S_parent.multiplyBy(this._T);\n      this.emit('transformed', this);\n    } else {\n      var domain = multiplierOrDomain;\n      transformByEstimate(this, 'S', domain, range, pivot);\n    }\n  };\n\n  plane.rotate = function (pivot, radiansOrDomain, range) {\n    // Parameter\n    //   pivot\n    //   radians\n    //  OR\n    //   pivot\n    //   domain\n    //   range\n\n    var useRadians = (typeof range === 'undefined');\n\n    if (useRadians) {\n      var normPivot = normalize(pivot, this._parent)[0];\n      var radians = radiansOrDomain;\n      // Radians do not depend on plane.\n      // We create a pivoted rotation transform on parent.\n      var R_parent = Transform.IDENTITY.rotateBy(radians, normPivot);\n      // See 2016-03-05-11\n      //   We transform space objects by:\n      //   T_hat = H_space * T\n      this._T = R_parent.multiplyBy(this._T);\n      this.emit('transformed', this);\n    } else {\n      var domain = radiansOrDomain;\n      transformByEstimate(this, 'R', domain, range, pivot);\n    }\n  };\n\n  plane.translateScale = function (domain, range) {\n    // Parameter\n    //   domain\n    //   range\n\n    transformByEstimate(this, 'TS', domain, range);\n  };\n\n  plane.translateRotate = function (domain, range) {\n    // Parameter\n    //   domain\n    //   range\n\n    transformByEstimate(this, 'TR', domain, range);\n  };\n\n  plane.scaleRotate = function (pivot, domain, range) {\n    // Parameter\n    //   domain\n    //   range\n\n    transformByEstimate(this, 'SR', domain, range, pivot);\n  };\n\n  plane.translateScaleRotate = function (domain, range) {\n    // Parameter\n    //   domain\n    //   range\n\n    transformByEstimate(this, 'TSR', domain, range);\n  };\n\n  // plane.translateAndScaleToFit, not sure if necessary for now\n\n  plane.on('removed', function (self, oldParent, newParent) {\n    // Maintain global location\n\n    if (typeof oldParent === 'undefined') { oldParent = null; }\n    if (typeof newParent === 'undefined') { newParent = null; }\n\n    var sameRoot;\n    if (newParent === null) {\n      // Root nodes cannot move.\n      this.resetTransform();\n    } else {\n      if (oldParent === null) {\n        // Removed from null parent?\n        throw new Exception('Cannot remove from null parent');\n      } else {\n        // Moved onto another parent.\n        // Let us keep the location in space the same if possible.\n        // It is possible only if the parents share same root i.e.\n        // are in the same space.\n        sameRoot = oldParent.getRootParent() === newParent.getRootParent();\n        if (sameRoot) {\n          // Keep the location.\n          // Let\n          //   OT be the old local coord. transformation.\n          //   NT be the unknown new local coord. transf.\n          //   OPGT be the global coord. transf. of old parent\n          //   NPGT be the global coord. transf. of new parent\n          // Now, we want to keep global transf. unchanged.\n          //   OPGT * OT = NPGT * NT\n          //   <=> NT = inv(NPGT) * OPGT * OT\n          var opgt = oldParent.getGlobalTransform();\n          var npgt = newParent.getGlobalTransform();\n          var ot = this._T;\n          var nt = npgt.inverse().multiplyBy(opgt).multiplyBy(ot);\n          this._T = nt;\n          this.emit('transformed', this); // TODO Is needed because inplace?\n        } else {\n          // In different space: reset\n          this.resetTransform();\n        }\n        // Note: there could be a need to change parent with the same\n        // local transformation. Not needed for now.\n      }\n\n    }\n  });\n};\n\nmodule.exports = SpaceTransformer;\n","// API v3.0.0\n\nvar SpacePoint = require('./SpacePoint');\n\nvar SpaceRectangle = function (spaceTransformer) {\n\n  var t = spaceTransformer;  // Alias\n\n  // Rectangles have size.\n  // In its own coordinates, rectangle's right bottom corner\n  // is located at [width, height].\n  // By default transformation, width 1 and height 1 equal to 1 space unit.\n  var width = 1;\n  var height = 1;\n\n  t.atNorm = function (xy) {\n    // Return a SpacePoint by coordinates normalized about the size.\n    // atNorm([1,0]) returns the point at the right upper corner.\n    return new SpacePoint([width * xy[0], height * xy[1]], t);\n  };\n\n  t.atMid = function () {\n    return new SpacePoint([width / 2, height / 2], t);\n  };\n\n  t.atMidN = function () {\n    return new SpacePoint([width / 2, 0], t);\n  };\n\n  t.atMidW = function () {\n    return new SpacePoint([0, height / 2], t);\n  };\n\n  t.atMidE = function () {\n    return new SpacePoint([width, height / 2], t);\n  };\n\n  t.atMidS = function () {\n    return new SpacePoint([width / 2, height], t);\n  };\n\n  t.atNW = function () {\n    return new SpacePoint([0, 0], t);\n  };\n\n  t.atNE = function () {\n    return new SpacePoint([width, 0], t);\n  };\n\n  t.atSW = function () {\n    return new SpacePoint([0, height], t);\n  };\n\n  t.atSE = function () {\n    return new SpacePoint([width, height], t);\n  };\n\n  t.getSize = function () {\n    return [width, height];\n  };\n\n  t.resize = function (dimensions) {\n    // Parameter\n    //   dimensions, [width, height]\n    width = dimensions[0];\n    height = dimensions[1];\n\n    this.emit('resized', t);\n  };\n\n};\n\nmodule.exports = SpaceRectangle;\n","module.exports = function loadimages(imgSrcs, then) {\n  // Parameters\n  //   imgSrcs\n  //     array of image source paths OR single source path string.\n  //   then(err, imgElements)\n  //     Will be called after all the images are loaded. If string was given,\n  //     imgElements is an Image instead of array of Images.\n\n  var numberOfImages, stringGiven, thereWasSuccess, thereWasError, imgs;\n  var onloadsCalled, onload, onerror;\n\n  if (typeof then !== 'function') {\n    throw new Error('callback should be a function: ' + then);\n  }\n\n  if (typeof imgSrcs === 'string') {\n    numberOfImages = 1;\n    stringGiven = true;\n    imgSrcs = [imgSrcs]; // Normalize\n  } else {\n    // Array of images\n    numberOfImages = imgSrcs.length;\n    stringGiven = false;\n  }\n  thereWasSuccess = false;\n  thereWasError = false;\n\n  imgs = [];\n\n  onloadsCalled = 0;\n  onload = function () {\n    // Note:\n    //   this = Image\n    if (!thereWasError) {\n      onloadsCalled += 1;\n      var isFinalImage = (onloadsCalled === numberOfImages);\n      if (isFinalImage) {\n        thereWasSuccess = true;\n        if (stringGiven) {\n          then(null, imgs[0]);\n        } else {\n          then(null, imgs);\n        }\n      }\n    }\n  };\n\n  onerror = function (errMsg) {\n    // Note:\n    //   this = Image\n\n    // No errors after success.\n    if (!thereWasSuccess) {\n      thereWasError = true;\n      then(errMsg, null);\n    }\n\n    // Prevent firing the default event handler\n    // https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers.onerror#Parameters\n    return true;\n  };\n\n  for (i = 0; i < imgSrcs.length; i += 1) {\n    imgs.push(new Image());\n    imgs[i].onload = onload;\n    imgs[i].onerror = onerror;\n    imgs[i].src = imgSrcs[i];\n  }\n};\n","/*\n\n*/\nexports.Transform = require('./lib/Transform');\nexports.estimateT = require('./lib/estimateT');\nexports.estimateS = require('./lib/estimateS');\nexports.estimateR = require('./lib/estimateR');\nexports.estimateTS = require('./lib/estimateTS');\nexports.estimateTR = require('./lib/estimateTR');\nexports.estimateSR = require('./lib/estimateSR');\nexports.estimateTSR = require('./lib/estimateTSR');\nexports.version = require('./lib/version');\n\nexports.estimate = function (type, domain, range, pivot) {\n  // Parameter\n  //   type\n  //     string. One of the following: 'T', 'S', 'R', 'TS', 'TR', 'SR', 'TSR'\n  //   domain\n  //     array of 2d arrays\n  //   range\n  //     array of 2d arrays\n  //   pivot\n  //     optional 2d array, does nothing for translation estimators\n  var name = 'estimate' + type.toUpperCase();\n  if (exports.hasOwnProperty(name)) {\n    return exports[name](domain, range, pivot);\n  } // else\n  throw new Error('Unknown estimator type: ' + type);\n};\n","\n/**\n * Expose `Emitter`.\n */\n\nmodule.exports = Emitter;\n\n/**\n * Initialize a new `Emitter`.\n *\n * @api public\n */\n\nfunction Emitter(obj) {\n  if (obj) return mixin(obj);\n};\n\n/**\n * Mixin the emitter properties.\n *\n * @param {Object} obj\n * @return {Object}\n * @api private\n */\n\nfunction mixin(obj) {\n  for (var key in Emitter.prototype) {\n    obj[key] = Emitter.prototype[key];\n  }\n  return obj;\n}\n\n/**\n * Listen on the given `event` with `fn`.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.on =\nEmitter.prototype.addEventListener = function(event, fn){\n  this._callbacks = this._callbacks || {};\n  (this._callbacks['$' + event] = this._callbacks['$' + event] || [])\n    .push(fn);\n  return this;\n};\n\n/**\n * Adds an `event` listener that will be invoked a single\n * time then automatically removed.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.once = function(event, fn){\n  function on() {\n    this.off(event, on);\n    fn.apply(this, arguments);\n  }\n\n  on.fn = fn;\n  this.on(event, on);\n  return this;\n};\n\n/**\n * Remove the given callback for `event` or all\n * registered callbacks.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.off =\nEmitter.prototype.removeListener =\nEmitter.prototype.removeAllListeners =\nEmitter.prototype.removeEventListener = function(event, fn){\n  this._callbacks = this._callbacks || {};\n\n  // all\n  if (0 == arguments.length) {\n    this._callbacks = {};\n    return this;\n  }\n\n  // specific event\n  var callbacks = this._callbacks['$' + event];\n  if (!callbacks) return this;\n\n  // remove all handlers\n  if (1 == arguments.length) {\n    delete this._callbacks['$' + event];\n    return this;\n  }\n\n  // remove specific handler\n  var cb;\n  for (var i = 0; i < callbacks.length; i++) {\n    cb = callbacks[i];\n    if (cb === fn || cb.fn === fn) {\n      callbacks.splice(i, 1);\n      break;\n    }\n  }\n  return this;\n};\n\n/**\n * Emit `event` with the given args.\n *\n * @param {String} event\n * @param {Mixed} ...\n * @return {Emitter}\n */\n\nEmitter.prototype.emit = function(event){\n  this._callbacks = this._callbacks || {};\n  var args = [].slice.call(arguments, 1)\n    , callbacks = this._callbacks['$' + event];\n\n  if (callbacks) {\n    callbacks = callbacks.slice(0);\n    for (var i = 0, len = callbacks.length; i < len; ++i) {\n      callbacks[i].apply(this, args);\n    }\n  }\n\n  return this;\n};\n\n/**\n * Return array of callbacks for `event`.\n *\n * @param {String} event\n * @return {Array}\n * @api public\n */\n\nEmitter.prototype.listeners = function(event){\n  this._callbacks = this._callbacks || {};\n  return this._callbacks['$' + event] || [];\n};\n\n/**\n * Check if this emitter has `event` handlers.\n *\n * @param {String} event\n * @return {Boolean}\n * @api public\n */\n\nEmitter.prototype.hasListeners = function(event){\n  return !! this.listeners(event).length;\n};\n","/**\n * Module Dependencies.\n */\n\nvar Emitter = require('component-emitter');\nvar query = require('component-query');\nvar after = require('after-transition');\nvar has3d = require('has-translate3d');\nvar ease = require('css-ease');\n\n/**\n * CSS Translate\n */\n\nvar translate = has3d\n  ? ['translate3d(', ', 0)']\n  : ['translate(', ')'];\n\n/**\n * Export `Move`\n */\n\nmodule.exports = Move;\n\n/**\n * Get computed style.\n */\n\nvar style = window.getComputedStyle\n  || window.currentStyle;\n\n/**\n * Library version.\n */\n\nMove.version = '0.5.0';\n\n/**\n * Export `ease`\n */\n\nMove.ease = ease;\n\n/**\n * Defaults.\n *\n *   `duration` - default duration of 500ms\n *\n */\n\nMove.defaults = {\n  duration: 500\n};\n\n/**\n * Default element selection utilized by `move(selector)`.\n *\n * Override to implement your own selection, for example\n * with jQuery one might write:\n *\n *     move.select = function(selector) {\n *       return jQuery(selector).get(0);\n *     };\n *\n * @param {Object|String} selector\n * @return {Element}\n * @api public\n */\n\nMove.select = function(selector){\n  if ('string' != typeof selector) return selector;\n  return query(selector);\n};\n\n/**\n * Initialize a new `Move` with the given `el`.\n *\n * @param {Element} el\n * @api public\n */\n\nfunction Move(el) {\n  if (!(this instanceof Move)) return new Move(el);\n  if ('string' == typeof el) el = query(el);\n  if (!el) throw new TypeError('Move must be initialized with element or selector');\n  this.el = el;\n  this._props = {};\n  this._rotate = 0;\n  this._transitionProps = [];\n  this._transforms = [];\n  this.duration(Move.defaults.duration)\n};\n\n\n/**\n * Inherit from `EventEmitter.prototype`.\n */\n\nEmitter(Move.prototype);\n\n/**\n * Buffer `transform`.\n *\n * @param {String} transform\n * @return {Move} for chaining\n * @api private\n */\n\nMove.prototype.transform = function(transform){\n  this._transforms.push(transform);\n  return this;\n};\n\n/**\n * Skew `x` and `y`.\n *\n * @param {Number} x\n * @param {Number} y\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.skew = function(x, y){\n  return this.transform('skew('\n    + x + 'deg, '\n    + (y || 0)\n    + 'deg)');\n};\n\n/**\n * Skew x by `n`.\n *\n * @param {Number} n\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.skewX = function(n){\n  return this.transform('skewX(' + n + 'deg)');\n};\n\n/**\n * Skew y by `n`.\n *\n * @param {Number} n\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.skewY = function(n){\n  return this.transform('skewY(' + n + 'deg)');\n};\n\n/**\n * Translate `x` and `y` axis.\n *\n * @param {Number} x\n * @param {Number} y\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.translate =\nMove.prototype.to = function(x, y){\n  return this.transform(translate.join(''\n    + x +'px, '\n    + (y || 0)\n    + 'px'));\n};\n\n/**\n * Translate on the x axis to `n`.\n *\n * @param {Number} n\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.translateX =\nMove.prototype.x = function(n){\n  return this.transform('translateX(' + n + 'px)');\n};\n\n/**\n * Translate on the y axis to `n`.\n *\n * @param {Number} n\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.translateY =\nMove.prototype.y = function(n){\n  return this.transform('translateY(' + n + 'px)');\n};\n\n/**\n * Scale the x and y axis by `x`, or\n * individually scale `x` and `y`.\n *\n * @param {Number} x\n * @param {Number} y\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.scale = function(x, y){\n  return this.transform('scale('\n    + x + ', '\n    + (y || x)\n    + ')');\n};\n\n/**\n * Scale x axis by `n`.\n *\n * @param {Number} n\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.scaleX = function(n){\n  return this.transform('scaleX(' + n + ')')\n};\n\n/**\n * Apply a matrix transformation\n *\n * @param {Number} m11 A matrix coefficient\n * @param {Number} m12 A matrix coefficient\n * @param {Number} m21 A matrix coefficient\n * @param {Number} m22 A matrix coefficient\n * @param {Number} m31 A matrix coefficient\n * @param {Number} m32 A matrix coefficient\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.matrix = function(m11, m12, m21, m22, m31, m32){\n  return this.transform('matrix(' + [m11,m12,m21,m22,m31,m32].join(',') + ')');\n};\n\n/**\n * Scale y axis by `n`.\n *\n * @param {Number} n\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.scaleY = function(n){\n  return this.transform('scaleY(' + n + ')')\n};\n\n/**\n * Rotate `n` degrees.\n *\n * @param {Number} n\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.rotate = function(n){\n  return this.transform('rotate(' + n + 'deg)');\n};\n\n/**\n * Set transition easing function to to `fn` string.\n *\n * When:\n *\n *   - null \"ease\" is used\n *   - \"in\" \"ease-in\" is used\n *   - \"out\" \"ease-out\" is used\n *   - \"in-out\" \"ease-in-out\" is used\n *\n * @param {String} fn\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.ease = function(fn){\n  fn = ease[fn] || fn || 'ease';\n  return this.setVendorProperty('transition-timing-function', fn);\n};\n\n/**\n * Set animation properties\n *\n * @param {String} name\n * @param {Object} props\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.animate = function(name, props){\n  for (var i in props){\n    if (props.hasOwnProperty(i)){\n      this.setVendorProperty('animation-' + i, props[i])\n    }\n  }\n  return this.setVendorProperty('animation-name', name);\n}\n\n/**\n * Set duration to `n`.\n *\n * @param {Number|String} n\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.duration = function(n){\n  n = this._duration = 'string' == typeof n\n    ? parseFloat(n) * 1000\n    : n;\n  return this.setVendorProperty('transition-duration', n + 'ms');\n};\n\n/**\n * Delay the animation by `n`.\n *\n * @param {Number|String} n\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.delay = function(n){\n  n = 'string' == typeof n\n    ? parseFloat(n) * 1000\n    : n;\n  return this.setVendorProperty('transition-delay', n + 'ms');\n};\n\n/**\n * Set `prop` to `val`, deferred until `.end()` is invoked.\n *\n * @param {String} prop\n * @param {String} val\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.setProperty = function(prop, val){\n  this._props[prop] = val;\n  return this;\n};\n\n/**\n * Set a vendor prefixed `prop` with the given `val`.\n *\n * @param {String} prop\n * @param {String} val\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.setVendorProperty = function(prop, val){\n  this.setProperty('-webkit-' + prop, val);\n  this.setProperty('-moz-' + prop, val);\n  this.setProperty('-ms-' + prop, val);\n  this.setProperty('-o-' + prop, val);\n  return this;\n};\n\n/**\n * Set `prop` to `value`, deferred until `.end()` is invoked\n * and adds the property to the list of transition props.\n *\n * @param {String} prop\n * @param {String} val\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.set = function(prop, val){\n  this.transition(prop);\n  this._props[prop] = val;\n  return this;\n};\n\n/**\n * Increment `prop` by `val`, deferred until `.end()` is invoked\n * and adds the property to the list of transition props.\n *\n * @param {String} prop\n * @param {Number} val\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.add = function(prop, val){\n  if (!style) return;\n  var self = this;\n  return this.on('start', function(){\n    var curr = parseInt(self.current(prop), 10);\n    self.set(prop, curr + val + 'px');\n  });\n};\n\n/**\n * Decrement `prop` by `val`, deferred until `.end()` is invoked\n * and adds the property to the list of transition props.\n *\n * @param {String} prop\n * @param {Number} val\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.sub = function(prop, val){\n  if (!style) return;\n  var self = this;\n  return this.on('start', function(){\n    var curr = parseInt(self.current(prop), 10);\n    self.set(prop, curr - val + 'px');\n  });\n};\n\n/**\n * Get computed or \"current\" value of `prop`.\n *\n * @param {String} prop\n * @return {String}\n * @api public\n */\n\nMove.prototype.current = function(prop){\n  return style(this.el).getPropertyValue(prop);\n};\n\n/**\n * Add `prop` to the list of internal transition properties.\n *\n * @param {String} prop\n * @return {Move} for chaining\n * @api private\n */\n\nMove.prototype.transition = function(prop){\n  if (!this._transitionProps.indexOf(prop)) return this;\n  this._transitionProps.push(prop);\n  return this;\n};\n\n/**\n * Commit style properties, aka apply them to `el.style`.\n *\n * @return {Move} for chaining\n * @see Move#end()\n * @api private\n */\n\nMove.prototype.applyProperties = function(){\n  for (var prop in this._props) {\n    this.el.style.setProperty(prop, this._props[prop], '');\n  }\n  return this;\n};\n\n/**\n * Re-select element via `selector`, replacing\n * the current element.\n *\n * @param {String} selector\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.move =\nMove.prototype.select = function(selector){\n  this.el = Move.select(selector);\n  return this;\n};\n\n/**\n * Defer the given `fn` until the animation\n * is complete. `fn` may be one of the following:\n *\n *   - a function to invoke\n *   - an instanceof `Move` to call `.end()`\n *   - nothing, to return a clone of this `Move` instance for chaining\n *\n * @param {Function|Move} fn\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.then = function(fn){\n  // invoke .end()\n  if (fn instanceof Move) {\n    this.on('end', function(){\n      fn.end();\n    });\n  // callback\n  } else if ('function' == typeof fn) {\n    this.on('end', fn);\n  // chain\n  } else {\n    var clone = new Move(this.el);\n    clone._transforms = this._transforms.slice(0);\n    this.then(clone);\n    clone.parent = this;\n    return clone;\n  }\n\n  return this;\n};\n\n/**\n * Pop the move context.\n *\n * @return {Move} parent Move\n * @api public\n */\n\nMove.prototype.pop = function(){\n  return this.parent;\n};\n\n/**\n * Reset duration.\n *\n * @return {Move}\n * @api public\n */\n\nMove.prototype.reset = function(){\n  this.el.style.webkitTransitionDuration =\n  this.el.style.mozTransitionDuration =\n  this.el.style.msTransitionDuration =\n  this.el.style.oTransitionDuration = '';\n  return this;\n};\n\n/**\n * Start animation, optionally calling `fn` when complete.\n *\n * @param {Function} fn\n * @return {Move} for chaining\n * @api public\n */\n\nMove.prototype.end = function(fn){\n  var self = this;\n\n  // emit \"start\" event\n  this.emit('start');\n\n  // transforms\n  if (this._transforms.length) {\n    this.setVendorProperty('transform', this._transforms.join(' '));\n  }\n\n  // transition properties\n  this.setVendorProperty('transition-properties', this._transitionProps.join(', '));\n  this.applyProperties();\n\n  // callback given\n  if (fn) this.then(fn);\n\n  // emit \"end\" when complete\n  after.once(this.el, function(){\n    self.reset();\n    self.emit('end');\n  });\n\n  return this;\n};\n","\"use strict\";\n\nmodule.exports = SeqId\n\nfunction SeqId(initial) {\n  if (!(this instanceof SeqId)) {\n    return new SeqId(initial)\n  }\n  if (initial == null) {\n    initial = (Math.random() - 0.5) * Math.pow(2, 32)\n  }\n  this._id = initial | 0\n}\nSeqId.prototype.next = function () {\n  this._id = (this._id + 1) | 0\n  return this._id\n}\n","\nvar Transform = function (s, r, tx, ty) {\n\n  // Public, to allow user access\n  this.s = s;\n  this.r = r;\n  this.tx = tx;\n  this.ty = ty;\n\n  this.equals = function (t) {\n    return (s === t.s && r === t.r && tx === t.tx && ty === t.ty);\n  };\n\n  this.transform = function (p) {\n    // p\n    //   point [x, y] or array of points [[x1,y1], [x2, y2], ...]\n\n    if (typeof p[0] === 'number') {\n      // Single point\n      return [s * p[0] - r * p[1] + tx, r * p[0] + s * p[1] + ty];\n    } // else\n\n    var i, c = [];\n    for (i = 0; i < p.length; i += 1) {\n      c.push([s * p[i][0] - r * p[i][1] + tx, r * p[i][0] + s * p[i][1] + ty]);\n    }\n    return c;\n  };\n\n  this.getMatrix = function () {\n    // Get the transformation matrix in the format common to\n    // many APIs, including:\n    // - kld-affine\n    //\n    // Return\n    //   object o, having properties a, b, c, d, e, f:\n    //   [ s  -r  tx ]   [ o.a  o.c  o.e ]\n    //   [ r   s  ty ] = [ o.b  o.d  o.f ]\n    //   [ 0   0   1 ]   [  -    -    -  ]\n    return { a: s, b: r, c: -r, d: s, e: tx, f: ty };\n  };\n\n  this.getRotation = function () {\n    // in rads\n    return Math.atan2(r, s);\n  };\n\n  this.getScale = function () {\n    // scale multiplier\n    return Math.sqrt(r * r + s * s);\n  };\n\n  this.getTranslation = function () {\n    return [tx, ty];\n  };\n\n  this.inverse = function () {\n    // Return inversed transform instance\n    // See note 2015-10-26-16-30\n    var det = s * s + r * r;\n    // Test if singular transformation. These might occur when all the range\n    // points are the same, forcing the scale to drop to zero.\n    var eps = 0.00000001;\n    if (Math.abs(det) < eps) {\n      throw new Error('Singular transformations cannot be inversed.');\n    }\n    var shat = s / det;\n    var rhat = -r / det;\n    var txhat = (-s * tx - r * ty) / det;\n    var tyhat = ( r * tx - s * ty) / det;\n    return new Transform(shat, rhat, txhat, tyhat);\n  };\n\n  this.translateBy = function (dx, dy) {\n    return new Transform(s, r, tx + dx, ty + dy);\n  };\n\n  this.scaleBy = function (multiplier, pivot) {\n    // Parameter\n    //   multiplier\n    //   pivot\n    //     optional, a [x, y] point\n    var m, x, y;\n    m = multiplier; // alias\n    if (typeof pivot === 'undefined') {\n      x = y = 0;\n    } else {\n      x = pivot[0];\n      y = pivot[1];\n    }\n    return new Transform(m * s, m * r, m * tx + (1-m) * x, m * ty + (1-m) * y);\n  };\n\n  this.rotateBy = function (radians, pivot) {\n    // Parameter\n    //   radians\n    //     from positive x to positive y axis\n    //   pivot\n    //     optional, a [x, y] point\n    var co, si, x, y, shat, rhat, txhat, tyhat;\n    co = Math.cos(radians);\n    si = Math.sin(radians);\n    if (typeof pivot === 'undefined') {\n      x = y = 0;\n    } else {\n      x = pivot[0];\n      y = pivot[1];\n    }\n    shat = s * co - r * si;\n    rhat = s * si + r * co;\n    txhat = (tx - x) * co - (ty - y) * si + x;\n    tyhat = (tx - x) * si + (ty - y) * co + y;\n    return new Transform(shat, rhat, txhat, tyhat);\n  };\n\n\n  this.multiplyBy = function (transform) {\n    // Multiply this transformation matrix A\n    // from the right with the given transformation matrix B\n    // and return the result AB\n\n    // For reading aid:\n    // s -r tx  t.s -r tx\n    // r  s ty *  r  s ty\n    // 0  0  1    0  0  1\n    var t = transform; // alias\n    var shat = s * t.s - r * t.r;\n    var rhat = s * t.r + r * t.s;\n    var txhat = s * t.tx - r * t.ty + tx;\n    var tyhat = r * t.tx + s * t.ty + ty;\n    return new Transform(shat, rhat, txhat, tyhat);\n  };\n};\n\nTransform.IDENTITY = new Transform(1, 0, 0, 0);\n\nmodule.exports = Transform;\n","var Transform = require('./Transform');\n\nmodule.exports = function (domain, range) {\n  var i, N, a1, b1, c1, d1, txhat, tyhat;\n\n  N = Math.min(domain.length, range.length);\n  a1 = b1 = c1 = d1 = 0;\n\n  if (N < 1) {\n    // Assume identity transform be the best guess\n    return Transform.IDENTITY;\n  }\n\n  for (i = 0; i < N; i += 1) {\n    a1 += domain[i][0];\n    b1 += domain[i][1];\n    c1 += range[i][0];\n    d1 += range[i][1];\n  }\n\n  txhat = (c1 - a1) / N;\n  tyhat = (d1 - b1) / N;\n\n  return new Transform(1, 0, txhat, tyhat);\n};\n","var Transform = require('./Transform');\n\nmodule.exports = function (domain, range, pivot) {\n  var i, N, D, a0, b0, a, b, c, d, ac, bd, aa, bb, shat, tx, ty;\n\n  N = Math.min(domain.length, range.length);\n  ac = bd = aa = bb = 0;\n\n  if (typeof pivot === 'undefined') {\n    a0 = b0 = 0;\n  } else {\n    a0 = pivot[0];\n    b0 = pivot[1];\n  }\n\n  for (i = 0; i < N; i += 1) {\n    a = domain[i][0] - a0;\n    b = domain[i][1] - b0;\n    c = range[i][0] - a0;\n    d = range[i][1] - b0;\n    ac += a * c;\n    bd += b * d;\n    aa += a * a;\n    bb += b * b;\n  }\n\n  D = aa + bb;\n\n  if (D === 0) {\n    // All domain points equal the pivot.\n    // Identity transform is then only solution.\n    // D === 0 also if N === 0.\n    // Assume identity transform to be the best guess\n    return Transform.IDENTITY;\n  }\n\n  // Prevent negative scaling because it would be same as positive scaling\n  // and rotation => limit to zero\n  shat = Math.max(0, (ac + bd) / D);\n  tx = (1 - shat) * a0;\n  ty = (1 - shat) * b0;\n\n  return new Transform(shat, 0, tx, ty);\n};\n","var Transform = require('./Transform');\n\nmodule.exports = function (domain, range, pivot) {\n  var i, N, D, a0, b0, a, b, c, d, ac, ad, bc, bd, shat, rhat, tx, ty;\n\n  N = Math.min(domain.length, range.length);\n  ac = ad = bc = bd = 0;\n\n  if (typeof pivot === 'undefined') {\n    a0 = b0 = 0;\n  } else {\n    a0 = pivot[0];\n    b0 = pivot[1];\n  }\n\n  for (i = 0; i < N; i += 1) {\n    a = domain[i][0] - a0;\n    b = domain[i][1] - b0;\n    c = range[i][0] - a0;\n    d = range[i][1] - b0;\n    ac += a * c;\n    ad += a * d;\n    bc += b * c;\n    bd += b * d;\n  }\n\n  p = ac + bd;\n  q = ad - bc;\n\n  D = Math.sqrt(p * p + q * q);\n\n  if (D === 0) {\n    // D === 0\n    // <=> q === 0 and p === 0.\n    // <=> ad === bc and ac === -bd\n    // <=> domain in pivot OR range in pivot OR yet unknown cases\n    //     where the angle cannot be determined.\n    // D === 0 also if N === 0.\n    // Assume identity transform to be the best guess\n    return Transform.IDENTITY;\n  }\n\n  shat = p / D;\n  rhat = q / D;\n  tx = a0 - a0 * shat + b0 * rhat;\n  ty = b0 - a0 * rhat - b0 * shat;\n\n  return new Transform(shat, rhat, tx, ty);\n};\n","var Transform = require('./Transform');\n\nmodule.exports = function (domain, range) {\n  // Parameters\n  //   domain\n  //     array of [x, y] 2D arrays\n  //   range\n  //     array of [x, y] 2D arrays\n\n  // Alias\n  var X = domain;\n  var Y = range;\n\n  // Allow arrays of different length but\n  // ignore the extra points.\n  var N = Math.min(X.length, Y.length);\n\n  var i, a, b, c, d, a1, b1, c1, d1, a2, b2, ac, bd;\n  a1 = b1 = c1 = d1 = a2 = b2 = ac = bd = 0;\n  for (i = 0; i < N; i += 1) {\n    a = X[i][0];\n    b = X[i][1];\n    c = Y[i][0];\n    d = Y[i][1];\n    a1 += a;\n    b1 += b;\n    c1 += c;\n    d1 += d;\n    a2 += a * a;\n    b2 += b * b;\n    ac += a * c;\n    bd += b * d;\n  }\n\n  // Denominator.\n  var N2 = N * N;\n  var a12 = a1 * a1;\n  var b12 = b1 * b1;\n  var p = a2 + b2;\n  var q = ac + bd;\n  var D = N2 * p - N * (a12 + b12);\n\n  if (D === 0) {\n    // N === 0 => D === 0\n    if (N === 0) {\n      return new Transform(1, 0, 0, 0);\n    } // else\n    // D === 0 <=> all the domain points are the same\n    // We guess the translation to the mean of the range to be the best guess.\n    // Here a, b represents the mean of domain points.\n    return new Transform(1, 0, (c1 / N) - a, (d1 / N) - b);\n  }\n\n  // Estimators\n  var shat = (N2 * q - N * (a1 * c1 + b1 * d1)) / D;\n  var txhat = (-N * a1 * q + N * c1 * p - b12 * c1 + a1 * b1 * d1) / D;\n  var tyhat = (-N * b1 * q + N * d1 * p - a12 * d1 + a1 * b1 * c1) / D;\n\n  return new Transform(shat, 0, txhat, tyhat);\n};\n","var Transform = require('./Transform');\n\nmodule.exports = function (domain, range, pivot) {\n  // Estimate optimal transformation given the domain and the range\n  // so that the pivot point remains the same.\n  //\n  // Use cases\n  //   - transform an image that has one corner fixed with a pin.\n  //   - allow only scale and rotation by fixing the middle of the object\n  //     to transform.\n  //\n  // Parameters\n  //   domain, an array of [x, y] points\n  //   range, an array of [x, y] points\n  //   pivot, optional\n  //     the point [x, y] that must remain constant in the tranformation.\n  //     Defaults to origo [0, 0]\n  //\n  //\n  var X, Y, N, s, r, tx, ty;\n\n  // Optional pivot\n  if (typeof pivot === 'undefined') {\n    pivot = [0, 0];\n  }\n\n  // Alias\n  X = domain;\n  Y = range;\n\n  // Allow arrays of different length but\n  // ignore the extra points.\n  N = Math.min(X.length, Y.length);\n\n  var v = pivot[0];\n  var w = pivot[1];\n\n  var i, a, b, c, d;\n  var a2, b2;\n  a2 = b2 = 0;\n  var ac, bd, bc, ad;\n  ac = bd = bc = ad = 0;\n\n  for (i = 0; i < N; i += 1) {\n    a = X[i][0] - v;\n    b = X[i][1] - w;\n    c = Y[i][0] - v;\n    d = Y[i][1] - w;\n    a2 += a * a;\n    b2 += b * b;\n    ac += a * c;\n    bd += b * d;\n    bc += b * c;\n    ad += a * d;\n  }\n\n  // Denominator = determinant.\n  // It becomes zero iff N = 0 or X[i] = [v, w] for every i in [0, n).\n  // In other words, iff all the domain points are under the fixed point or\n  // there is no domain points.\n  var den = a2 + b2;\n\n  var eps = 0.00000001;\n  if (Math.abs(den) < eps) {\n    // The domain points are under the pivot or there is no domain points.\n    // We assume identity transform be the simplest guess. It keeps\n    // the domain points under the pivot if there is some.\n    return new Transform(1, 0, 0, 0);\n  }\n\n  // Estimators\n  s = (ac + bd) / den;\n  r = (-bc + ad) / den;\n  tx =  w * r - v * s + v;\n  ty = -v * r - w * s + w;\n\n  return new Transform(s, r, tx, ty);\n};\n","var Transform = require('./Transform');\n\nmodule.exports = function (domain, range) {\n  // Parameters\n  //   domain\n  //     array of [x, y] 2D arrays\n  //   range\n  //     array of [x, y] 2D arrays\n\n  // Alias\n  var X = domain;\n  var Y = range;\n\n  // Allow arrays of different length but\n  // ignore the extra points.\n  var N = Math.min(X.length, Y.length);\n\n  var i, a, b, c, d, a1, b1, c1, d1, ac, ad, bc, bd;\n  a1 = b1 = c1 = d1 = ac = ad = bc = bd = 0;\n  for (i = 0; i < N; i += 1) {\n    a = X[i][0];\n    b = X[i][1];\n    c = Y[i][0];\n    d = Y[i][1];\n    a1 += a;\n    b1 += b;\n    c1 += c;\n    d1 += d;\n    ac += a * c;\n    ad += a * d;\n    bc += b * c;\n    bd += b * d;\n  }\n\n  // Denominator.\n  var v = N * (ad - bc) - a1 * d1 + b1 * c1;\n  var w = N * (ac + bd) - a1 * c1 - b1 * d1;\n  var D = Math.sqrt(v * v + w * w);\n\n  if (D === 0) {\n    // N === 0 => D === 0\n    if (N === 0) {\n      return new Transform(1, 0, 0, 0);\n    } // else\n    // D === 0 <=> undecidable\n    // We guess the translation to the mean of the range to be the best guess.\n    // Here a, b represents the mean of domain points.\n    return new Transform(1, 0, (c1 - a1) / N, (d1 - b1) / N);\n  }\n\n  // Estimators\n  var shat = w / D;\n  var rhat = v / D;\n  var txhat = (-a1 * shat + b1 * rhat + c1) / N;\n  var tyhat = (-a1 * rhat - b1 * shat + d1) / N;\n\n  return new Transform(shat, rhat, txhat, tyhat);\n};\n","var Transform = require('./Transform');\n\nmodule.exports = function (domain, range) {\n  // Parameters\n  //   domain\n  //     array of [x, y] 2D arrays\n  //   range\n  //     array of [x, y] 2D arrays\n  var X, Y, N, s, r, tx, ty;\n\n  // Alias\n  X = domain;\n  Y = range;\n\n  // Allow arrays of different length but\n  // ignore the extra points.\n  N = Math.min(X.length, Y.length);\n\n  // If length is zero, no estimation can be done. We choose the indentity\n  // transformation be the best quess.\n  if (N === 0) {\n    return new Transform(1, 0, 0, 0);\n  } // else\n\n  var i, a, b, c, d;\n  var a1 = 0;\n  var b1 = 0;\n  var c1 = 0;\n  var d1 = 0;\n  var a2 = 0;\n  var b2 = 0;\n  var ad = 0;\n  var bc = 0;\n  var ac = 0;\n  var bd = 0;\n  for (i = 0; i < N; i += 1) {\n    a = X[i][0];\n    b = X[i][1];\n    c = Y[i][0];\n    d = Y[i][1];\n    a1 += a;\n    b1 += b;\n    c1 += c;\n    d1 += d;\n    a2 += a * a;\n    b2 += b * b;\n    ad += a * d;\n    bc += b * c;\n    ac += a * c;\n    bd += b * d;\n  }\n\n  // Denominator.\n  // It is zero iff X[i] = X[j] for every i and j in [0, n).\n  // In other words, iff all the domain points are the same or there is only one domain point.\n  var den = N * a2 + N * b2 - a1 * a1 - b1 * b1;\n\n  var eps = 0.00000001;\n  if (-eps < den && den < eps) {\n    // The domain points are the same.\n    // We guess the translation to the mean of the range to be the best guess.\n    // Here a, b represents the mean of domain points.\n    return new Transform(1, 0, (c1 / N) - a, (d1 / N) - b);\n  }\n\n  // Estimators\n  s = (N * (ac + bd) - a1 * c1 - b1 * d1) / den;\n  r = (N * (ad - bc) + b1 * c1 - a1 * d1) / den;\n  tx = (-a1 * (ac + bd) + b1 * (ad - bc) + a2 * c1 + b2 * c1) / den;\n  ty = (-b1 * (ac + bd) - a1 * (ad - bc) + a2 * d1 + b2 * d1) / den;\n\n  return new Transform(s, r, tx, ty);\n};\n","module.exports = '1.0.1';\n","var hasTransitions = require('has-transitions');\nvar emitter = require('css-emitter');\n\nfunction afterTransition(el, callback) {\n  if(hasTransitions(el)) {\n    return emitter(el).bind(callback);\n  }\n  return callback.apply(el);\n};\n\nafterTransition.once = function(el, callback) {\n  afterTransition(el, function fn(){\n    callback.apply(el);\n    emitter(el).unbind(fn);\n  });\n};\n\nmodule.exports = afterTransition;","\n/**\n * CSS Easing functions\n */\n\nmodule.exports = {\n    'in':                'ease-in'\n  , 'out':               'ease-out'\n  , 'in-out':            'ease-in-out'\n  , 'snap':              'cubic-bezier(0,1,.5,1)'\n  , 'linear':            'cubic-bezier(0.250, 0.250, 0.750, 0.750)'\n  , 'ease-in-quad':      'cubic-bezier(0.550, 0.085, 0.680, 0.530)'\n  , 'ease-in-cubic':     'cubic-bezier(0.550, 0.055, 0.675, 0.190)'\n  , 'ease-in-quart':     'cubic-bezier(0.895, 0.030, 0.685, 0.220)'\n  , 'ease-in-quint':     'cubic-bezier(0.755, 0.050, 0.855, 0.060)'\n  , 'ease-in-sine':      'cubic-bezier(0.470, 0.000, 0.745, 0.715)'\n  , 'ease-in-expo':      'cubic-bezier(0.950, 0.050, 0.795, 0.035)'\n  , 'ease-in-circ':      'cubic-bezier(0.600, 0.040, 0.980, 0.335)'\n  , 'ease-in-back':      'cubic-bezier(0.600, -0.280, 0.735, 0.045)'\n  , 'ease-out-quad':     'cubic-bezier(0.250, 0.460, 0.450, 0.940)'\n  , 'ease-out-cubic':    'cubic-bezier(0.215, 0.610, 0.355, 1.000)'\n  , 'ease-out-quart':    'cubic-bezier(0.165, 0.840, 0.440, 1.000)'\n  , 'ease-out-quint':    'cubic-bezier(0.230, 1.000, 0.320, 1.000)'\n  , 'ease-out-sine':     'cubic-bezier(0.390, 0.575, 0.565, 1.000)'\n  , 'ease-out-expo':     'cubic-bezier(0.190, 1.000, 0.220, 1.000)'\n  , 'ease-out-circ':     'cubic-bezier(0.075, 0.820, 0.165, 1.000)'\n  , 'ease-out-back':     'cubic-bezier(0.175, 0.885, 0.320, 1.275)'\n  , 'ease-out-quad':     'cubic-bezier(0.455, 0.030, 0.515, 0.955)'\n  , 'ease-out-cubic':    'cubic-bezier(0.645, 0.045, 0.355, 1.000)'\n  , 'ease-in-out-quart': 'cubic-bezier(0.770, 0.000, 0.175, 1.000)'\n  , 'ease-in-out-quint': 'cubic-bezier(0.860, 0.000, 0.070, 1.000)'\n  , 'ease-in-out-sine':  'cubic-bezier(0.445, 0.050, 0.550, 0.950)'\n  , 'ease-in-out-expo':  'cubic-bezier(1.000, 0.000, 0.000, 1.000)'\n  , 'ease-in-out-circ':  'cubic-bezier(0.785, 0.135, 0.150, 0.860)'\n  , 'ease-in-out-back':  'cubic-bezier(0.680, -0.550, 0.265, 1.550)'\n};\n","function one(selector, el) {\n  return el.querySelector(selector);\n}\n\nexports = module.exports = function(selector, el){\n  el = el || document;\n  return one(selector, el);\n};\n\nexports.all = function(selector, el){\n  el = el || document;\n  return el.querySelectorAll(selector);\n};\n\nexports.engine = function(obj){\n  if (!obj.one) throw new Error('.one callback required');\n  if (!obj.all) throw new Error('.all callback required');\n  one = obj.one;\n  exports.all = obj.all;\n  return exports;\n};\n","\nvar prop = require('transform-property');\n\n// IE <=8 doesn't have `getComputedStyle`\nif (!prop || !window.getComputedStyle) {\n  module.exports = false;\n\n} else {\n  var map = {\n    webkitTransform: '-webkit-transform',\n    OTransform: '-o-transform',\n    msTransform: '-ms-transform',\n    MozTransform: '-moz-transform',\n    transform: 'transform'\n  };\n\n  // from: https://gist.github.com/lorenzopolidori/3794226\n  var el = document.createElement('div');\n  el.style[prop] = 'translate3d(1px,1px,1px)';\n  document.body.insertBefore(el, null);\n  var val = getComputedStyle(el).getPropertyValue(map[prop]);\n  document.body.removeChild(el);\n  module.exports = null != val && val.length && 'none' != val;\n}\n","/**\n * This will store the property that the current\n * browser uses for transitionDuration\n */\nvar property;\n\n/**\n * The properties we'll check on an element\n * to determine if it actually has transitions\n * We use duration as this is the only property\n * needed to technically have transitions\n * @type {Array}\n */\nvar types = [\n  \"transitionDuration\",\n  \"MozTransitionDuration\",\n  \"webkitTransitionDuration\"\n];\n\n/**\n * Determine the correct property for this browser\n * just once so we done need to check every time\n */\nwhile(types.length) {\n  var type = types.shift();\n  if(type in document.body.style) {\n    property = type;\n  }\n}\n\n/**\n * Determine if the browser supports transitions or\n * if an element has transitions at all.\n * @param  {Element}  el Optional. Returns browser support if not included\n * @return {Boolean}\n */\nfunction hasTransitions(el){\n  if(!property) {\n    return false; // No browser support for transitions\n  }\n  if(!el) {\n    return property != null; // We just want to know if browsers support it\n  }\n  var duration = getComputedStyle(el)[property];\n  return duration !== \"\" && parseFloat(duration) !== 0; // Does this element have transitions?\n}\n\nmodule.exports = hasTransitions;","\nvar styles = [\n  'webkitTransform',\n  'MozTransform',\n  'msTransform',\n  'OTransform',\n  'transform'\n];\n\nvar el = document.createElement('p');\nvar style;\n\nfor (var i = 0; i < styles.length; i++) {\n  style = styles[i];\n  if (null != el.style[style]) {\n    module.exports = style;\n    break;\n  }\n}\n","/**\n * Module Dependencies\n */\n\nvar events = require('event');\n\n// CSS events\n\nvar watch = [\n  'transitionend'\n, 'webkitTransitionEnd'\n, 'oTransitionEnd'\n, 'MSTransitionEnd'\n, 'animationend'\n, 'webkitAnimationEnd'\n, 'oAnimationEnd'\n, 'MSAnimationEnd'\n];\n\n/**\n * Expose `CSSnext`\n */\n\nmodule.exports = CssEmitter;\n\n/**\n * Initialize a new `CssEmitter`\n *\n */\n\nfunction CssEmitter(element){\n  if (!(this instanceof CssEmitter)) return new CssEmitter(element);\n  this.el = element;\n}\n\n/**\n * Bind CSS events.\n *\n * @api public\n */\n\nCssEmitter.prototype.bind = function(fn){\n  for (var i=0; i < watch.length; i++) {\n    events.bind(this.el, watch[i], fn);\n  }\n  return this;\n};\n\n/**\n * Unbind CSS events\n * \n * @api public\n */\n\nCssEmitter.prototype.unbind = function(fn){\n  for (var i=0; i < watch.length; i++) {\n    events.unbind(this.el, watch[i], fn);\n  }\n  return this;\n};\n\n/**\n * Fire callback only once\n * \n * @api public\n */\n\nCssEmitter.prototype.once = function(fn){\n  var self = this;\n  function on(){\n    self.unbind(on);\n    fn.apply(self.el, arguments);\n  }\n  self.bind(on);\n  return this;\n};\n\n","\n/**\n * Bind `el` event `type` to `fn`.\n *\n * @param {Element} el\n * @param {String} type\n * @param {Function} fn\n * @param {Boolean} capture\n * @return {Function}\n * @api public\n */\n\nexports.bind = function(el, type, fn, capture){\n  if (el.addEventListener) {\n    el.addEventListener(type, fn, capture);\n  } else {\n    el.attachEvent('on' + type, fn);\n  }\n  return fn;\n};\n\n/**\n * Unbind `el` event `type`'s callback `fn`.\n *\n * @param {Element} el\n * @param {String} type\n * @param {Function} fn\n * @param {Boolean} capture\n * @return {Function}\n * @api public\n */\n\nexports.unbind = function(el, type, fn, capture){\n  if (el.removeEventListener) {\n    el.removeEventListener(type, fn, capture);\n  } else {\n    el.detachEvent('on' + type, fn);\n  }\n  return fn;\n};\n"]}