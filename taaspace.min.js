/*! taaspace - v0.0.2 - 2013-11-25
 * https://github.com/taataa/taaspace
 *
 * Copyright (c) 2013 Akseli Palen <akseli.palen@gmail.com>;
 * Licensed under the MIT license */


!function(a){"use strict";var b=function(){var a={},c=function(){this._elems=[],this._vps=[],this._elemIdCounter=0,this._keyboardManager=b.KeyboardManager.create()};return a.create=function(){return new c},c.prototype.box=function(){var a,b,c=0,d=0,e=0,f=0;if(this._elems.length>0)for(b=this._elems[0].box(),c=b.x0,d=b.y0,e=b.x1,f=b.y1,a=1;a<this._elems.length;a+=1)b=this._elems[a].box(),c=Math.min(c,b.x0),d=Math.min(d,b.y0),e=Math.max(e,b.x1),f=Math.max(f,b.y1);return{x0:c,y0:d,x1:e,y1:f}},c.prototype.pivot=function(a){var b=a;if("undefined"==typeof b)return{x:0,y:0};throw"pivot"in b&&"function"==typeof b.pivot&&(b=b.pivot()),"Not implemented"},c.prototype.remove=function(a){throw this._elems=_.reject(this._elems,function(b){return a===b}),"Not implemented"},c.prototype.createImage=function(a,c){var d=b.Image.create(this,a,c);return d._id=String(this._elemIdCounter),this._elemIdCounter+=1,this._addElement(d),d},c.prototype.createText=function(a,c){var d=b.Text.create(this,a,c);return d._id=String(this._elemIdCounter),this._elemIdCounter+=1,this._addElement(d),d},c.prototype.createCustom=function(){throw"Not implemented"},c.prototype.createNetwork=function(){throw"Not implemented"},c.prototype.createGroup=function(){throw"Not implemented"},c.prototype.createViewport=function(a,c){var d=b.Viewport.create(this,a,c);return this._addViewport(d),d},c.prototype.select=function(a){this._keyboardManager.select(a)},c.prototype.deselect=function(a){this._keyboardManager.deselect(a)},c.prototype._addElement=function(a){this._elems.push(a),_.each(this._vps,function(b){b._createDomElement(a)})},c.prototype._addViewport=function(a){this._vps.push(a),_.each(this._elems,function(b){a._createDomElement(b)})},c.prototype._moveDomElement=function(a,b){_.each(this._vps,function(c){c._moveDomElement(a,b)})},c.prototype._scaleDomElement=function(a,b){_.each(this._vps,function(c){c._scaleDomElement(a,b)})},c.prototype._listenDomElements=function(a,b,c){_.each(this._vps,function(d){d._listenDomElement(a,b,c)})},c.prototype._onKey=function(a,b,c){this._keyboardManager.on(a,b,c)},c.prototype._offKey=function(a,b,c){this._keyboardManager.off(a,b,c)},a}();b.Element=function(){var a={},b=function(){this._space=null,this._x=0,this._y=0,this._w=0,this._h=0,this._px=0,this._py=0};return a.create=function(){return new b},b.prototype.width=function(){return this._w},b.prototype.height=function(){return this._h},b.prototype.center=function(){throw"Not implemented"},b.prototype.box=function(){return{x0:this._x,y0:this._y,x1:this._x+this._w,y1:this._y+this._h}},b.prototype.visibilityRatio=function(a){return a.visibilityRatioOf(this)},b.prototype.distanceRatio=function(a){return a.distanceRatioOf(this)},b.prototype.focusRatio=function(a){return a.focusRatioOf(this)},b.prototype.isInside=function(){throw"Not implemented"},b.prototype.isOutside=function(){throw"Not implemented"},b.prototype.pivot=function(){throw"Not implemented"},b.prototype.size=function(a,b){if("object"==typeof a)b=a.height,a=a.width;else if("undefined"==typeof a)return{width:this._w,height:this._h};return this._w=a,this._h=b,this._space._scaleDomElement(this),this},b.prototype.scale=function(){},b.prototype.rotate=function(){},b.prototype.moveTo=function(){},b.prototype.moveBy=function(a,b,c){return"object"==typeof a&&("object"==typeof b&&(c=b),b=a.y,a=a.x),this._x+=a,this._y+=b,this._space._moveDomElement(this,c),this},b.prototype.scalable=function(){throw"Not implemented"},b.prototype.rotatable=function(){throw"Not implemented"},b.prototype.draggable=function(){throw"Not implemented"},b.prototype.remove=function(){throw"Not implemented"},b.prototype.on=function(a,b,c){return"undefined"==typeof c&&"function"==typeof b?(c=b,this._space._listenDomElements(this,a,c),void 0):(b._listenDomElement(this,a,c),void 0)},b.prototype.off=function(){throw"Not implemented"},b.prototype._domAppend=function(){throw"Abstract function. Must be implemented by the instance."},b.prototype._domMove=function(a,b){var c=b(this._x,this._y);a.css({left:c.x+"em",top:c.y+"em"})},b.prototype._domScale=function(a,b){var c=b(this._x,this._y),d=b(this._x+this._w,this._y+this._h);a.css({left:c.x+"em",top:c.y+"em",width:d.x-c.x+"em",height:d.y-c.y+"em"})},b.prototype._domRotate=function(){throw"Abstract function. Must be implemented by the instance."},b.prototype._domRemove=function(a){a.remove()},b.prototype._domListen=function(a,b,c){"mousewheel"===b?a.mousewheel(function(a,b){c(b)}):Hammer(a[0]).on(b,c)},a}(),b.Viewport=function(){var a={},b=function(a,b,c){"undefined"==typeof c&&(c={}),this._space=a,this._container="string"==typeof b?document.querySelector(b):b.hasOwnProperty(0)?b[0]:b,$(this._container).css({position:"relative",overflow:"hidden","font-size":"1px"}),c.hasOwnProperty("width")&&("number"==typeof c.width&&(c.width=c.width+"px"),$(this._container).css("width",c.width)),c.hasOwnProperty("height")&&("number"==typeof c.height&&(c.height=c.height+"px"),$(this._container).css("height",c.height)),this._x=0,this._y=0,this._px=0,this._py=0,this._scale=1,this._hammertime=Hammer(this._container),this._domPairs={},this._draggable={},this._scalable={};var d=this;this._fromSpace=function(){return d.fromSpace.apply(d,arguments)}};return a.create=function(a,c,d){return new b(a,c,d)},b.prototype.width=function(){var a=$(this._container).width();return this.toSpaceDistance(a)},b.prototype.height=function(){var a=$(this._container).height();return this.toSpaceDistance(a)},b.prototype.center=function(){return{x:this._x+this.width()/2,y:this._y+this.height()/2}},b.prototype.box=function(){throw"Not implemented"},b.prototype.visibilityRatioOf=function(){throw"Not implemented"},b.prototype.distanceRatioOf=function(){throw"Not implemented"},b.prototype.focusRatioOf=function(){throw"Not implemented"},b.prototype.toSpace=function(a,b){return"object"==typeof a&&(b=a.y,a=a.x),{x:this._x+a/this._scale,y:this._y+b/this._scale}},b.prototype.fromSpace=function(a,b){return"object"==typeof a&&(b=a.y,a=a.x),{x:(a-this._x)*this._scale,y:(b-this._y)*this._scale}},b.prototype.toSpaceDistance=function(a){return a/this._scale},b.prototype.fromSpaceDistance=function(a){return a*this._scale},b.prototype.pivot=function(a,b){if("object"==typeof a)b=a.y,a=a.x;else if("undefined"==typeof a)return{x:this._px,y:this._py};return this._px=a,this._py=b,this},b.prototype.moveTo=function(a,b,c){"object"==typeof a&&("object"==typeof b&&(c=b),b=a.y,a=a.x),"undefined"==typeof c&&(c={}),this.moveBy(a-this._px,b-this._py,c)},b.prototype.moveBy=function(a,b,c){return"object"==typeof a&&("object"==typeof b&&(c=b),b=a.y,a=a.x),"undefined"==typeof c&&(c={}),this._x+=a,this._y+=b,this._px+=a,this._py+=b,"disableDomUpdate"in c&&c.disableDomUpdate===!0||this._moveEachDomElement(c),this},b.prototype.scale=function(a,b){var c=this.fromSpace(this._px,this._py);this._scale*=a;var d=this.fromSpace(this._px,this._py),e=this.toSpaceDistance(d.x-c.x),f=this.toSpaceDistance(d.y-c.y);return this.moveBy(e,f,{disableDomUpdate:!0}),this._scaleEachDomElement(b),this},b.prototype.rotate=function(){throw"Not implemented"},b.prototype.focusTo=function(a,b,c){"undefined"==typeof b?b=.8:"object"==typeof b&&(c=b,b=.8),"object"!=typeof c&&(c={}),"box"in a&&"function"==typeof a.box&&(a=a.box()),this.pivot(this.center());var d=(a.x0+a.x1)/2,e=(a.y0+a.y1)/2;this.moveTo(d,e,{disableDomUpdate:!0});var f=a.x1-a.x0,g=a.y1-a.y0,h=1,i=1;0!==f&&0!==g&&(h=this.width()/f,i=this.height()/g);var j=Math.min(h,i);this.scale(j*b,c)},b.prototype.scalable=function(a,b){"object"==typeof a?(b=a,a=!0):"boolean"!=typeof a&&(a=!0),"object"!=typeof b&&(b={});var c=this._scalable;if(!c.hasOwnProperty("status")){var d=this;c.status=!1,c.onmousewheel=function(a,b){var c=$(d._container).offset(),e=a.pageX-c.left,f=a.pageY-c.top,g=d.toSpace(e,f);d.pivot(g),b>0?d.scale(1.25):d.scale(.8)},c.onkeyplus=function(){d.pivot(d.center()).scale(1.25)},c.onkeyminus=function(){d.pivot(d.center()).scale(.8)}}return a===!1?(c.status=!1,this.off("mousewheel",c.onmousewheel),this.off("key-plus",c.onkeyplus),this.off("key-subtract",c.onkeyminus),this):c.status===!0?this:(c.status=!0,this.on("mousewheel",c.onmousewheel),this.on("key-plus",c.onkeyplus),this.on("key-subtract",c.onkeyminus),this)},b.prototype.rotatable=function(){throw"Not implemented"},b.prototype.draggable=function(a,b){if("object"==typeof a?(b=a,a=!0):"boolean"!=typeof a&&(a=!0),"object"!=typeof b&&(b={}),!this._draggable.hasOwnProperty("status")){var c=0,d=0,e=this,f=function(){return 50/e._scale};this._draggable={status:!1,ondragstart:function(){c=0,d=0},ondrag:function(a){a.gesture.preventDefault();var b=e.toSpaceDistance(a.gesture.deltaX),f=e.toSpaceDistance(a.gesture.deltaY);e.moveBy(c-b,d-f),c=b,d=f},onkeyup:function(){e.moveBy(0,-f())},onkeydown:function(){e.moveBy(0,f())},onkeyleft:function(){e.moveBy(-f(),0)},onkeyright:function(){e.moveBy(f(),0)}}}return a===!1?(this._draggable.status=!1,this.off("dragstart",this._draggable.ondragstart),this.off("drag",this._draggable.ondrag),this.off("key-up",this._draggable.onkeyup),this.off("key-down",this._draggable.onkeydown),this.off("key-left",this._draggable.onkeyleft),this.off("key-right",this._draggable.onkeyright),this):this._draggable.status===!0?this:(this._draggable.status=!0,this.on("dragstart",this._draggable.ondragstart),this.on("drag",this._draggable.ondrag),this.on("key-up",this._draggable.onkeyup),this.on("key-down",this._draggable.onkeydown),this.on("key-left",this._draggable.onkeyleft),this.on("key-right",this._draggable.onkeyright),this)},b.prototype.hideElement=function(){throw"Not implemented"},b.prototype.showElement=function(){throw"Not implemented"},b.prototype.on=function(a,b){if("mousewheel"===a)$(this._container).on("mousewheel",b);else if(0===a.indexOf("key-")){var c=a.substring(4);this._space._onKey(c,this,b)}else this._hammertime.on(a,b)},b.prototype.off=function(a,b){if("mousewheel"===a)$(this._container).off("mousewheel",b);else if(0===a.indexOf("key-")){var c=a.substring(4);this._space._offKey(c,this,b)}else this._hammertime.off(a,b)},b.prototype._getDomPair=function(a){if(this._domPairs.hasOwnProperty(a))return this._domPairs[a];throw{name:"UnknownElementError",message:"The element with _id "+a+" is not yet known"}},b.prototype._eachDomPair=function(a){for(var b in this._domPairs)this._domPairs.hasOwnProperty(b)&&a(this._domPairs[b])},b.prototype._createDomElement=function(a){var b=a._domAppend(this._container,this._fromSpace);this._domPairs[a._id]={elem:a,dom:b}},b.prototype._moveDomElement=function(a){var b=this._getDomPair(a._id).dom;a._domMove(b,this._fromSpace)},b.prototype._moveEachDomElement=function(){var a=this._fromSpace;this._eachDomPair(function(b){b.elem._domMove(b.dom,a)})},b.prototype._scaleDomElement=function(a){var b=this._getDomPair(a._id).dom;a._domScale(b,this._fromSpace,this._scale)},b.prototype._scaleEachDomElement=function(){var a=this._fromSpace,b=this._scale;this._eachDomPair(function(c){c.elem._domScale(c.dom,a,b)})},b.prototype._listenDomElement=function(a,b,c){var d=this._getDomPair(a._id).dom;a._domListen(d,b,c)},a}(),b.Text=function(){var a={},c=function(a,b,c){"undefined"==typeof c&&(c={}),this._space=a,this._string=b,this._fontSize=c.hasOwnProperty("fontSize")?c.fontSize:1};return a.create=function(a,b,d){return new c(a,b,d)},c.prototype=b.Element.create(),c.prototype.fontSize=function(a,b){return this._fontSize=a,this._space._scaleDomElement(this,b),this},c.prototype.fontScale=function(){throw"Not implemented"},c.prototype._domAppend=function(a,b,c){"object"!=typeof c&&(c={});var d=$(document.createElement("p")),e=$(document.createElement("span"));d.append(e);var f="html";return c.hasOwnProperty("disableHTML")&&c.disableHTML===!0&&(f="text"),e[f](this._string),d.css({position:"absolute"}),$(a).append(d),this._domMove(d,b,c),d},c.prototype._domScale=function(a,b,c){var d=b(this._x,this._y),e=b(this._x+this._w,this._y+this._h);a.children().css("font-size",this._fontSize*c+"em"),a.css({left:d.x+"em",top:d.y+"em",width:e.x-d.x+"em",height:e.y-d.y+"em"})},a}(),b.Image=function(){var a={},c=function(a,b,c){this._space=a,this._src=b,this._w=100,this._h=100,"object"==typeof c&&(c.hasOwnProperty("width")&&(this._w=c.width),c.hasOwnProperty("height")&&(this._h=c.height))};return a.create=function(a,b,d){return new c(a,b,d)},c.prototype=b.Element.create(),c.prototype._domAppend=function(a,b,c){var d=$(document.createElement("img"));return d.attr("src",this._src),d.css({position:"absolute",width:this._w+"px",height:this._h+"px"}),$(a).append(d),this._domMove(d,b,c),d},a}(),b.Group=function(){var a={},b=function(a){this._space=a};return a.create=function(a,c){return new b(a,c)},a}(),b.Network=function(){var a={},b=function(a){this._space=a};return a.create=function(a,c,d){return new b(a,c,d)},a}(),b.Custom=function(){var a={},b=function(a){this._space=a};return a.create=function(a,c,d){return new b(a,c,d)},a}(),b.KeyboardManager=function(){var a={},b=function(a){"undefined"==typeof a&&(a=document),this._c=a,this._pairs={},this._selected=[]};a.create=function(){return new b},b.prototype.select=function(a){return _.contains(this._selected,a)?!1:(this._selected.push(a),void 0)},b.prototype.isSelected=function(a){return _.contains(this._selected,a)},b.prototype.deselect=function(a){var b=this._selected,c=_.without(b,a);return this._selected=c,b.length>c.length},b.prototype.on=function(a,b,d){var e=c(this._pairs,a,b,d);return e&&jwerty.key(a,function(){var b=this._pairs[a],c=_.filter(b,function(a){return this.isSelected(a.object)},this);_.each(c,function(a){a.handler.call(a.object)})},this,this._c),this},b.prototype.off=function(a,b,c){return d(this._pairs,a,b,c),this},b.prototype.clean=function(){throw"not yet implemented"};var c=function(a,b,c,d){var e={object:c,handler:d};return a.hasOwnProperty(b)?(a[b].push(e),!1):(a[b]=[e],!0)},d=function(a,b,c,d){if(a.hasOwnProperty(b)){var e=a[b],f=_.reject(e,function(a){return a.object===c&&a.handler===d?!0:void 0});return a[b]=f,e.length>f.length}return!1};return a}(),"object"==typeof module&&"object"==typeof module.exports?module.exports=b:a.Taaspace=b}(this);
//# sourceMappingURL=taaspace.min.map