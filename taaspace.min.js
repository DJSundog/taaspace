(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.taaspace = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
function Emitter(t){return t?mixin(t):void 0}function mixin(t){for(var e in Emitter.prototype)t[e]=Emitter.prototype[e];return t}module.exports=Emitter,Emitter.prototype.on=Emitter.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},Emitter.prototype.once=function(t,e){function i(){this.off(t,i),e.apply(this,arguments)}return i.fn=e,this.on(t,i),this},Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var i=this._callbacks["$"+t];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var r,s=0;s<i.length;s++)if(r=i[s],r===e||r.fn===e){i.splice(s,1);break}return this},Emitter.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),i=this._callbacks["$"+t];if(i){i=i.slice(0);for(var r=0,s=i.length;s>r;++r)i[r].apply(this,e)}return this},Emitter.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},Emitter.prototype.hasListeners=function(t){return!!this.listeners(t).length};
},{}],2:[function(require,module,exports){
module.exports=function(n,o){var r,l,t,e,u,f,c,a;if("function"!=typeof o)throw new Error("callback should be a function: "+o);for("string"==typeof n?(r=1,l=!0,n=[n]):(r=n.length,l=!1),t=!1,e=!1,u=[],f=0,c=function(){if(!e){f+=1;var n=f===r;n&&(t=!0,l?o(null,u[0]):o(null,u))}},a=function(n){return t||(e=!0,o(n,null)),!0},i=0;i<n.length;i+=1)u.push(new Image),u[i].onload=c,u[i].onerror=a,u[i].src=n[i]};
},{}],3:[function(require,module,exports){
function Move(t){if(!(this instanceof Move))return new Move(t);if("string"==typeof t&&(t=query(t)),!t)throw new TypeError("Move must be initialized with element or selector");this.el=t,this._props={},this._rotate=0,this._transitionProps=[],this._transforms=[],this.duration(Move.defaults.duration)}var Emitter=require("component-emitter"),query=require("component-query"),after=require("after-transition"),has3d=require("has-translate3d"),ease=require("css-ease"),translate=has3d?["translate3d(",", 0)"]:["translate(",")"];module.exports=Move;var style=window.getComputedStyle||window.currentStyle;Move.version="0.5.0",Move.ease=ease,Move.defaults={duration:500},Move.select=function(t){return"string"!=typeof t?t:query(t)},Emitter(Move.prototype),Move.prototype.transform=function(t){return this._transforms.push(t),this},Move.prototype.skew=function(t,e){return this.transform("skew("+t+"deg, "+(e||0)+"deg)")},Move.prototype.skewX=function(t){return this.transform("skewX("+t+"deg)")},Move.prototype.skewY=function(t){return this.transform("skewY("+t+"deg)")},Move.prototype.translate=Move.prototype.to=function(t,e){return this.transform(translate.join(""+t+"px, "+(e||0)+"px"))},Move.prototype.translateX=Move.prototype.x=function(t){return this.transform("translateX("+t+"px)")},Move.prototype.translateY=Move.prototype.y=function(t){return this.transform("translateY("+t+"px)")},Move.prototype.scale=function(t,e){return this.transform("scale("+t+", "+(e||t)+")")},Move.prototype.scaleX=function(t){return this.transform("scaleX("+t+")")},Move.prototype.matrix=function(t,e,r,o,n,s){return this.transform("matrix("+[t,e,r,o,n,s].join(",")+")")},Move.prototype.scaleY=function(t){return this.transform("scaleY("+t+")")},Move.prototype.rotate=function(t){return this.transform("rotate("+t+"deg)")},Move.prototype.ease=function(t){return t=ease[t]||t||"ease",this.setVendorProperty("transition-timing-function",t)},Move.prototype.animate=function(t,e){for(var r in e)e.hasOwnProperty(r)&&this.setVendorProperty("animation-"+r,e[r]);return this.setVendorProperty("animation-name",t)},Move.prototype.duration=function(t){return t=this._duration="string"==typeof t?1e3*parseFloat(t):t,this.setVendorProperty("transition-duration",t+"ms")},Move.prototype.delay=function(t){return t="string"==typeof t?1e3*parseFloat(t):t,this.setVendorProperty("transition-delay",t+"ms")},Move.prototype.setProperty=function(t,e){return this._props[t]=e,this},Move.prototype.setVendorProperty=function(t,e){return this.setProperty("-webkit-"+t,e),this.setProperty("-moz-"+t,e),this.setProperty("-ms-"+t,e),this.setProperty("-o-"+t,e),this},Move.prototype.set=function(t,e){return this.transition(t),this._props[t]=e,this},Move.prototype.add=function(t,e){if(style){var r=this;return this.on("start",function(){var o=parseInt(r.current(t),10);r.set(t,o+e+"px")})}},Move.prototype.sub=function(t,e){if(style){var r=this;return this.on("start",function(){var o=parseInt(r.current(t),10);r.set(t,o-e+"px")})}},Move.prototype.current=function(t){return style(this.el).getPropertyValue(t)},Move.prototype.transition=function(t){return this._transitionProps.indexOf(t)?(this._transitionProps.push(t),this):this},Move.prototype.applyProperties=function(){for(var t in this._props)this.el.style.setProperty(t,this._props[t],"");return this},Move.prototype.move=Move.prototype.select=function(t){return this.el=Move.select(t),this},Move.prototype.then=function(t){if(t instanceof Move)this.on("end",function(){t.end()});else{if("function"!=typeof t){var e=new Move(this.el);return e._transforms=this._transforms.slice(0),this.then(e),e.parent=this,e}this.on("end",t)}return this},Move.prototype.pop=function(){return this.parent},Move.prototype.reset=function(){return this.el.style.webkitTransitionDuration=this.el.style.mozTransitionDuration=this.el.style.msTransitionDuration=this.el.style.oTransitionDuration="",this},Move.prototype.end=function(t){var e=this;return this.emit("start"),this._transforms.length&&this.setVendorProperty("transform",this._transforms.join(" ")),this.setVendorProperty("transition-properties",this._transitionProps.join(", ")),this.applyProperties(),t&&this.then(t),after.once(this.el,function(){e.reset(),e.emit("end")}),this};
},{"after-transition":4,"component-emitter":1,"component-query":8,"css-ease":9,"has-translate3d":10}],4:[function(require,module,exports){
function afterTransition(i,n){return hasTransitions(i)?emitter(i).bind(n):n.apply(i)}var hasTransitions=require("has-transitions"),emitter=require("css-emitter");afterTransition.once=function(i,n){afterTransition(i,function t(){n.apply(i),emitter(i).unbind(t)})},module.exports=afterTransition;
},{"css-emitter":5,"has-transitions":7}],5:[function(require,module,exports){
function CssEmitter(t){return this instanceof CssEmitter?void(this.el=t):new CssEmitter(t)}var events=require("event"),watch=["transitionend","webkitTransitionEnd","oTransitionEnd","MSTransitionEnd","animationend","webkitAnimationEnd","oAnimationEnd","MSAnimationEnd"];module.exports=CssEmitter,CssEmitter.prototype.bind=function(t){for(var n=0;n<watch.length;n++)events.bind(this.el,watch[n],t);return this},CssEmitter.prototype.unbind=function(t){for(var n=0;n<watch.length;n++)events.unbind(this.el,watch[n],t);return this},CssEmitter.prototype.once=function(t){function n(){i.unbind(n),t.apply(i.el,arguments)}var i=this;return i.bind(n),this};
},{"event":6}],6:[function(require,module,exports){
exports.bind=function(e,n,t,r){return e.addEventListener?e.addEventListener(n,t,r):e.attachEvent("on"+n,t),t},exports.unbind=function(e,n,t,r){return e.removeEventListener?e.removeEventListener(n,t,r):e.detachEvent("on"+n,t),t};
},{}],7:[function(require,module,exports){
function hasTransitions(t){if(!property)return!1;if(!t)return null!=property;var r=getComputedStyle(t)[property];return""!==r&&0!==parseFloat(r)}for(var property,types=["transitionDuration","MozTransitionDuration","webkitTransitionDuration"];types.length;){var type=types.shift();type in document.body.style&&(property=type)}module.exports=hasTransitions;
},{}],8:[function(require,module,exports){
function one(e,r){return r.querySelector(e)}exports=module.exports=function(e,r){return r=r||document,one(e,r)},exports.all=function(e,r){return r=r||document,r.querySelectorAll(e)},exports.engine=function(e){if(!e.one)throw new Error(".one callback required");if(!e.all)throw new Error(".all callback required");return one=e.one,exports.all=e.all,exports};
},{}],9:[function(require,module,exports){
module.exports={"in":"ease-in",out:"ease-out","in-out":"ease-in-out",snap:"cubic-bezier(0,1,.5,1)",linear:"cubic-bezier(0.250, 0.250, 0.750, 0.750)","ease-in-quad":"cubic-bezier(0.550, 0.085, 0.680, 0.530)","ease-in-cubic":"cubic-bezier(0.550, 0.055, 0.675, 0.190)","ease-in-quart":"cubic-bezier(0.895, 0.030, 0.685, 0.220)","ease-in-quint":"cubic-bezier(0.755, 0.050, 0.855, 0.060)","ease-in-sine":"cubic-bezier(0.470, 0.000, 0.745, 0.715)","ease-in-expo":"cubic-bezier(0.950, 0.050, 0.795, 0.035)","ease-in-circ":"cubic-bezier(0.600, 0.040, 0.980, 0.335)","ease-in-back":"cubic-bezier(0.600, -0.280, 0.735, 0.045)","ease-out-quad":"cubic-bezier(0.250, 0.460, 0.450, 0.940)","ease-out-cubic":"cubic-bezier(0.215, 0.610, 0.355, 1.000)","ease-out-quart":"cubic-bezier(0.165, 0.840, 0.440, 1.000)","ease-out-quint":"cubic-bezier(0.230, 1.000, 0.320, 1.000)","ease-out-sine":"cubic-bezier(0.390, 0.575, 0.565, 1.000)","ease-out-expo":"cubic-bezier(0.190, 1.000, 0.220, 1.000)","ease-out-circ":"cubic-bezier(0.075, 0.820, 0.165, 1.000)","ease-out-back":"cubic-bezier(0.175, 0.885, 0.320, 1.275)","ease-out-quad":"cubic-bezier(0.455, 0.030, 0.515, 0.955)","ease-out-cubic":"cubic-bezier(0.645, 0.045, 0.355, 1.000)","ease-in-out-quart":"cubic-bezier(0.770, 0.000, 0.175, 1.000)","ease-in-out-quint":"cubic-bezier(0.860, 0.000, 0.070, 1.000)","ease-in-out-sine":"cubic-bezier(0.445, 0.050, 0.550, 0.950)","ease-in-out-expo":"cubic-bezier(1.000, 0.000, 0.000, 1.000)","ease-in-out-circ":"cubic-bezier(0.785, 0.135, 0.150, 0.860)","ease-in-out-back":"cubic-bezier(0.680, -0.550, 0.265, 1.550)"};
},{}],10:[function(require,module,exports){
var prop=require("transform-property");if(prop&&window.getComputedStyle){var map={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"},el=document.createElement("div");el.style[prop]="translate3d(1px,1px,1px)",document.body.insertBefore(el,null);var val=getComputedStyle(el).getPropertyValue(map[prop]);document.body.removeChild(el),module.exports=null!=val&&val.length&&"none"!=val}else module.exports=!1;
},{"transform-property":11}],11:[function(require,module,exports){
for(var styles=["webkitTransform","MozTransform","msTransform","OTransform","transform"],el=document.createElement("p"),style,i=0;i<styles.length;i++)if(style=styles[i],null!=el.style[style]){module.exports=style;break}
},{}],12:[function(require,module,exports){
exports.Transform=require("./lib/Transform"),exports.estimateT=require("./lib/estimateT"),exports.estimateS=require("./lib/estimateS"),exports.estimateR=require("./lib/estimateR"),exports.estimateTS=require("./lib/estimateTS"),exports.estimateTR=require("./lib/estimateTR"),exports.estimateSR=require("./lib/estimateSR"),exports.estimateTSR=require("./lib/estimateTSR"),exports.version=require("./lib/version"),exports.estimate=function(e,t,r,i){var s="estimate"+e.toUpperCase();if(exports.hasOwnProperty(s))return exports[s](t,r,i);throw new Error("Unknown estimator type: "+e)};
},{"./lib/Transform":13,"./lib/estimateR":14,"./lib/estimateS":15,"./lib/estimateSR":16,"./lib/estimateT":17,"./lib/estimateTR":18,"./lib/estimateTS":19,"./lib/estimateTSR":20,"./lib/version":21}],13:[function(require,module,exports){
var Transform=function(t,n,r,e){this.s=t,this.r=n,this.tx=r,this.ty=e,this.equals=function(s){return t===s.s&&n===s.r&&r===s.tx&&e===s.ty},this.transform=function(s){if("number"==typeof s[0])return[t*s[0]-n*s[1]+r,n*s[0]+t*s[1]+e];var a,i=[];for(a=0;a<s.length;a+=1)i.push([t*s[a][0]-n*s[a][1]+r,n*s[a][0]+t*s[a][1]+e]);return i},this.getMatrix=function(){return{a:t,b:n,c:-n,d:t,e:r,f:e}},this.getRotation=function(){return Math.atan2(n,t)},this.getScale=function(){return Math.sqrt(n*n+t*t)},this.getTranslation=function(){return[r,e]},this.inverse=function(){var s=t*t+n*n,a=1e-8;if(Math.abs(s)<a)throw new Error("Singular transformations cannot be inversed.");var i=t/s,o=-n/s,f=(-t*r-n*e)/s,u=(n*r-t*e)/s;return new Transform(i,o,f,u)},this.translateBy=function(s,a){return new Transform(t,n,r+s,e+a)},this.scaleBy=function(s,a){var i,o,f;return i=s,"undefined"==typeof a?o=f=0:(o=a[0],f=a[1]),new Transform(i*t,i*n,i*r+(1-i)*o,i*e+(1-i)*f)},this.rotateBy=function(s,a){var i,o,f,u,h,c,m,y;return i=Math.cos(s),o=Math.sin(s),"undefined"==typeof a?f=u=0:(f=a[0],u=a[1]),h=t*i-n*o,c=t*o+n*i,m=(r-f)*i-(e-u)*o+f,y=(r-f)*o+(e-u)*i+u,new Transform(h,c,m,y)},this.multiplyBy=function(s){var a=s,i=t*a.s-n*a.r,o=t*a.r+n*a.s,f=t*a.tx-n*a.ty+r,u=n*a.tx+t*a.ty+e;return new Transform(i,o,f,u)}};Transform.IDENTITY=new Transform(1,0,0,0),module.exports=Transform;
},{}],14:[function(require,module,exports){
var Transform=require("./Transform");module.exports=function(r,n,e){var o,t,a,f,m,s,T,u,h,i,d,l,g,v,I,M,c;for(t=Math.min(r.length,n.length),i=d=l=g=0,"undefined"==typeof e?f=m=0:(f=e[0],m=e[1]),o=0;t>o;o+=1)s=r[o][0]-f,T=r[o][1]-m,u=n[o][0]-f,h=n[o][1]-m,i+=s*u,d+=s*h,l+=T*u,g+=T*h;return p=i+g,q=d-l,a=Math.sqrt(p*p+q*q),0===a?Transform.IDENTITY:(v=p/a,I=q/a,M=f-f*v+m*I,c=m-f*I-m*v,new Transform(v,I,M,c))};
},{"./Transform":13}],15:[function(require,module,exports){
var Transform=require("./Transform");module.exports=function(r,n,e){var a,o,f,t,m,T,s,u,h,i,d,l,g,p,v,x;for(o=Math.min(r.length,n.length),i=d=l=g=0,"undefined"==typeof e?t=m=0:(t=e[0],m=e[1]),a=0;o>a;a+=1)T=r[a][0]-t,s=r[a][1]-m,u=n[a][0]-t,h=n[a][1]-m,i+=T*u,d+=s*h,l+=T*T,g+=s*s;return f=l+g,0===f?Transform.IDENTITY:(p=Math.max(0,(i+d)/f),v=(1-p)*t,x=(1-p)*m,new Transform(p,0,v,x))};
},{"./Transform":13}],16:[function(require,module,exports){
var Transform=require("./Transform");module.exports=function(r,n,e){var a,o,f,t,m,s,u;"undefined"==typeof e&&(e=[0,0]),a=r,o=n,f=Math.min(a.length,o.length);var v,h,i,T,d,l,g,p=e[0],w=e[1];l=g=0;var M,b,c,q;for(M=b=c=q=0,v=0;f>v;v+=1)h=a[v][0]-p,i=a[v][1]-w,T=o[v][0]-p,d=o[v][1]-w,l+=h*h,g+=i*i,M+=h*T,b+=i*d,c+=i*T,q+=h*d;var x=l+g,y=1e-8;return Math.abs(x)<y?new Transform(1,0,0,0):(t=(M+b)/x,m=(-c+q)/x,s=w*m-p*t+p,u=-p*m-w*t+w,new Transform(t,m,s,u))};
},{"./Transform":13}],17:[function(require,module,exports){
var Transform=require("./Transform");module.exports=function(r,n){var e,o,a,f,t,m,T,s;if(o=Math.min(r.length,n.length),a=f=t=m=0,1>o)return Transform.IDENTITY;for(e=0;o>e;e+=1)a+=r[e][0],f+=r[e][1],t+=n[e][0],m+=n[e][1];return T=(t-a)/o,s=(m-f)/o,new Transform(1,0,T,s)};
},{"./Transform":13}],18:[function(require,module,exports){
var Transform=require("./Transform");module.exports=function(r,n){var a,e,o,t,f,m,s,u,T,h,i,v,l,w=r,g=n,q=Math.min(w.length,g.length);for(m=s=u=T=h=i=v=l=0,a=0;q>a;a+=1)e=w[a][0],o=w[a][1],t=g[a][0],f=g[a][1],m+=e,s+=o,u+=t,T+=f,h+=e*t,i+=e*f,v+=o*t,l+=o*f;var M=q*(i-v)-m*T+s*u,c=q*(h+l)-m*u-s*T,d=Math.sqrt(M*M+c*c);if(0===d)return 0===q?new Transform(1,0,0,0):new Transform(1,0,(u-m)/q,(T-s)/q);var p=c/d,x=M/d,b=(-m*p+s*x+u)/q,j=(-m*x-s*p+T)/q;return new Transform(p,x,b,j)};
},{"./Transform":13}],19:[function(require,module,exports){
var Transform=require("./Transform");module.exports=function(r,n){var e,a,o,f,m,t,s,u,T,i,v,h,l,w=r,g=n,c=Math.min(w.length,g.length);for(t=s=u=T=i=v=h=l=0,e=0;c>e;e+=1)a=w[e][0],o=w[e][1],f=g[e][0],m=g[e][1],t+=a,s+=o,u+=f,T+=m,i+=a*a,v+=o*o,h+=a*f,l+=o*m;var d=c*c,p=t*t,q=s*s,x=i+v,M=h+l,b=d*x-c*(p+q);if(0===b)return 0===c?new Transform(1,0,0,0):new Transform(1,0,u/c-a,T/c-o);var j=(d*M-c*(t*u+s*T))/b,k=(-c*t*M+c*u*x-q*u+t*s*T)/b,y=(-c*s*M+c*T*x-p*T+t*s*u)/b;return new Transform(j,0,k,y)};
},{"./Transform":13}],20:[function(require,module,exports){
var Transform=require("./Transform");module.exports=function(r,n){var e,a,o,f,m,t,s;if(e=r,a=n,o=Math.min(e.length,a.length),0===o)return new Transform(1,0,0,0);var u,T,i,v,h,l=0,w=0,g=0,c=0,d=0,p=0,q=0,x=0,M=0,b=0;for(u=0;o>u;u+=1)T=e[u][0],i=e[u][1],v=a[u][0],h=a[u][1],l+=T,w+=i,g+=v,c+=h,d+=T*T,p+=i*i,q+=T*h,x+=i*v,M+=T*v,b+=i*h;var j=o*d+o*p-l*l-w*w,k=1e-8;return j>-k&&k>j?new Transform(1,0,g/o-T,c/o-i):(f=(o*(M+b)-l*g-w*c)/j,m=(o*(q-x)+w*g-l*c)/j,t=(-l*(M+b)+w*(q-x)+d*g+p*g)/j,s=(-w*(M+b)-l*(q-x)+d*c+p*c)/j,new Transform(f,m,t,s))};
},{"./Transform":13}],21:[function(require,module,exports){
module.exports="1.0.1";
},{}],22:[function(require,module,exports){
"use strict";function SeqId(t){return this instanceof SeqId?(null==t&&(t=(Math.random()-.5)*Math.pow(2,32)),void(this._id=0|t)):new SeqId(t)}module.exports=SeqId,SeqId.prototype.next=function(){return this._id=this._id+1|0,this._id};
},{}],23:[function(require,module,exports){
var Emitter=require("component-emitter"),SpaceNode=require("./SpaceNode"),SpacePlane=require("./SpacePlane"),Transformer=require("./Transformer"),SpaceRectangle=require("./SpaceRectangle"),SpaceTaa=require("./SpaceTaa"),SpaceHTML=require("./SpaceHTML"),move=require("movejs");move.defaults={duration:0};var HTMLSpaceView=function(e,t){if(!("tagName"in t))throw"Container should be a DOM Element";Emitter(this),SpaceNode(this),SpacePlane(this),Transformer(this),SpaceRectangle(this);var n=this;this._el=t,this._elements={},this._nodes={},function(){var e=n._el.clientWidth,t=n._el.clientHeight;n.resize([e,t])}();var i=function(e,t){var i=t.getGlobalTransform(),o=n._T.inverse().multiplyBy(i),a=8,r=o.s.toFixed(a),s=o.r.toFixed(a),d=o.tx.toFixed(a),l=o.ty.toFixed(a);move(e).matrix(r,s,-s,r,d,l).end()},o=function(e){return n.id+"/"+e},a=function(e,t,a){"undefined"==typeof a&&(a=null),"undefined"==typeof t&&(t=null);var r,s,d;if(r=e,n._elements.hasOwnProperty(r.id));else if(r instanceof SpaceTaa)s=new Image(256,256),s.src=r.taa.image.src,s.id=o(r.id),s.className="taaspace-taa",n._el.appendChild(s),n._elements[r.id]=s,n._nodes[r.id]=r,i(s,r);else if(r instanceof SpaceHTML)s=document.createElement("div"),s.innerHTML=r.html,s.id=o(r.id),s.className="taaspace-html",d=r.getSize(),s.style.width=d[0]+"px",s.style.height=d[1]+"px",r.on("resized",function(){var e=r.getSize();s.style.width=e[0]+"px",s.style.height=e[1]+"px"}),n._el.appendChild(s),n._elements[r.id]=s,n._nodes[r.id]=r,i(s,r);else if(!(r instanceof HTMLSpaceView))throw new Exception("Unknown SpaceNode subtype; cannot represent")},r=function(e,t,i){"undefined"==typeof t&&(t=null),"undefined"==typeof i&&(i=null);var o,a,r;r=e,o=null===t||null===i?!1:t.getRootParent()===i.getRootParent(),o||n._elements.hasOwnProperty(r.id)&&(a=n._elements[r.id],n._el.removeChild(a),delete n._elements[r.id],delete n._nodes[r.id])},s=function(e){var t,o,a,r;for(t=e.getAllChildren(),t.push(e),o=0;o<t.length;o+=1)a=t[o],n._elements.hasOwnProperty(a.id)&&(a instanceof SpaceTaa?(r=n._elements[a.id],i(r,a)):a instanceof SpaceHTML&&(r=n._elements[a.id],i(r,a)))};this.on("added",function(e,t){t.on("contentAdded",a),t.on("contentRemoved",r),t.on("contentTransformed",s)}),this.on("removed",function(e,t){t.off("contentAdded",a),t.off("contentRemoved",r),t.off("contentTransformed",s)}),this.on("transformed",function(){var e,t,o;for(e in n._elements)n._elements.hasOwnProperty(e)&&(t=n._elements[e],o=n._nodes[e],i(t,o))}),this.getElementBySpaceNode=function(e){return this._elements.hasOwnProperty(e.id)?this._elements[e.id]:void 0},this.getSpaceNodeByElementId=function(e){var t=e.split("/"),n=t[0],i=t[1];return this.id===n&&this._nodes.hasOwnProperty(i)?this._nodes[i]:null},this.getRootElement=function(){return this._el},this.setParent(e)};module.exports=HTMLSpaceView;
},{"./SpaceHTML":25,"./SpaceNode":26,"./SpacePlane":27,"./SpaceRectangle":29,"./SpaceTaa":30,"./Transformer":33,"component-emitter":1,"movejs":3}],24:[function(require,module,exports){
var Emitter=require("component-emitter"),SpaceNode=require("./SpaceNode"),SpacePlane=require("./SpacePlane"),Space=function(){Emitter(this),SpaceNode(this),SpacePlane(this)};module.exports=Space;
},{"./SpaceNode":26,"./SpacePlane":27,"component-emitter":1}],25:[function(require,module,exports){
var Emitter=require("component-emitter"),SpaceNode=require("./SpaceNode"),SpacePlane=require("./SpacePlane"),Transformer=require("./Transformer"),SpaceRectangle=require("./SpaceRectangle"),SpaceHTML=function(e,r){Emitter(this),SpaceNode(this),SpacePlane(this),Transformer(this),SpaceRectangle(this),this.html=r,this.resize([256,256]),this.setParent(e)};module.exports=SpaceHTML;
},{"./SpaceNode":26,"./SpacePlane":27,"./SpaceRectangle":29,"./Transformer":33,"component-emitter":1}],26:[function(require,module,exports){
var Emitter=require("component-emitter"),seqid=require("seqid")(0),SpaceNode=function(e){e.id=seqid.next().toString(),e._parent=null,e._children={},e._addedHandlers={},e._removedHandlers={},e._transformedHandlers={},e.has=function(e){return e._parent===this},e.getParent=function(){return this._parent},e.getRootParent=function(){return null===this._parent?this:this._parent.getRootParent()},e.getChildren=function(){var e,t,n;t=[],n=this._children;for(e in n)t.push(n[e]);return t},e.getAllChildren=function(){var e,t,n,d;for(d=[],t=this.getChildren(),e=0;e<t.length;e+=1)n=t[e],d=d.concat(n,n.getAllChildren());return d},e.setParent=function(e){var t=this._parent;null===t?null===e||(this._parent=e,this._parent._addChild(this),this.emit("added",this,this._parent,null),e.emit("contentAdded",this,this._parent,null)):null===e?(this._parent=null,t._removeChild(this),this.emit("removed",this,t,null),t.emit("contentRemoved",this,t,null)):(this._parent=e,t._removeChild(this),e._addChild(this),this.emit("removed",this,t,e),this.emit("added",this,e,t),t.emit("contentRemoved",this,t,e),e.emit("contentAdded",this,e,t))},e.remove=function(){return this.setParent(null)},e._addChild=function(e){var t=e,n=this;this._children[t.id]=t;var d=function(e,t,d){n.emit("contentAdded",e,t,d)},i=function(e,t,d){n.emit("contentRemoved",e,t,d)},r=function(e,t,d){n.emit("contentTransformed",e,t,d)};t.on("contentAdded",d),t.on("contentRemoved",i),t.on("transformed",r),t.on("contentTransformed",r),this._addedHandlers[t.id]=d,this._removedHandlers[t.id]=i,this._transformedHandlers[t.id]=r},e._removeChild=function(e){var t,n;t=e,delete this._children[t.id],n=this._addedHandlers[t.id],delete this._addedHandlers[t.id],t.off("contentAdded",n),n=this._removedHandlers[t.id],delete this._removedHandlers[t.id],t.off("contentRemoved",n),n=this._transformedHandlers[t.id],delete this._transformedHandlers[t.id],t.off("transformed",n),t.off("contentTransformed",n)}};module.exports=SpaceNode;
},{"component-emitter":1,"seqid":22}],27:[function(require,module,exports){
var nudged=require("nudged"),SpacePoint=require("./SpacePoint"),at=function(n){if(2!==n.length)throw"Invalid point, use array [x, y]";return new SpacePoint(n,this)},SpacePlane=function(n){n._T=nudged.Transform.IDENTITY,n.at=at,n.getTransform=function(){return this._T},n.getGlobalTransform=function(){return null===this._parent?this._T:this._parent.getGlobalTransform().multiplyBy(this._T)},n.resetTransform=function(){this._T=nudged.Transform.IDENTITY}};module.exports=SpacePlane;
},{"./SpacePoint":28,"nudged":12}],28:[function(require,module,exports){
var Transform=require("./Transform"),SpacePoint=function(t,r){this.xy=t,r.hasOwnProperty("getGlobalTransform")?this._T=r.getGlobalTransform():this._T=r._T},proto=SpacePoint.prototype;proto.offset=function(t,r){var o=[this.xy[0]+t,this.xy[1]+r];return new SpacePoint(o,this)},proto.polarOffset=function(t,r){var o=this.xy[0]+t*Math.cos(r),n=this.xy[1]+t*Math.sin(r);return new SpacePoint([o,n],this)},proto.equals=function(t){return this.xy[0]===t.xy[0]&&this.xy[1]===t.xy[1]&&this._T.equals(t._T)},proto.to=function(t){if(null===t)return this.toSpace();var r=t.getGlobalTransform();if(r.equals(this._T))return this;var o=r.inverse().multiplyBy(this._T),n=o.transform(this.xy);return new SpacePoint(n,t)},proto.toSpace=function(){var t=this._T.transform(this.xy),r={_T:Transform.IDENTITY};return new SpacePoint(t,r)},proto.transform=function(t){var r=t.transform(this.xy);return new SpacePoint(r,this)},module.exports=SpacePoint;
},{"./Transform":32}],29:[function(require,module,exports){
var SpacePoint=require("./SpacePoint"),SpaceRectangle=function(n){var t=n,e=1,i=1;t.resize=function(n){e=n[0],i=n[1],this.emit("resized",t)},t.getSize=function(){return[e,i]},t.atNorm=function(n){return new SpacePoint([e*n[0],i*n[1]],t)},t.atMid=function(){return new SpacePoint([e/2,i/2],t)},t.atMidN=function(){return new SpacePoint([e/2,0],t)},t.atMidW=function(){return new SpacePoint([0,i/2],t)},t.atMidE=function(){return new SpacePoint([e,i/2],t)},t.atMidS=function(){return new SpacePoint([e/2,i],t)},t.atNW=function(){return new SpacePoint([0,0],t)},t.atNE=function(){return new SpacePoint([e,0],t)},t.atSW=function(){return new SpacePoint([0,i],t)},t.atSE=function(){return new SpacePoint([e,i],t)}};module.exports=SpaceRectangle;
},{"./SpacePoint":28}],30:[function(require,module,exports){
var Emitter=require("component-emitter"),SpaceNode=require("./SpaceNode"),SpacePlane=require("./SpacePlane"),Transformer=require("./Transformer"),SpaceRectangle=require("./SpaceRectangle"),SpaceTaa=function(e,a){Emitter(this),SpaceNode(this),SpacePlane(this),Transformer(this),SpaceRectangle(this),this.taa=a,this.resize([256,256]),this.setParent(e)};module.exports=SpaceTaa;
},{"./SpaceNode":26,"./SpacePlane":27,"./SpaceRectangle":29,"./Transformer":33,"component-emitter":1}],31:[function(require,module,exports){
var Emitter=require("component-emitter"),loadimages=require("loadimages"),NOOP=function(){},Taa=function(e,i){Emitter(this);var t=this;"function"!=typeof i&&(i=NOOP),this.image={src:e};var a=!1;loadimages(e,function(e,o){t.image=o,a?(t.emit("loaded",e,t),i(e,t)):setTimeout(function(){t.emit("loaded",e,t),i(e,t)},0)}),a=!0};module.exports=Taa;
},{"component-emitter":1,"loadimages":2}],32:[function(require,module,exports){
var nudged=require("nudged");module.exports=nudged.Transform;
},{"nudged":12}],33:[function(require,module,exports){
var nudged=require("nudged"),Transform=require("./Transform"),SpacePoint=require("./SpacePoint"),normalize=function(t,r){var e,n,a,i;if(!Array.isArray(t))return n=t,a=n.to(r).xy,[a];for(i=[],e=0;e<t.length;e+=1)n=t[e],a=n.to(r).xy,i.push(a);return i},transformByEstimate=function(t,r,e,n,a){var i;"undefined"!=typeof a&&(i=normalize(a,t._parent)[0]);var s=normalize(e,t._parent),o=normalize(n,t._parent),f=nudged.estimate(r,s,o,i);t._T=f.multiplyBy(t._T),t.emit("transformed",t)},Transformer=function(t){t.setTransform=function(t){null!==this._parent&&(this._T=t,this.emit("transformed",this))},t.setGlobalTransform=function(t){if(null!==this._parent){var r=this._parent.getGlobalTransform();this._T=r.inverse().multiplyBy(t),this.emit("transformed",this)}},t.translate=function(t,r){transformByEstimate(this,"T",t,r)},t.scale=function(t,r,e){var n="undefined"==typeof e;if(n){var a=normalize(t,this._parent)[0],i=r,s=Transform.IDENTITY.scaleBy(i,a);this._T=s.multiplyBy(this._T),this.emit("transformed",this)}else{var o=r;transformByEstimate(this,"S",o,e,t)}},t.rotate=function(t,r,e){var n="undefined"==typeof e;if(n){var a=normalize(t,this._parent)[0],i=r,s=Transform.IDENTITY.rotateBy(i,a);this._T=s.multiplyBy(this._T),this.emit("transformed",this)}else{var o=r;transformByEstimate(this,"R",o,e,t)}},t.translateScale=function(t,r){transformByEstimate(this,"TS",t,r)},t.translateRotate=function(t,r){transformByEstimate(this,"TR",t,r)},t.scaleRotate=function(t,r,e){transformByEstimate(this,"SR",r,e,t)},t.translateScaleRotate=function(t,r){transformByEstimate(this,"TSR",t,r)},t.on("removed",function(t,r,e){"undefined"==typeof r&&(r=null),"undefined"==typeof e&&(e=null);var n;if(null===e)this.resetTransform();else{if(null===r)throw new Exception("Cannot remove from null parent");if(n=r.getRootParent()===e.getRootParent()){var a=r.getGlobalTransform(),i=e.getGlobalTransform(),s=this._T,o=i.inverse().multiplyBy(a).multiplyBy(s);this._T=o,this.emit("transformed",this)}else this.resetTransform()}})};module.exports=Transformer;
},{"./SpacePoint":28,"./Transform":32,"nudged":12}],34:[function(require,module,exports){
exports.Taa=require("./Taa"),exports.SpaceTaa=require("./SpaceTaa"),exports.SpaceHTML=require("./SpaceHTML"),exports.Space=require("./Space"),exports.HTMLSpaceView=require("./HTMLSpaceView"),exports.version=require("./version");
},{"./HTMLSpaceView":23,"./Space":24,"./SpaceHTML":25,"./SpaceTaa":30,"./Taa":31,"./version":35}],35:[function(require,module,exports){
module.exports="3.0.0";
},{}]},{},[34])(34)
});


//# sourceMappingURL=taaspace.min.js.map