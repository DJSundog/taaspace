/*! taaspace - v1.0.0 - 2013-12-01
 * https://github.com/taataa/taaspace
 *
 * Copyright (c) 2013 Akseli Palen <akseli.palen@gmail.com>;
 * Licensed under the MIT license */


!function(a){"use strict";var b=function(){var a={},c=function(a,c){if("undefined"==typeof a)throw{name:"MissingParameterError",message:"No container HTMLElement specified. Taaspace should have one."};"object"!=typeof c&&(c={}),this._elems=[],this._idCounter=0,this._keyboardManager=b.KeyboardManager.create(),this._container=jQuery(a),this._vp=b.Viewport.create(this,c);var d,e=b.Viewport._View.prototype,f=this,g=function(a){f[a]=function(){return e[a].apply(f._vp,arguments)}};for(d in e)if(e.hasOwnProperty(d)&&"function"==typeof e[d]&&"_"!==d[0]){if(d in this)throw{name:"NamespaceCollisionError",message:"Space and Viewport namespaces collide: "+d};g(d)}};return a.create=function(a,b){return new c(a,b)},a.extension=c.prototype,c.prototype.boundingBox=function(){var a,b,c=0,d=0,e=0,f=0;if(this._elems.length>0)for(b=this._elems[0].box(),c=b.x0,d=b.y0,e=b.x1,f=b.y1,a=1;a<this._elems.length;a+=1)b=this._elems[a].box(),c=Math.min(c,b.x0),d=Math.min(d,b.y0),e=Math.max(e,b.x1),f=Math.max(f,b.y1);return{x0:c,y0:d,x1:e,y1:f}},c.prototype.origo=function(a){var b=a;if("undefined"==typeof b)return{x:0,y:0};throw"pivot"in b&&"function"==typeof b.pivot&&(b=b.pivot()),"Not implemented"},c.prototype.remove=function(a){a._removeHtmlElement(),this._removeSpaceElement(a)},c.prototype.importSpaceElement=function(a){var b=this._identify(a);return this._addSpaceElement(b),b._appendHtmlElement(),b},c.prototype.select=function(){this._select(this._vp)},c.prototype.deselect=function(){this._deselect(this._vp)},c.prototype._identify=function(a){return a._id=String(this._idCounter),this._idCounter+=1,a},c.prototype._addSpaceElement=function(a){this._validateSpaceElement(a),this._elems.push(a)},c.prototype._validateSpaceElement=function(a){if(!("_id"in a&&"string"==typeof a._id))throw{name:"InvalidSpaceElement",message:"Element does not fulfill SpaceElement requirements."}},c.prototype._removeSpaceElement=function(a){this._elems=_.reject(this._elems,function(b){return a===b})},c.prototype._eachSpaceElement=function(a){_.each(this._elems,a)},c.prototype._select=function(a){this._keyboardManager.select(a)},c.prototype._deselect=function(a){this._keyboardManager.deselect(a)},c.prototype._onKey=function(a,b,c){this._keyboardManager.on(a,b,c)},c.prototype._offKey=function(a,b,c){this._keyboardManager.off(a,b,c)},a}();b.SpaceElement=function(){var a={},b=function(){this._space=null,this._htmlElement=null,this._hammertime=null,this._x=0,this._y=0,this._w=0,this._h=0,this._px=0,this._py=0,this._animation=null};return a.create=function(){return new b},b.prototype.width=function(){return this._w},b.prototype.height=function(){return this._h},b.prototype.center=function(){return{x:this._x+this._w/2,y:this._y+this._h/2}},b.prototype.box=function(){return{x0:this._x,y0:this._y,x1:this._x+this._w,y1:this._y+this._h}},b.prototype.area=function(){return this._w*this._h},b.prototype.visibilityRatio=function(){return this._space.visibilityRatioOf(this)},b.prototype.distanceRatio=function(){return this._space.distanceRatioOf(this)},b.prototype.focusRatio=function(){return this._space.focusRatioOf(this)},b.prototype.isInside=function(){throw"Not implemented"},b.prototype.isOutside=function(){throw"Not implemented"},b.prototype.pivot=function(){throw"Not implemented"},b.prototype.size=function(a,b){if("object"==typeof a)b=a.height,a=a.width;else{if("undefined"==typeof a)return{width:this._w,height:this._h};"undefined"==typeof b?this._w=a:(this._w=a,this._h=b)}return this._scaleHtmlElement(),this},b.prototype.scale=function(){throw"Not implemented"},b.prototype.rotate=function(){throw"Not implemented"},b.prototype.moveTo=function(){throw"Not implemented"},b.prototype.moveBy=function(a,b,c){return"object"==typeof a&&("object"==typeof b&&(c=b),b=a.y,a=a.x),this._x+=a,this._y+=b,this._moveHtmlElement(c),this},b.prototype.scalable=function(){throw"Not implemented"},b.prototype.rotatable=function(){throw"Not implemented"},b.prototype.draggable=function(){return console.warn("Element.draggable is deprecated. Use Element.movable instead."),this.movable.apply(this,arguments)},b.prototype.movable=function(){throw"Not implemented"},b.prototype.remove=function(){this._removeHtmlElement(),this._space._removeSpaceElement(this)},b.prototype.attr=function(){this._htmlElement.attr.apply(this._htmlElement,arguments)},b.prototype.css=function(){this._htmlElement.css.apply(this._htmlElement,arguments)},b.prototype.on=function(a,b){this._eventOnHtmlElement(a,b)},b.prototype.off=function(a,b){this._eventOffHtmlElement(a,b)},b.prototype.select=function(){this._selectHtmlElement(),this._space._select(this)},b.prototype.deselect=function(){this._deselectHtmlElement(),this._space._deselect(this)},b.prototype._appendHtmlElement=function(){throw"Abstract function. Must be implemented by the instance."},b.prototype._removeHtmlElement=function(){this._htmlElement.remove(),this._htmlElement=null},b.prototype._moveHtmlElement=function(a){"object"!=typeof a&&(a={});var b=this._space.translatePointFromSpace(this._x,this._y);if(a.hasOwnProperty("ease")){this._animation=move(this._htmlElement.get(0)).set("left",b.x).set("top",b.y),a.hasOwnProperty("duration")&&(this._animation=this._animation.duration(a.duration)),a.hasOwnProperty("delay")&&(this._animation=this._animation.delay(a.delay));var c=this;this._animation.end(function(){c._animation=null,a.hasOwnProperty("end")&&"function"==typeof a.end&&a.end.call(c)})}else null!==this._animation?(move(this._htmlElement.get(0)).set("left",b.x).set("top",b.y).duration("0s").end(),this._animation=null):this._htmlElement.css({left:b.x+"px",top:b.y+"px"})},b.prototype._scaleHtmlElement=function(){var a=this._space.translatePointFromSpace,b=a(this._x,this._y),c=a(this._x+this._w,this._y+this._h);this._htmlElement.css({left:b.x+"px",top:b.y+"px",width:c.x-b.x+"px",height:c.y-b.y+"px"})},b.prototype._rotateHtmlElement=function(){throw"Abstract function. Must be implemented by the instance."},b.prototype._eventOnHtmlElement=function(a,b){if("mousewheel"===a)this._htmlElement.on("mousewheel",b);else if(0===a.indexOf("key-")){var c=a.substring(4);this._space._onKey(c,this,b)}else this._hammertime.on(a,b)},b.prototype._eventOffHtmlElement=function(a,b){if("mousewheel"===a)this._htmlElement.off("mousewheel",b);else if(0===a.indexOf("key-")){var c=a.substring(4);this._space._offKey(c,this,b)}else this._hammertime.off(a,b)},b.prototype._selectHtmlElement=function(){this._htmlElement.toggleClass("taaspace-selected",!0)},b.prototype._deselectHtmlElement=function(){this._htmlElement.toggleClass("taaspace-selected",!1)},a}(),b.Viewport=function(){var a={},b=function(a,b){"undefined"==typeof b&&(b={}),this._space=a,this._container=this._space._container,function(a){a.css({position:"relative",overflow:"hidden"}),b.hasOwnProperty("width")&&("number"==typeof b.width&&(b.width=b.width+"px"),a.css("width",b.width)),b.hasOwnProperty("height")&&("number"==typeof b.height&&(b.height=b.height+"px"),a.css("height",b.height))}(this._container),this._x=0,this._y=0,this._px=0,this._py=0,this._scale=1,this._hammertime=Hammer(this._container.get(0)),this._movable={},this._scalable={}};return a._View=b,a.create=function(a,c){return new b(a,c)},b.prototype.width=function(){var a=this._container.width();return this.translateDistanceToSpace(a)},b.prototype.height=function(){var a=this._container.height();return this.translateDistanceToSpace(a)},b.prototype.center=function(){return{x:this._x+this.width()/2,y:this._y+this.height()/2}},b.prototype.box=function(){return{x0:this._x,y0:this._y,x1:this._x+this.width(),y1:this._y+this.height()}},b.prototype.area=function(){return this.width()*this.height()},b.prototype.visibilityRatioOf=function(){throw"Not implemented"},b.prototype.distanceRatioOf=function(){throw"Not implemented"},b.prototype.focusRatioOf=function(){throw"Not implemented"},b.prototype.translatePointToSpace=function(a,b){return"object"==typeof a&&(b=a.y,a=a.x),{x:this._x+a/this._scale,y:this._y+b/this._scale}},b.prototype.translatePointFromSpace=function(a,b){return"object"==typeof a&&(b=a.y,a=a.x),{x:(a-this._x)*this._scale,y:(b-this._y)*this._scale}},b.prototype.translateDistanceToSpace=function(a){return a/this._scale},b.prototype.translateDistanceFromSpace=function(a){return a*this._scale},b.prototype.pivot=function(a,b){if("object"==typeof a)b=a.y,a=a.x;else if("undefined"==typeof a)return{x:this._px,y:this._py};return this._px=a,this._py=b,this},b.prototype.moveTo=function(a,b,c){"object"==typeof a&&("object"==typeof b&&(c=b),b=a.y,a=a.x),"undefined"==typeof c&&(c={}),this.moveBy(a-this._px,b-this._py,c)},b.prototype.moveBy=function(a,b,c){return"object"==typeof a&&("object"==typeof b&&(c=b),b=a.y,a=a.x),"undefined"==typeof c&&(c={}),this._x+=a,this._y+=b,this._px+=a,this._py+=b,"disableHtmlUpdate"in c&&c.disableHtmlUpdate===!0||this._space._eachSpaceElement(function(a){a._moveHtmlElement(c)}),this},b.prototype.scale=function(a,b){"undefined"==typeof b&&(b={});var c=this.translatePointFromSpace(this._px,this._py);this._scale*=a;var d=this.translatePointFromSpace(this._px,this._py),e=this.translateDistanceToSpace(d.x-c.x),f=this.translateDistanceToSpace(d.y-c.y);return this.moveBy(e,f,{disableHtmlUpdate:!0}),b.hasOwnProperty("disableHtmlUpdate")&&b.disableHtmlUpdate===!0||this._space._eachSpaceElement(function(a){a._scaleHtmlElement(b)}),this},b.prototype.rotate=function(){throw"Not implemented"},b.prototype.focusTo=function(a,b,c){"undefined"==typeof b?b=.8:"object"==typeof b&&(c=b,b=.8),"object"!=typeof c&&(c={}),"box"in a&&"function"==typeof a.box&&(a=a.box()),this.pivot(this.center());var d=(a.x0+a.x1)/2,e=(a.y0+a.y1)/2;this.moveTo(d,e,{disableHtmlUpdate:!0});var f=a.x1-a.x0,g=a.y1-a.y0,h=1,i=1;0!==f&&0!==g&&(h=this.width()/f,i=this.height()/g);var j=Math.min(h,i);this.scale(j*b,c)},b.prototype.scalable=function(a,b){"object"==typeof a?(b=a,a=!0):"boolean"!=typeof a&&(a=!0),"object"!=typeof b&&(b={});var c=this._scalable;if(!c.hasOwnProperty("status")){var d=this;c.status=!1,c.onmousewheel=function(a,b){var c=d._container.offset(),e=a.pageX-c.left,f=a.pageY-c.top,g=d.translatePointToSpace(e,f);d.pivot(g),b>0?d.scale(1.25):d.scale(.8)},c.onkeyplus=function(){d.pivot(d.center()).scale(1.25)},c.onkeyminus=function(){d.pivot(d.center()).scale(.8)}}return a===!1?(c.status=!1,this.off("mousewheel",c.onmousewheel),this.off("key-plus",c.onkeyplus),this.off("key-subtract",c.onkeyminus),this):c.status===!0?this:(c.status=!0,this.on("mousewheel",c.onmousewheel),this.on("key-plus",c.onkeyplus),this.on("key-subtract",c.onkeyminus),this)},b.prototype.rotatable=function(){throw"Not implemented"},b.prototype.draggable=function(){return console.warn("Viewport.draggable is deprecated. Use Viewport.movable instead."),this.movable.apply(this,arguments)},b.prototype.movable=function(a,b){if("object"==typeof a?(b=a,a=!0):"boolean"!=typeof a&&(a=!0),"object"!=typeof b&&(b={}),!this._movable.hasOwnProperty("status")){var c=0,d=0,e=this,f=function(){return 100/e._scale};this._movable={status:!1,ondragstart:function(){c=0,d=0},defaultAnimOptions:{ease:"in-out",duration:"0.3s"},animOptions:{},ondrag:function(a){a.gesture.preventDefault();var b=e.translateDistanceToSpace(a.gesture.deltaX),f=e.translateDistanceToSpace(a.gesture.deltaY);e.moveBy(c-b,d-f),c=b,d=f},onkeyup:function(){e.moveBy(0,-f(),e._movable.animOptions)},onkeydown:function(){e.moveBy(0,f(),e._movable.animOptions)},onkeyleft:function(){e.moveBy(-f(),0,e._movable.animOptions)},onkeyright:function(){e.moveBy(f(),0,e._movable.animOptions)}}}return this._movable.animOptions=b.hasOwnProperty("disableAnimation")&&b.disableAnimation===!0?{}:this._movable.defaultAnimOptions,a===!1?(this._movable.status=!1,this.off("dragstart",this._movable.ondragstart),this.off("drag",this._movable.ondrag),this.off("key-up",this._movable.onkeyup),this.off("key-down",this._movable.onkeydown),this.off("key-left",this._movable.onkeyleft),this.off("key-right",this._movable.onkeyright),this):this._movable.status===!0?this:(this._movable.status=!0,this.on("dragstart",this._movable.ondragstart),this.on("drag",this._movable.ondrag),this.on("key-up",this._movable.onkeyup),this.on("key-down",this._movable.onkeydown),this.on("key-left",this._movable.onkeyleft),this.on("key-right",this._movable.onkeyright),this)},b.prototype.on=function(a,b){if("mousewheel"===a)this._container.on("mousewheel",b);else if(0===a.indexOf("key-")){var c=a.substring(4);this._space._onKey(c,this,b)}else this._hammertime.on(a,b)},b.prototype.off=function(a,b){if("mousewheel"===a)this._container.off("mousewheel",b);else if(0===a.indexOf("key-")){var c=a.substring(4);this._space._offKey(c,this,b)}else this._hammertime.off(a,b)},a}(),b.Text=function(){var a={},c=function(a,b,c){"undefined"==typeof c&&(c={}),this._space=a,this._string=b,this._fontSize=c.hasOwnProperty("fontSize")?c.fontSize:1};return c.prototype=b.SpaceElement.create(),b.extension.createText=function(a,b){var d=new c(this,a,b);return this.importSpaceElement(d)},c.prototype.fontSize=function(a,b){return this._fontSize=a,this._scaleHtmlElement(b),this},c.prototype.fontScale=function(){throw"Not implemented"},c.prototype._appendHtmlElement=function(a){"object"!=typeof a&&(a={});var c=$(document.createElement("p"));this._htmlElement=c;var d="html";return a.hasOwnProperty("disableHTML")&&a.disableHTML===!0&&(d="text"),c[d](this._string),c.attr({"class":b.SPACE_ELEMENT_CLASS+" taaspace-text"}),c.css({position:"absolute"}),this._space._container.append(c),this._moveHtmlElement(a),c},c.prototype._scaleHtmlElement=function(){var a=this._space.translatePointFromSpace,b=a(this._x,this._y),c=a(this._x+this._w,this._y+this._h),d=this._space.translateDistanceFromSpace,e=d(this._fontSize);this._htmlElement.css({"font-size":e+"px",left:b.x+"px",top:b.y+"px",width:c.x-b.x+"px",height:c.y-b.y+"px"})},a}(),b.Image=function(){var a={},c=function(a,b,c){this._space=a,this._src=b,this._w=null,this._h=null,"object"==typeof c&&(c.hasOwnProperty("width")&&(this._w=c.width),c.hasOwnProperty("height")&&(this._h=c.height))};return c.prototype=b.SpaceElement.create(),b.extension.createImage=function(a,b){var d=new c(this,a,b);return this.importSpaceElement(d)},c.prototype._appendHtmlElement=function(a){var c=jQuery(document.createElement("img"));return this._htmlElement=c,c.attr({src:this._src,"class":b.SPACE_ELEMENT_CLASS+" taaspace-image"}),c.css({position:"absolute",width:this._w+"px",height:this._h+"px"}),this._space._container.append(c),this._hammertime=Hammer(this._htmlElement[0]),this._moveHtmlElement(a),c},a}(),b.Group=function(){var a={},b=function(a){this._space=a};return a.create=function(a,c){return new b(a,c)},a}(),b.Network=function(){var a={},b=function(a){this._space=a};return a.create=function(a,c,d){return new b(a,c,d)},a}(),b.Custom=function(){var a={},b=function(a){this._space=a};return a.create=function(a,c,d){return new b(a,c,d)},a}(),b.KeyboardManager=function(){var a={},b=function(a){"undefined"==typeof a&&(a=document),this._c=a,this._pairs={},this._selected=[]};a.create=function(){return new b},b.prototype.select=function(a){return _.contains(this._selected,a)?!1:(this._selected.push(a),void 0)},b.prototype.isSelected=function(a){return _.contains(this._selected,a)},b.prototype.deselect=function(a){var b=this._selected,c=_.without(b,a);return this._selected=c,b.length>c.length},b.prototype.on=function(a,b,d){var e=c(this._pairs,a,b,d);return e&&jwerty.key(a,function(){var b=this._pairs[a],c=_.filter(b,function(a){return this.isSelected(a.object)},this);_.each(c,function(a){a.handler.call(a.object)})},this,this._c),this},b.prototype.off=function(a,b,c){return d(this._pairs,a,b,c),this},b.prototype.clean=function(){throw"not yet implemented"};var c=function(a,b,c,d){var e={object:c,handler:d};return a.hasOwnProperty(b)?(a[b].push(e),!1):(a[b]=[e],!0)},d=function(a,b,c,d){if(a.hasOwnProperty(b)){var e=a[b],f=_.reject(e,function(a){return a.object===c&&a.handler===d?!0:void 0});return a[b]=f,e.length>f.length}return!1};return a}(),b.SPACE_ELEMENT_CLASS="taaspace-element",b.version="1.0.0","object"==typeof module&&"object"==typeof module.exports?module.exports=b:a.Taaspace=b}(this);
//# sourceMappingURL=taaspace.min.map