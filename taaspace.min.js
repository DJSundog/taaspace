(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.taaspace = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
function afterTransition(i,n){return hasTransitions(i)?emitter(i).bind(n):n.apply(i)}var hasTransitions=require("has-transitions"),emitter=require("css-emitter");afterTransition.once=function(i,n){afterTransition(i,function t(){n.apply(i),emitter(i).unbind(t)})},module.exports=afterTransition;
},{"css-emitter":5,"has-transitions":7}],2:[function(require,module,exports){
function Emitter(t){return t?mixin(t):void 0}function mixin(t){for(var e in Emitter.prototype)t[e]=Emitter.prototype[e];return t}module.exports=Emitter,Emitter.prototype.on=Emitter.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},Emitter.prototype.once=function(t,e){function i(){this.off(t,i),e.apply(this,arguments)}return i.fn=e,this.on(t,i),this},Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var i=this._callbacks["$"+t];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var r,s=0;s<i.length;s++)if(r=i[s],r===e||r.fn===e){i.splice(s,1);break}return this},Emitter.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),i=this._callbacks["$"+t];if(i){i=i.slice(0);for(var r=0,s=i.length;s>r;++r)i[r].apply(this,e)}return this},Emitter.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},Emitter.prototype.hasListeners=function(t){return!!this.listeners(t).length};
},{}],3:[function(require,module,exports){
function one(e,r){return r.querySelector(e)}exports=module.exports=function(e,r){return r=r||document,one(e,r)},exports.all=function(e,r){return r=r||document,r.querySelectorAll(e)},exports.engine=function(e){if(!e.one)throw new Error(".one callback required");if(!e.all)throw new Error(".all callback required");return one=e.one,exports.all=e.all,exports};
},{}],4:[function(require,module,exports){
module.exports={"in":"ease-in",out:"ease-out","in-out":"ease-in-out",snap:"cubic-bezier(0,1,.5,1)",linear:"cubic-bezier(0.250, 0.250, 0.750, 0.750)","ease-in-quad":"cubic-bezier(0.550, 0.085, 0.680, 0.530)","ease-in-cubic":"cubic-bezier(0.550, 0.055, 0.675, 0.190)","ease-in-quart":"cubic-bezier(0.895, 0.030, 0.685, 0.220)","ease-in-quint":"cubic-bezier(0.755, 0.050, 0.855, 0.060)","ease-in-sine":"cubic-bezier(0.470, 0.000, 0.745, 0.715)","ease-in-expo":"cubic-bezier(0.950, 0.050, 0.795, 0.035)","ease-in-circ":"cubic-bezier(0.600, 0.040, 0.980, 0.335)","ease-in-back":"cubic-bezier(0.600, -0.280, 0.735, 0.045)","ease-out-quad":"cubic-bezier(0.250, 0.460, 0.450, 0.940)","ease-out-cubic":"cubic-bezier(0.215, 0.610, 0.355, 1.000)","ease-out-quart":"cubic-bezier(0.165, 0.840, 0.440, 1.000)","ease-out-quint":"cubic-bezier(0.230, 1.000, 0.320, 1.000)","ease-out-sine":"cubic-bezier(0.390, 0.575, 0.565, 1.000)","ease-out-expo":"cubic-bezier(0.190, 1.000, 0.220, 1.000)","ease-out-circ":"cubic-bezier(0.075, 0.820, 0.165, 1.000)","ease-out-back":"cubic-bezier(0.175, 0.885, 0.320, 1.275)","ease-out-quad":"cubic-bezier(0.455, 0.030, 0.515, 0.955)","ease-out-cubic":"cubic-bezier(0.645, 0.045, 0.355, 1.000)","ease-in-out-quart":"cubic-bezier(0.770, 0.000, 0.175, 1.000)","ease-in-out-quint":"cubic-bezier(0.860, 0.000, 0.070, 1.000)","ease-in-out-sine":"cubic-bezier(0.445, 0.050, 0.550, 0.950)","ease-in-out-expo":"cubic-bezier(1.000, 0.000, 0.000, 1.000)","ease-in-out-circ":"cubic-bezier(0.785, 0.135, 0.150, 0.860)","ease-in-out-back":"cubic-bezier(0.680, -0.550, 0.265, 1.550)"};
},{}],5:[function(require,module,exports){
function CssEmitter(t){return this instanceof CssEmitter?void(this.el=t):new CssEmitter(t)}var events=require("event"),watch=["transitionend","webkitTransitionEnd","oTransitionEnd","MSTransitionEnd","animationend","webkitAnimationEnd","oAnimationEnd","MSAnimationEnd"];module.exports=CssEmitter,CssEmitter.prototype.bind=function(t){for(var n=0;n<watch.length;n++)events.bind(this.el,watch[n],t);return this},CssEmitter.prototype.unbind=function(t){for(var n=0;n<watch.length;n++)events.unbind(this.el,watch[n],t);return this},CssEmitter.prototype.once=function(t){function n(){i.unbind(n),t.apply(i.el,arguments)}var i=this;return i.bind(n),this};
},{"event":6}],6:[function(require,module,exports){
exports.bind=function(e,n,t,r){return e.addEventListener?e.addEventListener(n,t,r):e.attachEvent("on"+n,t),t},exports.unbind=function(e,n,t,r){return e.removeEventListener?e.removeEventListener(n,t,r):e.detachEvent("on"+n,t),t};
},{}],7:[function(require,module,exports){
function hasTransitions(t){if(!property)return!1;if(!t)return null!=property;var r=getComputedStyle(t)[property];return""!==r&&0!==parseFloat(r)}for(var property,types=["transitionDuration","MozTransitionDuration","webkitTransitionDuration"];types.length;){var type=types.shift();type in document.body.style&&(property=type)}module.exports=hasTransitions;
},{}],8:[function(require,module,exports){
var prop=require("transform-property");if(prop&&window.getComputedStyle){var map={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"},el=document.createElement("div");el.style[prop]="translate3d(1px,1px,1px)",document.body.insertBefore(el,null);var val=getComputedStyle(el).getPropertyValue(map[prop]);document.body.removeChild(el),module.exports=null!=val&&val.length&&"none"!=val}else module.exports=!1;
},{"transform-property":22}],9:[function(require,module,exports){
module.exports=function(n,o){var r,l,t,e,u,f,c,a;if("function"!=typeof o)throw new Error("callback should be a function: "+o);for("string"==typeof n?(r=1,l=!0,n=[n]):(r=n.length,l=!1),t=!1,e=!1,u=[],f=0,c=function(){if(!e){f+=1;var n=f===r;n&&(t=!0,l?o(null,u[0]):o(null,u))}},a=function(n){return t||(e=!0,o(n,null)),!0},i=0;i<n.length;i+=1)u.push(new Image),u[i].onload=c,u[i].onerror=a,u[i].src=n[i]};
},{}],10:[function(require,module,exports){
function Move(t){if(!(this instanceof Move))return new Move(t);if("string"==typeof t&&(t=query(t)),!t)throw new TypeError("Move must be initialized with element or selector");this.el=t,this._props={},this._rotate=0,this._transitionProps=[],this._transforms=[],this.duration(Move.defaults.duration)}function fixUnits(t){return"string"==typeof t&&isNaN(+t)?t:t+"px"}try{document.createElement("DIV").style.setProperty("opacity",0,"")}catch(error){CSSStyleDeclaration.prototype.getProperty=function(t){return this.getAttribute(t)},CSSStyleDeclaration.prototype.setProperty=function(t,e){return this.setAttribute(t,e+"")},CSSStyleDeclaration.prototype.removeProperty=function(t){return this.removeAttribute(t)}}var Emitter=require("component-emitter"),query=require("component-query"),after=require("after-transition"),has3d=require("has-translate3d"),ease=require("css-ease"),translate=has3d?["translate3d(",", 0)"]:["translate(",")"];module.exports=Move;var style=window.getComputedStyle||window.currentStyle;Move.version="0.5.0",Move.ease=ease,Move.defaults={duration:500},Move.select=function(t){return"string"!=typeof t?t:query(t)},Emitter(Move.prototype),Move.prototype.transform=function(t){return this._transforms.push(t),this},Move.prototype.skew=function(t,e){return this.transform("skew("+t+"deg, "+(e||0)+"deg)")},Move.prototype.skewX=function(t){return this.transform("skewX("+t+"deg)")},Move.prototype.skewY=function(t){return this.transform("skewY("+t+"deg)")},Move.prototype.translate=Move.prototype.to=function(t,e){return this.transform(translate.join(""+fixUnits(t)+", "+fixUnits(e||0)))},Move.prototype.translateX=Move.prototype.x=function(t){return this.transform("translateX("+fixUnits(t)+")")},Move.prototype.translateY=Move.prototype.y=function(t){return this.transform("translateY("+fixUnits(t)+")")},Move.prototype.scale=function(t,e){return this.transform("scale("+t+", "+(e||t)+")")},Move.prototype.scaleX=function(t){return this.transform("scaleX("+t+")")},Move.prototype.matrix=function(t,e,r,o,n,s){return this.transform("matrix("+[t,e,r,o,n,s].join(",")+")")},Move.prototype.scaleY=function(t){return this.transform("scaleY("+t+")")},Move.prototype.rotate=function(t){return this.transform("rotate("+t+"deg)")},Move.prototype.ease=function(t){return t=ease[t]||t||"ease",this.setVendorProperty("transition-timing-function",t)},Move.prototype.animate=function(t,e){for(var r in e)e.hasOwnProperty(r)&&this.setVendorProperty("animation-"+r,e[r]);return this.setVendorProperty("animation-name",t)},Move.prototype.duration=function(t){return t=this._duration="string"==typeof t?1e3*parseFloat(t):t,this.setVendorProperty("transition-duration",t+"ms")},Move.prototype.delay=function(t){return t="string"==typeof t?1e3*parseFloat(t):t,this.setVendorProperty("transition-delay",t+"ms")},Move.prototype.setProperty=function(t,e){return this._props[t]=e,this},Move.prototype.setVendorProperty=function(t,e){return this.setProperty("-webkit-"+t,e),this.setProperty("-moz-"+t,e),this.setProperty("-ms-"+t,e),this.setProperty("-o-"+t,e),this},Move.prototype.set=function(t,e){return this.transition(t),this._props[t]=e,this},Move.prototype.add=function(t,e){if(style){var r=this;return this.on("start",function(){var o=parseInt(r.current(t),10);r.set(t,o+e+"px")})}},Move.prototype.sub=function(t,e){if(style){var r=this;return this.on("start",function(){var o=parseInt(r.current(t),10);r.set(t,o-e+"px")})}},Move.prototype.current=function(t){return style(this.el).getPropertyValue(t)},Move.prototype.transition=function(t){return this._transitionProps.indexOf(t)?(this._transitionProps.push(t),this):this},Move.prototype.applyProperties=function(){for(var t in this._props)this.el.style.setProperty(t,this._props[t],"");return this},Move.prototype.move=Move.prototype.select=function(t){return this.el=Move.select(t),this},Move.prototype.then=function(t){if(t instanceof Move)this.on("end",function(){t.end()});else{if("function"!=typeof t){var e=new Move(this.el);return e._transforms=this._transforms.slice(0),this.then(e),e.parent=this,e}this.on("end",t)}return this},Move.prototype.pop=function(){return this.parent},Move.prototype.reset=function(){return this.el.style.webkitTransitionDuration=this.el.style.mozTransitionDuration=this.el.style.msTransitionDuration=this.el.style.oTransitionDuration="",this},Move.prototype.end=function(t){var e=this;return this.emit("start"),this._transforms.length&&this.setVendorProperty("transform",this._transforms.join(" ")),this.setVendorProperty("transition-properties",this._transitionProps.join(", ")),this.applyProperties(),t&&this.then(t),after.once(this.el,function(){e.reset(),e.emit("end")}),this};
},{"after-transition":1,"component-emitter":2,"component-query":3,"css-ease":4,"has-translate3d":8}],11:[function(require,module,exports){
exports.Transform=require("./lib/Transform"),exports.estimateT=require("./lib/estimateT"),exports.estimateS=require("./lib/estimateS"),exports.estimateR=require("./lib/estimateR"),exports.estimateTS=require("./lib/estimateTS"),exports.estimateTR=require("./lib/estimateTR"),exports.estimateSR=require("./lib/estimateSR"),exports.estimateTSR=require("./lib/estimateTSR"),exports.version=require("./lib/version"),exports.estimate=function(e,t,r,i){var s="estimate"+e.toUpperCase();if(exports.hasOwnProperty(s))return exports[s](t,r,i);throw new Error("Unknown estimator type: "+e)};
},{"./lib/Transform":12,"./lib/estimateR":13,"./lib/estimateS":14,"./lib/estimateSR":15,"./lib/estimateT":16,"./lib/estimateTR":17,"./lib/estimateTS":18,"./lib/estimateTSR":19,"./lib/version":20}],12:[function(require,module,exports){
var Transform=function(t,n,r,e){this.s=t,this.r=n,this.tx=r,this.ty=e,this.equals=function(s){return t===s.s&&n===s.r&&r===s.tx&&e===s.ty},this.transform=function(s){if("number"==typeof s[0])return[t*s[0]-n*s[1]+r,n*s[0]+t*s[1]+e];var a,i=[];for(a=0;a<s.length;a+=1)i.push([t*s[a][0]-n*s[a][1]+r,n*s[a][0]+t*s[a][1]+e]);return i},this.getMatrix=function(){return{a:t,b:n,c:-n,d:t,e:r,f:e}},this.getRotation=function(){return Math.atan2(n,t)},this.getScale=function(){return Math.sqrt(n*n+t*t)},this.getTranslation=function(){return[r,e]},this.inverse=function(){var s=t*t+n*n,a=1e-8;if(Math.abs(s)<a)throw new Error("Singular transformations cannot be inversed.");var i=t/s,o=-n/s,f=(-t*r-n*e)/s,u=(n*r-t*e)/s;return new Transform(i,o,f,u)},this.translateBy=function(s,a){return new Transform(t,n,r+s,e+a)},this.scaleBy=function(s,a){var i,o,f;return i=s,"undefined"==typeof a?o=f=0:(o=a[0],f=a[1]),new Transform(i*t,i*n,i*r+(1-i)*o,i*e+(1-i)*f)},this.rotateBy=function(s,a){var i,o,f,u,h,c,m,y;return i=Math.cos(s),o=Math.sin(s),"undefined"==typeof a?f=u=0:(f=a[0],u=a[1]),h=t*i-n*o,c=t*o+n*i,m=(r-f)*i-(e-u)*o+f,y=(r-f)*o+(e-u)*i+u,new Transform(h,c,m,y)},this.multiplyBy=function(s){var a=s,i=t*a.s-n*a.r,o=t*a.r+n*a.s,f=t*a.tx-n*a.ty+r,u=n*a.tx+t*a.ty+e;return new Transform(i,o,f,u)}};Transform.IDENTITY=new Transform(1,0,0,0),module.exports=Transform;
},{}],13:[function(require,module,exports){
var Transform=require("./Transform");module.exports=function(r,n,e){var o,t,a,f,m,s,T,u,h,i,d,l,g,v,I,M,c;for(t=Math.min(r.length,n.length),i=d=l=g=0,"undefined"==typeof e?f=m=0:(f=e[0],m=e[1]),o=0;t>o;o+=1)s=r[o][0]-f,T=r[o][1]-m,u=n[o][0]-f,h=n[o][1]-m,i+=s*u,d+=s*h,l+=T*u,g+=T*h;return p=i+g,q=d-l,a=Math.sqrt(p*p+q*q),0===a?Transform.IDENTITY:(v=p/a,I=q/a,M=f-f*v+m*I,c=m-f*I-m*v,new Transform(v,I,M,c))};
},{"./Transform":12}],14:[function(require,module,exports){
var Transform=require("./Transform");module.exports=function(r,n,e){var a,o,f,t,m,T,s,u,h,i,d,l,g,p,v,x;for(o=Math.min(r.length,n.length),i=d=l=g=0,"undefined"==typeof e?t=m=0:(t=e[0],m=e[1]),a=0;o>a;a+=1)T=r[a][0]-t,s=r[a][1]-m,u=n[a][0]-t,h=n[a][1]-m,i+=T*u,d+=s*h,l+=T*T,g+=s*s;return f=l+g,0===f?Transform.IDENTITY:(p=Math.max(0,(i+d)/f),v=(1-p)*t,x=(1-p)*m,new Transform(p,0,v,x))};
},{"./Transform":12}],15:[function(require,module,exports){
var Transform=require("./Transform");module.exports=function(r,n,e){var a,o,f,t,m,s,u;"undefined"==typeof e&&(e=[0,0]),a=r,o=n,f=Math.min(a.length,o.length);var v,h,i,T,d,l,g,p=e[0],w=e[1];l=g=0;var M,b,c,q;for(M=b=c=q=0,v=0;f>v;v+=1)h=a[v][0]-p,i=a[v][1]-w,T=o[v][0]-p,d=o[v][1]-w,l+=h*h,g+=i*i,M+=h*T,b+=i*d,c+=i*T,q+=h*d;var x=l+g,y=1e-8;return Math.abs(x)<y?new Transform(1,0,0,0):(t=(M+b)/x,m=(-c+q)/x,s=w*m-p*t+p,u=-p*m-w*t+w,new Transform(t,m,s,u))};
},{"./Transform":12}],16:[function(require,module,exports){
var Transform=require("./Transform");module.exports=function(r,n){var e,o,a,f,t,m,T,s;if(o=Math.min(r.length,n.length),a=f=t=m=0,1>o)return Transform.IDENTITY;for(e=0;o>e;e+=1)a+=r[e][0],f+=r[e][1],t+=n[e][0],m+=n[e][1];return T=(t-a)/o,s=(m-f)/o,new Transform(1,0,T,s)};
},{"./Transform":12}],17:[function(require,module,exports){
var Transform=require("./Transform");module.exports=function(r,n){var a,e,o,t,f,m,s,u,T,h,i,v,l,w=r,g=n,q=Math.min(w.length,g.length);for(m=s=u=T=h=i=v=l=0,a=0;q>a;a+=1)e=w[a][0],o=w[a][1],t=g[a][0],f=g[a][1],m+=e,s+=o,u+=t,T+=f,h+=e*t,i+=e*f,v+=o*t,l+=o*f;var M=q*(i-v)-m*T+s*u,c=q*(h+l)-m*u-s*T,d=Math.sqrt(M*M+c*c);if(0===d)return 0===q?new Transform(1,0,0,0):new Transform(1,0,(u-m)/q,(T-s)/q);var p=c/d,x=M/d,b=(-m*p+s*x+u)/q,j=(-m*x-s*p+T)/q;return new Transform(p,x,b,j)};
},{"./Transform":12}],18:[function(require,module,exports){
var Transform=require("./Transform");module.exports=function(r,n){var e,a,o,f,m,t,s,u,T,i,v,h,l,w=r,g=n,c=Math.min(w.length,g.length);for(t=s=u=T=i=v=h=l=0,e=0;c>e;e+=1)a=w[e][0],o=w[e][1],f=g[e][0],m=g[e][1],t+=a,s+=o,u+=f,T+=m,i+=a*a,v+=o*o,h+=a*f,l+=o*m;var d=c*c,p=t*t,q=s*s,x=i+v,M=h+l,b=d*x-c*(p+q);if(0===b)return 0===c?new Transform(1,0,0,0):new Transform(1,0,u/c-a,T/c-o);var j=(d*M-c*(t*u+s*T))/b,k=(-c*t*M+c*u*x-q*u+t*s*T)/b,y=(-c*s*M+c*T*x-p*T+t*s*u)/b;return new Transform(j,0,k,y)};
},{"./Transform":12}],19:[function(require,module,exports){
var Transform=require("./Transform");module.exports=function(r,n){var e,a,o,f,m,t,s;if(e=r,a=n,o=Math.min(e.length,a.length),0===o)return new Transform(1,0,0,0);var u,T,i,v,h,l=0,w=0,g=0,c=0,d=0,p=0,q=0,x=0,M=0,b=0;for(u=0;o>u;u+=1)T=e[u][0],i=e[u][1],v=a[u][0],h=a[u][1],l+=T,w+=i,g+=v,c+=h,d+=T*T,p+=i*i,q+=T*h,x+=i*v,M+=T*v,b+=i*h;var j=o*d+o*p-l*l-w*w,k=1e-8;return j>-k&&k>j?new Transform(1,0,g/o-T,c/o-i):(f=(o*(M+b)-l*g-w*c)/j,m=(o*(q-x)+w*g-l*c)/j,t=(-l*(M+b)+w*(q-x)+d*g+p*g)/j,s=(-w*(M+b)-l*(q-x)+d*c+p*c)/j,new Transform(f,m,t,s))};
},{"./Transform":12}],20:[function(require,module,exports){
module.exports="1.0.1";
},{}],21:[function(require,module,exports){
"use strict";function SeqId(t){return this instanceof SeqId?(null==t&&(t=(Math.random()-.5)*Math.pow(2,32)),void(this._id=0|t)):new SeqId(t)}module.exports=SeqId,SeqId.prototype.next=function(){return this._id=this._id+1|0,this._id};
},{}],22:[function(require,module,exports){
for(var styles=["webkitTransform","MozTransform","msTransform","OTransform","transform"],el=document.createElement("p"),style,i=0;i<styles.length;i++)if(style=styles[i],null!=el.style[style]){module.exports=style;break}
},{}],23:[function(require,module,exports){
var Emitter=require("component-emitter"),SpaceNode=require("./SpaceNode"),SpacePlane=require("./SpacePlane"),SpaceTransformer=require("./SpaceTransformer"),SpaceRectangle=require("./SpaceRectangle"),SpaceTaa=require("./SpaceTaa"),SpaceHTML=require("./SpaceHTML"),Space=require("./Space"),move=require("move-js");move.defaults={duration:0};var HTMLSpaceView=function(e,t){if(!(e instanceof Space))throw"Parent of a View must be a Space.";if(!("tagName"in t))throw"Container should be a DOM Element";Emitter(this),SpaceNode(this),SpacePlane(this),SpaceTransformer(this),SpaceRectangle(this);var n=this;this._el=t,this._elements={},this._nodes={},function(){var e=n._el.clientWidth,t=n._el.clientHeight;n.resize([e,t])}();var i=function(e){return n._elements.hasOwnProperty(e)},a=function(e,t){var i=t.getGlobalTransform().T,a=n._T.inverse().multiplyBy(i),o=8,r=a.s.toFixed(o),s=a.r.toFixed(o),d=a.tx.toFixed(o),c=a.ty.toFixed(o);move(e).matrix(r,s,-s,r,d,c).end()},o=function(e){return n.id+"-"+e},r=function(e){var t,o,r,s;for(t=e.getDescendants(),t.push(e),o=0;o<t.length;o+=1)r=t[o],i(r.id)&&(r instanceof SpaceTaa?(s=n._elements[r.id],a(s,r)):r instanceof SpaceHTML&&(s=n._elements[r.id],a(s,r)))},s=function(e){var t,a;i(e.id)&&e.hasOwnProperty("resize")&&(a=e.getSize(),t=n._elements[e.id],t.style.width=a[0]+"px",t.style.height=a[1]+"px")},d=function(e,t,d){"undefined"==typeof d&&(d=null),"undefined"==typeof t&&(t=null);var c,l,f;if(c=e,e.getRootParent()===n.getRootParent())if(i(c.id));else if(c instanceof SpaceTaa)l=new Image(256,256),l.src=c.taa.image.src,l.id=o(c.id),l.className="taaspace-taa",n._el.appendChild(l),n._elements[c.id]=l,n._nodes[c.id]=c,a(l,c),c.on("transformed",r),c.on("resized",s);else if(c instanceof SpaceHTML)l=document.createElement("div"),l.innerHTML=c.html,l.id=o(c.id),l.className="taaspace-html",f=c.getSize(),l.style.width=f[0]+"px",l.style.height=f[1]+"px",n._el.appendChild(l),n._elements[c.id]=l,n._nodes[c.id]=c,a(l,c),c.on("transformed",r),c.on("resized",s);else if(!(c instanceof HTMLSpaceView))throw new Exception("Unknown SpaceNode subtype; cannot represent")},c=function(e,t,a){"undefined"==typeof t&&(t=null),"undefined"==typeof a&&(a=null);var o,d,c;c=e,o=null===t||null===a?!1:t.getRootParent()===a.getRootParent(),o||i(c.id)&&(d=n._elements[c.id],n._el.removeChild(d),delete n._elements[c.id],delete n._nodes[c.id],c.off("transformed",r),c.off("resized",s))};this.on("added",function(e,t,n){var i,a;if(n!==t){for(i=t.getDescendants(),a=0;a<i.length;a+=1)d(i[a]);t.on("contentAdded",d),t.on("contentRemoved",c)}}),this.on("removed",function(e,t,n){var i,a;if(n!==t)for(t.off("contentAdded",d),t.off("contentRemoved",c),i=t.getDescendants(),a=0;a<i.length;a+=1)c(i[a])}),this.on("transformed",function(){var e,t,i;for(e in n._elements)n._elements.hasOwnProperty(e)&&(t=n._elements[e],i=n._nodes[e],a(t,i))}),this.getElementBySpaceNode=function(e){return i(e.id)?this._elements[e.id]:null},this.getSpaceNodeByElementId=function(e){var t=e.split("-"),n=t[0],a=t[1];return this.id===n&&i(a)?this._nodes[a]:null},this.getRootElement=function(){return this._el};var l=this.setParent;this.setParent=function(e){if(!(e instanceof Space))throw"A View can only be a child of a Space";l.call(this,e)},this.setParent(e)};module.exports=HTMLSpaceView;
},{"./Space":24,"./SpaceHTML":25,"./SpaceNode":26,"./SpacePlane":28,"./SpaceRectangle":30,"./SpaceTaa":31,"./SpaceTransformer":33,"component-emitter":2,"move-js":10}],24:[function(require,module,exports){
var Emitter=require("component-emitter"),SpaceNode=require("./SpaceNode"),SpacePlane=require("./SpacePlane"),Space=function(){Emitter(this),SpaceNode(this),SpacePlane(this),this.setParent=function(){throw new Error("Space cannot have a parent.")},this.remove=function(){}};module.exports=Space;
},{"./SpaceNode":26,"./SpacePlane":28,"component-emitter":2}],25:[function(require,module,exports){
var Emitter=require("component-emitter"),SpaceNode=require("./SpaceNode"),SpacePlane=require("./SpacePlane"),SpaceTransformer=require("./SpaceTransformer"),SpaceRectangle=require("./SpaceRectangle"),SpaceHTML=function(e,t){Emitter(this),SpaceNode(this),SpacePlane(this),SpaceTransformer(this),SpaceRectangle(this),this.html=t,this.resize([256,256]),this.getHTML=function(){return this.html},this.setParent(e)};module.exports=SpaceHTML;
},{"./SpaceNode":26,"./SpacePlane":28,"./SpaceRectangle":30,"./SpaceTransformer":33,"component-emitter":2}],26:[function(require,module,exports){
var Emitter=require("component-emitter"),seqid=require("seqid")(0),SpaceNode=function(e){e.id=seqid.next().toString(),e._parent=null,e._children={},e._addedHandlers={},e._removedHandlers={},e.getChildren=function(){var e,t,n;t=[],n=this._children;for(e in n)t.push(n[e]);return t},e.getDescendants=function(){var e,t,n,i;for(i=[],t=this.getChildren(),e=0;e<t.length;e+=1)n=t[e],i=i.concat(n,n.getDescendants());return i},e.getParent=function(){return this._parent},e.getRootParent=function(){return null===this._parent?this:this._parent.getRootParent()},e.hasChild=function(e){return e._parent===this},e.hasDescendant=function(e){for(var t=e._parent;null!==t&&t!==this;)t=t._parent;return null!==t},e.remove=function(){return this.setParent(null)},e.setParent=function(e){var t=this._parent;if(null===t)if(null===e);else{if(this===e||this.hasDescendant(e))throw new Error("Cyclic parent-child relationships are forbidden.");this._parent=e,this._parent._addChild(this),this.emit("added",this,this._parent,null),e.emit("contentAdded",this,this._parent,null)}else if(null===e)this._parent=null,t._removeChild(this),this.emit("removed",this,t,null),t.emit("contentRemoved",this,t,null);else{if(this===e||this.hasDescendant(e))throw new Error("Cyclic parent-child relationships are forbidden.");this._parent=e,t._removeChild(this),e._addChild(this),this.emit("removed",this,t,e),this.emit("added",this,e,t),t.emit("contentRemoved",this,t,e),e.emit("contentAdded",this,e,t)}},e._addChild=function(e){var t=e,n=this;this._children[t.id]=t;var i=function(e,t,i){n.emit("contentAdded",e,t,i)},d=function(e,t,i){n.emit("contentRemoved",e,t,i)};t.on("contentAdded",i),t.on("contentRemoved",d),this._addedHandlers[t.id]=i,this._removedHandlers[t.id]=d},e._removeChild=function(e){var t,n;t=e,delete this._children[t.id],n=this._addedHandlers[t.id],delete this._addedHandlers[t.id],t.off("contentAdded",n),n=this._removedHandlers[t.id],delete this._removedHandlers[t.id],t.off("contentRemoved",n)}};module.exports=SpaceNode;
},{"component-emitter":2,"seqid":21}],27:[function(require,module,exports){
var Emitter=require("component-emitter"),SpaceNode=require("./SpaceNode"),SpacePlane=require("./SpacePlane"),SpaceTransformer=require("./SpaceTransformer"),SpaceRectangle=require("./SpaceRectangle"),SpacePixel=function(e){Emitter(this),SpaceNode(this),SpacePlane(this),SpaceTransformer(this),SpaceRectangle(this),this.resize([1,1]),this.setParent(e)};module.exports=SpacePixel;
},{"./SpaceNode":26,"./SpacePlane":28,"./SpaceRectangle":30,"./SpaceTransformer":33,"component-emitter":2}],28:[function(require,module,exports){
var nudged=require("nudged"),SpacePoint=require("./SpacePoint"),SpaceTransform=require("./SpaceTransform"),at=function(n){if(2!==n.length)throw"Invalid point, use array [x, y]";return new SpacePoint(this,n)},SpacePlane=function(n){n._T=nudged.Transform.IDENTITY,n.at=at,n.getLocalTransform=function(){return null===this._parent?new SpaceTransform(this):new SpaceTransform(this,this._T)},n.getGlobalTransform=function(){var n,r;if(null===this._parent)return r={_T:nudged.Transform.IDENTITY},new SpaceTransform(r);for(n=this._T,r=this._parent;null!==r._parent;)n=r._T.multiplyBy(n),r=r._parent;return new SpaceTransform(r,n)},n.resetTransform=function(){this._T=nudged.Transform.IDENTITY}};module.exports=SpacePlane;
},{"./SpacePoint":29,"./SpaceTransform":32,"nudged":11}],29:[function(require,module,exports){
var nudged=require("nudged"),SpacePoint=function(t,n){"undefined"==typeof n&&(n=[0,0]),this.xy=n,t.hasOwnProperty("getGlobalTransform")?this._T=t.getGlobalTransform().T:this._T=t._T},proto=SpacePoint.prototype;proto.equals=function(t){return this.xy[0]===t.xy[0]&&this.xy[1]===t.xy[1]&&this._T.equals(t._T)},proto.offset=function(t,n){var r=[this.xy[0]+t,this.xy[1]+n];return new SpacePoint(this,r)},proto.polarOffset=function(t,n){var r=this.xy[0]+t*Math.cos(n),o=this.xy[1]+t*Math.sin(n);return new SpacePoint(this,[r,o])},proto.to=function(t){if(null===t)return this.toSpace();var n;if(t.hasOwnProperty("_T"))n=t._T;else{if(!("getGlobalTransform"in t))throw new Error("Cannot convert SpacePoint to: "+t);n=t.getGlobalTransform().T}if(n.equals(this._T))return this;var r=n.inverse().multiplyBy(this._T),o=r.transform(this.xy);return new SpacePoint(t,o)},proto.toSpace=function(){var t=this._T.transform(this.xy),n={_T:nudged.Transform.IDENTITY};return new SpacePoint(n,t)},proto.transformBy=function(t){var n=t.to(this),r=n.T.transform(this.xy);return new SpacePoint(this,r)},SpacePoint.normalize=function(t,n){var r,o,e;for(e=[],r=0;r<t.length;r+=1)o=t[r],e.push(o.to(n));return e},SpacePoint.toXY=function(t){var n,r;for(r=[],n=0;n<t.length;n+=1)r.push(t[n].xy);return r},SpacePoint.normalizeXY=function(t,n){var r,o,e;for(e=[],r=0;r<t.length;r+=1)o=t[r],e.push(o.to(n).xy);return e},module.exports=SpacePoint;
},{"nudged":11}],30:[function(require,module,exports){
var SpacePoint=require("./SpacePoint"),SpaceRectangle=function(n){var t=n,e=1,i=1;t.atNorm=function(n){return new SpacePoint(t,[e*n[0],i*n[1]])},t.atMid=function(){return new SpacePoint(t,[e/2,i/2])},t.atMidN=function(){return new SpacePoint(t,[e/2,0])},t.atMidW=function(){return new SpacePoint(t,[0,i/2])},t.atMidE=function(){return new SpacePoint(t,[e,i/2])},t.atMidS=function(){return new SpacePoint(t,[e/2,i])},t.atNW=function(){return new SpacePoint(t,[0,0])},t.atNE=function(){return new SpacePoint(t,[e,0])},t.atSW=function(){return new SpacePoint(t,[0,i])},t.atSE=function(){return new SpacePoint(t,[e,i])},t.getSize=function(){return[e,i]},t.resize=function(n){e=n[0],i=n[1],this.emit("resized",t)}};module.exports=SpaceRectangle;
},{"./SpacePoint":29}],31:[function(require,module,exports){
var Emitter=require("component-emitter"),SpaceNode=require("./SpaceNode"),SpacePlane=require("./SpacePlane"),SpaceTransformer=require("./SpaceTransformer"),SpaceRectangle=require("./SpaceRectangle"),SpaceTaa=function(e,a){Emitter(this),SpaceNode(this),SpacePlane(this),SpaceTransformer(this),SpaceRectangle(this),this.taa=a,this.resize([256,256]),this.setParent(e)};module.exports=SpaceTaa;
},{"./SpaceNode":26,"./SpacePlane":28,"./SpaceRectangle":30,"./SpaceTransformer":33,"component-emitter":2}],32:[function(require,module,exports){
var Transform=require("./Transform"),SpacePoint=require("./SpacePoint"),nudged=require("nudged"),SpaceTransform=function(t,r){if(!t.hasOwnProperty("_T"))throw"invalid reference";if(r&&!r.hasOwnProperty("tx"))throw"invalid transform";"undefined"==typeof r&&(r=Transform.IDENTITY),this.T=r,t.hasOwnProperty("getGlobalTransform")?this._T=t.getGlobalTransform().T:this._T=t._T},proto=SpaceTransform.prototype;proto.switchTo=function(t){return new SpaceTransform(t,this.T)},proto.equals=function(t){return this.T.equals(t.T)&&this._T.equals(t._T)},proto.inverse=function(){return new SpaceTransform(this,this.T.inverse())},proto.to=function(t){var r,e,n;if(null===t)return this.toSpace();if(t.hasOwnProperty("_T"))r=t._T;else{if(!("getGlobalTransform"in t))throw new Error("Cannot convert SpaceTransform to: "+t);r=t.getGlobalTransform().T}return r.equals(this._T)?this:(e=r.inverse().multiplyBy(this._T),n=e.multiplyBy(this.T.multiplyBy(e.inverse())),new SpaceTransform(t,n))},proto.toSpace=function(){var t=this._T.multiplyBy(this.T.multiplyBy(this._T.inverse())),r={_T:Transform.IDENTITY};return new SpaceTransform(r,t)},proto.transformBy=function(t){var r=t.to(this).T,e=r.multiplyBy(this.T);return new SpaceTransform(this,e)},proto.translate=function(t,r){var e=SpaceTransform.estimate(this,"T",t,r);return new SpaceTransform(this,e.T.multiplyBy(this.T))},proto.scale=function(t,r,e){var n,a,o,s,i;return n="undefined"==typeof e,n?(a=t.to(this),s=this.T.scaleBy(r,a.xy),new SpaceTransform(this,s)):(o=r,i=SpaceTransform.estimate(this,"S",o,e,t),s=i.T.multiplyBy(this.T),new SpaceTransform(this,s))},proto.rotate=function(t,r,e){var n,a,o,s,i;return n="undefined"==typeof e,n?(a=t.to(this),s=this.T.rotateBy(r,a.xy),new SpaceTransform(this,s)):(o=r,i=SpaceTransform.estimate(this,"R",o,e,t),s=i.T.multiplyBy(this.T),new SpaceTransform(this,s))},proto.translateScale=function(t,r){var e=SpaceTransform.estimate(this,"TS",t,r);return new SpaceTransform(this,e.T.multiplyBy(this.T))},proto.translateRotate=function(t,r){var e=SpaceTransform.estimate(this,"TR",t,r);return new SpaceTransform(this,e.T.multiplyBy(this.T))},proto.scaleRotate=function(t,r,e){var n=SpaceTransform.estimate(this,"SR",r,e,t);return new SpaceTransform(this,n.T.multiplyBy(this.T))},proto.translateScaleRotate=function(t,r){var e=SpaceTransform.estimate(this,"TSR",t,r);return new SpaceTransform(this,e.T.multiplyBy(this.T))},SpaceTransform.estimate=function(t,r,e,n,a){var o;"undefined"!=typeof a&&(o=SpacePoint.normalizeXY([a])[0]),e.hasOwnProperty("_T")&&(e=[e]),n.hasOwnProperty("_T")&&(n=[n]);var s=SpacePoint.normalizeXY(e,t),i=SpacePoint.normalizeXY(n,t),T=nudged.estimate(r,s,i,o);return new SpaceTransform(t,T)},module.exports=SpaceTransform;
},{"./SpacePoint":29,"./Transform":35,"nudged":11}],33:[function(require,module,exports){
var nudged=require("nudged"),Transform=require("./Transform"),SpacePoint=require("./SpacePoint"),SpaceTransform=require("./SpaceTransform"),SpaceTransformer=function(t){t.setLocalTransform=function(t){null!==this._parent&&(this._T=t.to(this._parent).T,this.emit("transformed",this))},t.setGlobalTransform=function(t){if(null!==this._parent){var r=this._parent.getGlobalTransform().T,e=t.toSpace().T;this._T=r.inverse().multiplyBy(e),this.emit("transformed",this)}},t.transformBy=function(t){if(null!==this._parent){var r=t.to(this._parent);this._T=r.T.multiplyBy(this._T),this.emit("transformed",this)}},t.translate=function(t,r){var e=SpaceTransform.estimate(this,"T",t,r);this.transformBy(e)},t.scale=function(t,r,e){var a=new SpaceTransform(this).scale(t,r,e);this.transformBy(a)},t.rotate=function(t,r,e){var a=new SpaceTransform(this).rotate(t,r,e);this.transformBy(a)},t.translateScale=function(t,r){var e=SpaceTransform.estimate(this,"TS",t,r);this.transformBy(e)},t.translateRotate=function(t,r){var e=SpaceTransform.estimate(this,"TR",t,r);this.transformBy(e)},t.scaleRotate=function(t,r,e){var a=SpaceTransform.estimate(this,"SR",r,e,t);this.transformBy(a)},t.translateScaleRotate=function(t,r){var e=SpaceTransform.estimate(this,"TSR",t,r);this.transformBy(e)},t.on("removed",function(t,r,e){if("undefined"==typeof r&&(r=null),"undefined"==typeof e&&(e=null),null===e)t.resetTransform();else if(null===r)throw new Error("Cannot remove from null parent");this.emit("transformed",t)})};module.exports=SpaceTransformer;
},{"./SpacePoint":29,"./SpaceTransform":32,"./Transform":35,"nudged":11}],34:[function(require,module,exports){
var Emitter=require("component-emitter"),loadimages=require("loadimages"),NOOP=function(){},Taa=function(e,i){Emitter(this);var t=this;"function"!=typeof i&&(i=NOOP),this.image={src:e};var a=!1;loadimages(e,function(e,o){var n,m;e?(n=e,m=null):(t.image=o,n=null,m=t),a?(t.emit("loaded",n,m),i(n,m)):setTimeout(function(){t.emit("loaded",n,m),i(n,m)},0)}),a=!0};module.exports=Taa;
},{"component-emitter":2,"loadimages":9}],35:[function(require,module,exports){
var nudged=require("nudged");module.exports=nudged.Transform;
},{"nudged":11}],36:[function(require,module,exports){
exports.SpacePoint=require("./SpacePoint"),exports.Transform=require("./Transform"),exports.SpaceTransform=require("./SpaceTransform"),exports.Taa=require("./Taa"),exports.SpaceTaa=require("./SpaceTaa"),exports.SpaceHTML=require("./SpaceHTML"),exports.SpacePixel=require("./SpacePixel"),exports.Space=require("./Space"),exports.HTMLSpaceView=require("./HTMLSpaceView"),exports.version=require("./version");
},{"./HTMLSpaceView":23,"./Space":24,"./SpaceHTML":25,"./SpacePixel":27,"./SpacePoint":29,"./SpaceTaa":31,"./SpaceTransform":32,"./Taa":34,"./Transform":35,"./version":37}],37:[function(require,module,exports){
module.exports="3.0.0";
},{}]},{},[36])(36)
});


//# sourceMappingURL=taaspace.min.js.map